# –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ "–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–æ–≤"

**–í–µ—Ä—Å–∏—è:** 1.1 (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è)
**–î–∞—Ç–∞:** 2025-12-02
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

–í–ê–ñ–ù–û: –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å —ç—Ç–∏–º –ø–ª–∞–Ω–æ–º

1. **–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –¢–û–õ–¨–ö–û –û–î–ò–ù —à–∞–≥ –∑–∞ —Ä–∞–∑**
2. **–ù–ï –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É, –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω —Ç–µ–∫—É—â–∏–π**
3. **–ö–∞–∂–¥—ã–π —à–∞–≥ –Ω–µ–∑–∞–≤–∏—Å–∏–º - –Ω–µ –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ**
4. **–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —à–∞–≥–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º**
5. **–û—Ç–º–µ—Ç—å—Ç–µ —à–∞–≥ –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π: `[X]`**

---

## –§–ê–ó–ê 1: –ü–û–î–ì–û–¢–û–í–ö–ê –°–¢–†–£–ö–¢–£–†–´ –ü–†–û–ï–ö–¢–ê

### –®–∞–≥ 1.1: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫ [X]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞–ø–∫–∏ –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```
DogovorLocal/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ models/
‚îú‚îÄ‚îÄ frontend/
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îî‚îÄ‚îÄ prompts/
‚îÇ       ‚îî‚îÄ‚îÄ defaults/
‚îú‚îÄ‚îÄ logs/
‚îî‚îÄ‚îÄ scripts/
```

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (Windows PowerShell):**

```powershell
New-Item -ItemType Directory -Path "backend\middleware" -Force
New-Item -ItemType Directory -Path "backend\services" -Force
New-Item -ItemType Directory -Path "backend\models" -Force
New-Item -ItemType Directory -Path "frontend\css" -Force
New-Item -ItemType Directory -Path "frontend\js" -Force
New-Item -ItemType Directory -Path "data\prompts\defaults" -Force
New-Item -ItemType Directory -Path "logs" -Force
New-Item -ItemType Directory -Path "scripts" -Force
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [X] –ü–∞–ø–∫–∞ `backend/middleware/` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [X] –ü–∞–ø–∫–∞ `backend/services/` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [X] –ü–∞–ø–∫–∞ `backend/models/` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [X] –ü–∞–ø–∫–∞ `frontend/css/` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [X] –ü–∞–ø–∫–∞ `frontend/js/` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [X] –ü–∞–ø–∫–∞ `data/prompts/defaults/` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [X] –ü–∞–ø–∫–∞ `logs/` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [X] –ü–∞–ø–∫–∞ `scripts/` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [X] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 1.2: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ requirements.txt [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `requirements.txt` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

**–§–∞–π–ª:** `requirements.txt`

```txt
# Web-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
fastapi>=0.109.0
uvicorn>=0.27.0
python-multipart>=0.0.6

# –†–∞–±–æ—Ç–∞ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏
python-docx>=1.1.0
pywin32>=306
PyPDF2>=3.0.0
pdfplumber>=0.10.0

# LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
openai>=1.12.0

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —É—Ç–∏–ª–∏—Ç—ã
python-dotenv>=1.0.0
markdown>=3.5.0

# Rate limiting –∏ –æ—á–µ—Ä–µ–¥—å
slowapi>=0.1.9

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
loguru>=0.7.0
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `requirements.txt` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ 12 –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (# Web-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –∏ —Ç.–¥.)

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 1.3: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ .env.example [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.example` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.

**–§–∞–π–ª:** `.env.example`

```env
# DeepSeek API (–æ–±–ª–∞—á–Ω–∞—è LLM)
DEEPSEEK_API_KEY=your_api_key_here
DEEPSEEK_BASE_URL=https://api.deepseek.com

# –°–µ—Ä–≤–µ—Ä
HOST=0.0.0.0
PORT=8000

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
LOG_LEVEL=INFO
LOG_ROTATION=10 MB
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `.env.example` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–∫—Ü–∏—é `# DeepSeek API`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–∫—Ü–∏—é `# –°–µ—Ä–≤–µ—Ä`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–∫—Ü–∏—é `# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `DEEPSEEK_API_KEY`

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 1.3.1: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ —Ñ–∞–π–ª–∞ .env [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env` –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –µ–≥–æ.

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (Windows PowerShell):**

```powershell
Copy-Item ".env.example" -Destination ".env"
```

> ‚ö†Ô∏è **–í–ê–ñ–ù–û:** –ü–æ—Å–ª–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π API –∫–ª—é—á DeepSeek!

**–§–∞–π–ª:** `.env` (–ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```env
# DeepSeek API (–æ–±–ª–∞—á–Ω–∞—è LLM)
DEEPSEEK_API_KEY=sk-–≤–∞—à-—Ä–µ–∞–ª—å–Ω—ã–π-–∫–ª—é—á-–∑–¥–µ—Å—å
DEEPSEEK_BASE_URL=https://api.deepseek.com

# –°–µ—Ä–≤–µ—Ä
HOST=0.0.0.0
PORT=8000

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
LOG_LEVEL=INFO
LOG_ROTATION=10 MB
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `.env` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ (—Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –∏–∑ `.env.example`)
- [x] –§–∞–π–ª `.env` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–π API –∫–ª—é—á DeepSeek (–∏–ª–∏ –æ—Å—Ç–∞–≤–ª–µ–Ω –ø—É—Å—Ç—ã–º –¥–ª—è LM Studio)
- [x] –§–∞–π–ª `.env` –ù–ï –¥–æ–±–∞–≤–ª–µ–Ω –≤ Git (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ `.gitignore`)

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 1.4: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ .gitignore [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.gitignore` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.

**–§–∞–π–ª:** `.gitignore`

```gitignore
# Python
__pycache__/
*.py[cod]
*$py.class
*.so
.Python
venv/
env/
ENV/
.venv

# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
.env

# –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–ù–ï –∫–æ–º–º–∏—Ç–∏–º!)
data/users.json
data/auth_ips.json
data/tokens_usage.json
data/llm_config.json
data/settings.json

# –õ–æ–≥–∏
logs/*.log

# IDE
.vscode/
.idea/
*.swp
*.swo

# Windows
Thumbs.db
desktop.ini

# –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
*.tmp
*.bak
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `.gitignore` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–∫—Ü–∏—é `# Python`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç `venv/` –≤ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã—Ö
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç `.env` –≤ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã—Ö
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç `data/*.json` –≤ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã—Ö

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 1.5: –°–æ–∑–¥–∞–Ω–∏–µ __init__.py —Ñ–∞–π–ª–æ–≤ [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ –ø—É—Å—Ç—ã–µ —Ñ–∞–π–ª—ã `__init__.py` –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –ø–∞–ø–∫–∞—Ö:

1. `backend/__init__.py`
2. `backend/middleware/__init__.py`
3. `backend/services/__init__.py`
4. `backend/models/__init__.py`

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (Windows PowerShell):**

```powershell
New-Item -ItemType File -Path "backend\__init__.py" -Force
New-Item -ItemType File -Path "backend\middleware\__init__.py" -Force
New-Item -ItemType File -Path "backend\services\__init__.py" -Force
New-Item -ItemType File -Path "backend\models\__init__.py" -Force
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `backend/__init__.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª `backend/middleware/__init__.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª `backend/services/__init__.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª `backend/models/__init__.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –í—Å–µ —Ñ–∞–π–ª—ã –º–æ–≥—É—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º–∏

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### üîó **–ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–ï –ü–†–û–í–ï–†–ö–ò –ü–û–°–õ–ï –§–ê–ó–´ 1**

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–π —Ñ–∞–∑–µ.

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –í—Å–µ –ø–∞–ø–∫–∏ —Å–æ–∑–¥–∞–Ω—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –∑–∞–ø–∏—Å–∏
- [x] –§–∞–π–ª—ã `__init__.py` –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [x] Git –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

**–ú–∏–Ω–∏-—Ç–µ—Å—Ç—ã:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞–ø–æ–∫
ls -la backend/ frontend/ data/ logs/ scripts/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ Python —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
python -m py_compile backend/__init__.py
python -m py_compile backend/middleware/__init__.py
python -m py_compile backend/services/__init__.py
python -m py_compile backend/models/__init__.py
```

---

## –§–ê–ó–ê 2: –ë–ê–ó–û–í–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø

### –®–∞–≥ 2.1: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ config.py [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/config.py` –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**–§–∞–π–ª:** `backend/config.py`

```python
import os
from pathlib import Path
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()

# –ë–∞–∑–æ–≤—ã–µ –ø—É—Ç–∏
BASE_DIR = Path(__file__).resolve().parent.parent
DATA_DIR = BASE_DIR / "data"
LOGS_DIR = BASE_DIR / "logs"
PROMPTS_DIR = DATA_DIR / "prompts"
DEFAULTS_DIR = PROMPTS_DIR / "defaults"

# API –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
DEEPSEEK_API_KEY = os.getenv("DEEPSEEK_API_KEY", "")
DEEPSEEK_BASE_URL = os.getenv("DEEPSEEK_BASE_URL", "https://api.deepseek.com")

# –°–µ—Ä–≤–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
HOST = os.getenv("HOST", "0.0.0.0")
PORT = int(os.getenv("PORT", "8000"))

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
LOG_LEVEL = os.getenv("LOG_LEVEL", "INFO")
LOG_ROTATION = os.getenv("LOG_ROTATION", "10 MB")

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
DATA_DIR.mkdir(exist_ok=True)
LOGS_DIR.mkdir(exist_ok=True)
PROMPTS_DIR.mkdir(exist_ok=True)
DEFAULTS_DIR.mkdir(exist_ok=True)
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `backend/config.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `os`, `Path`, `load_dotenv`
- [x] –§–∞–π–ª –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `BASE_DIR`
- [x] –§–∞–π–ª –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `DATA_DIR`
- [x] –§–∞–π–ª –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `DEEPSEEK_API_KEY`
- [x] –§–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —á–µ—Ä–µ–∑ `.mkdir(exist_ok=True)`

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 2.2: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–≥–æ main.py [‚úÖ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/main.py` —Å –±–∞–∑–æ–≤—ã–º FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.

> ‚ö†Ô∏è **–í–ê–ñ–ù–û:** –≠—Ç–æ—Ç —Ñ–∞–π–ª –±—É–¥–µ—Ç –¥–æ–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞—Ö. –°–µ–π—á–∞—Å —Å–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–æ—É—Ç–∏–Ω–≥–æ–º.

**–§–∞–π–ª:** `backend/main.py`

```python
from fastapi import FastAPI, Request
from fastapi.middleware.cors import CORSMiddleware
from fastapi.staticfiles import StaticFiles
from fastapi.responses import RedirectResponse, FileResponse
from pathlib import Path

# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
app = FastAPI(
    title="–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–æ–≤",
    description="–õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ AI",
    version="1.0.0"
)

# CORS –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# –ë–∞–∑–æ–≤—ã–µ –ø—É—Ç–∏
BASE_DIR = Path(__file__).resolve().parent.parent
FRONTEND_DIR = BASE_DIR / "frontend"

# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (frontend)
app.mount("/static", StaticFiles(directory=str(FRONTEND_DIR)), name="static")

# ===== –†–û–£–¢–ò–ù–ì –°–¢–†–ê–ù–ò–¶ =====

@app.get("/")
async def root():
    """
    –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ - —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
    """
    return RedirectResponse(url="/static/login.html")

@app.get("/login")
async def login_page():
    """
    –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.
    """
    return FileResponse(FRONTEND_DIR / "login.html")

@app.get("/app")
async def app_page():
    """
    –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö).
    """
    return FileResponse(FRONTEND_DIR / "index.html")

@app.get("/admin")
async def admin_page():
    """
    –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å.
    """
    return FileResponse(FRONTEND_DIR / "admin.html")

@app.get("/health")
async def health_check():
    """
    –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞.
    """
    return {"status": "healthy"}

@app.get("/api/status")
async def api_status():
    """
    –°—Ç–∞—Ç—É—Å API –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.
    """
    return {
        "status": "ok",
        "message": "–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–æ–≤ –∑–∞–ø—É—â–µ–Ω",
        "version": "1.0.0"
    }

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8000)
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [‚úÖ] –§–∞–π–ª `backend/main.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [‚úÖ] –§–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `FastAPI`, `Request`, `RedirectResponse`, `FileResponse`
- [‚úÖ] –§–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `app = FastAPI(...)`
- [‚úÖ] –§–∞–π–ª –¥–æ–±–∞–≤–ª—è–µ—Ç `CORSMiddleware`
- [‚úÖ] Endpoint `@app.get("/")` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `RedirectResponse` –Ω–∞ login.html
- [‚úÖ] Endpoint `@app.get("/login")` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç FileResponse —Å login.html
- [‚úÖ] Endpoint `@app.get("/app")` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç FileResponse —Å index.html
- [‚úÖ] Endpoint `@app.get("/admin")` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç FileResponse —Å admin.html
- [‚úÖ] Endpoint `@app.get("/health")` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—É—Å
- [‚úÖ] –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å `python backend/main.py` –±–µ–∑ –æ—à–∏–±–æ–∫ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞)

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [‚úÖ] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### üîó **–ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–ï –ü–†–û–í–ï–†–ö–ò –ü–û–°–õ–ï –§–ê–ó–´ 2**

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**

- [‚úÖ] –§–∞–π–ª `config.py` –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [‚úÖ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [‚úÖ] –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- [‚úÖ] FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞)

**–ú–∏–Ω–∏-—Ç–µ—Å—Ç—ã:**

```bash
# –¢–µ—Å—Ç –∏–º–ø–æ—Ä—Ç–∞ config
cd backend
python -c "import config; print('Config loaded successfully')"

# –¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞ FastAPI
python -c "from main import app; print('FastAPI app created successfully')"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
ls -la ../data ../logs
```

**Fallback-—Å—Ü–µ–Ω–∞—Ä–∏–π:**

- –ï—Å–ª–∏ –∏–º–ø–æ—Ä—Ç `config.py` –ø–∞–¥–∞–µ—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ï—Å–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

---

## –§–ê–ó–ê 3: –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–•

### –®–∞–≥ 3.1: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `data/users.json` —Å –Ω–∞—á–∞–ª—å–Ω—ã–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º.

**–§–∞–π–ª:** `data/users.json`

```json
{
  "users": [
    {
      "username": "admin",
      "password": "admin",
      "role": "admin"
    }
  ]
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `data/users.json` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞–ª–∏–¥–Ω—ã–π JSON
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –º–∞—Å—Å–∏–≤ `"users"`
- [x] –ú–∞—Å—Å–∏–≤ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å `"username": "admin"`
- [x] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç `"password": "admin"`
- [x] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç `"role": "admin"`

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 3.2: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö IP [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `data/auth_ips.json` —Å –ø—É—Å—Ç—ã–º —Å–ø–∏—Å–∫–æ–º.

**–§–∞–π–ª:** `data/auth_ips.json`

```json
{
  "authorized_ips": {}
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `data/auth_ips.json` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞–ª–∏–¥–Ω—ã–π JSON
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—ä–µ–∫—Ç `"authorized_ips"`
- [x] –û–±—ä–µ–∫—Ç `authorized_ips` –ø—É—Å—Ç–æ–π: `{}`

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 3.3: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ LLM [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `data/llm_config.json` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

**–§–∞–π–ª:** `data/llm_config.json`

```json
{
  "llm_type": "deepseek",
  "deepseek_api_key": "",
  "deepseek_base_url": "https://api.deepseek.com",
  "lmstudio_base_url": "http://localhost:1234/v1",
  "lmstudio_model": "deepseek-coder"
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `data/llm_config.json` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞–ª–∏–¥–Ω—ã–π JSON
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `"llm_type": "deepseek"`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `"deepseek_base_url"`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `"lmstudio_base_url"`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `"lmstudio_model"`

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 3.4: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏—Å—Ç–µ–º—ã [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `data/settings.json` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

**–§–∞–π–ª:** `data/settings.json`

```json
{
  "max_file_size_mb": 50,
  "max_queue_size": 5,
  "max_concurrent_requests": 5,
  "rate_limit_per_minute": 10
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `data/settings.json` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞–ª–∏–¥–Ω—ã–π JSON
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `"max_file_size_mb": 50`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `"max_queue_size": 5`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `"max_concurrent_requests": 5`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `"rate_limit_per_minute": 10`

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 3.5: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `data/tokens_usage.json` —Å –ø—É—Å—Ç–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π.

**–§–∞–π–ª:** `data/tokens_usage.json`

```json
{
  "total_prompt_tokens": 0,
  "total_completion_tokens": 0,
  "total_cost_usd": 0.0,
  "users": {},
  "last_updated": ""
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `data/tokens_usage.json` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤–∞–ª–∏–¥–Ω—ã–π JSON
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `"total_prompt_tokens": 0`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `"total_completion_tokens": 0`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `"total_cost_usd": 0.0`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `"users": {}`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `"last_updated"`

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### üîó **–ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–ï –ü–†–û–í–ï–†–ö–ò –ü–û–°–õ–ï –§–ê–ó–´ 3**

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ JSON —Ñ–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –í—Å–µ JSON —Ñ–∞–π–ª—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –≤–∞–ª–∏–¥–Ω—ã–π JSON
- [x] –ù–∞—á–∞–ª—å–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ú–∏–Ω–∏-—Ç–µ—Å—Ç—ã:**

```bash
# –í–∞–ª–∏–¥–∞—Ü–∏—è JSON —Ñ–∞–π–ª–æ–≤
python -c "import json; json.load(open('data/users.json')); print('users.json OK')"
python -c "import json; json.load(open('data/auth_ips.json')); print('auth_ips.json OK')"
python -c "import json; json.load(open('data/llm_config.json')); print('llm_config.json OK')"
python -c "import json; json.load(open('data/settings.json')); print('settings.json OK')"
python -c "import json; json.load(open('data/tokens_usage.json')); print('tokens_usage.json OK')"
```

**Fallback-—Å—Ü–µ–Ω–∞—Ä–∏–π:**

- –ï—Å–ª–∏ JSON –ø–æ–≤—Ä–µ–∂–¥–µ–Ω ‚Üí –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –∏–∑ —à–∞–±–ª–æ–Ω–∞
- –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å—Ö–µ–º–µ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

## –§–ê–ó–ê 4: –ü–†–û–ú–ü–¢–´ –î–õ–Ø LLM

### –®–∞–≥ 4.1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –≤—ã–∂–∏–º–∫–∏ [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `data/prompts/summary_prompt.txt` —Å –ø—Ä–æ–º–ø—Ç–æ–º –¥–ª—è –≤—ã–∂–∏–º–∫–∏ –¥–æ–≥–æ–≤–æ—Ä–∞.

> ‚ö†Ô∏è **–í–ê–ñ–ù–û:** –°–æ–∑–¥–∞–π—Ç–µ –ß–ò–°–¢–´–ô —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª. –ù–ï –¥–æ–±–∞–≤–ª—è–π—Ç–µ markdown-—Ä–∞–∑–º–µ—Ç–∫—É (```text –∏ —Ç.–¥.). –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –¢–û–õ–¨–ö–û —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É –º–∞—Ä–∫–µ—Ä–∞–º–∏ `--- –ù–ê–ß–ê–õ–û –°–û–î–ï–†–ñ–ò–ú–û–ì–û –§–ê–ô–õ–ê ---` –∏ `--- –ö–û–ù–ï–¶ –°–û–î–ï–†–ñ–ò–ú–û–ì–û –§–ê–ô–õ–ê ---`.

**–§–∞–π–ª:** `data/prompts/summary_prompt.txt`

--- –ù–ê–ß–ê–õ–û –°–û–î–ï–†–ñ–ò–ú–û–ì–û –§–ê–ô–õ–ê ---
##–†–æ–ª—å

–í—ã ‚Äî –æ–ø—ã—Ç–Ω—ã–π —é—Ä–∏—Å—Ç-–∞–Ω–∞–ª–∏—Ç–∏–∫, —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—â–∏–π—Å—è –Ω–∞ –¥–æ–≥–æ–≤–æ—Ä–Ω–æ–º –ø—Ä–∞–≤–µ. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî —Å–∫—Ä—É–ø—É–ª–µ–∑–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä –∏ —Å–æ–∑–¥–∞—Ç—å –µ–≥–æ –¥–µ—Ç–∞–ª—å–Ω—É—é –≤—ã–∂–∏–º–∫—É (legal summary) –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –¥–æ–º—ã—Å–ª–æ–≤, –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–π –∏–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Ç –≤ —Ç–µ–∫—Å—Ç–µ.

##–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö

–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∞ –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–∞. –ï—Å–ª–∏ –∫–∞–∫–æ–π-–ª–∏–±–æ –ø—É–Ω–∫—Ç –≤ –¥–æ–≥–æ–≤–æ—Ä–µ –Ω–µ –æ—Å–≤–µ—â–µ–Ω, –ø—Ä—è–º–æ —É–∫–∞–∂–∏—Ç–µ –Ω–∞ —ç—Ç–æ.

##–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∞–Ω–∞–ª–∏–∑—É

–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∏—Ç–µ –≤–µ—Å—å —Ç–µ–∫—Å—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –¥–æ–≥–æ–≤–æ—Ä–∞, –≤–∫–ª—é—á–∞—è –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏—è, –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã.

–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–π—Ç–µ –≤—ã–≤–æ–¥ —Å—Ç—Ä–æ–≥–æ –ø–æ —Å–ª–µ–¥—É—é—â–∏–º —Ä–∞–∑–¥–µ–ª–∞–º.

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–≤–æ–¥–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø—É–Ω–∫—Ç—ã, –ø–æ–¥–ø—É–Ω–∫—Ç—ã, —Å—Ç–∞—Ç—å–∏ –∏, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ, –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–≥–æ–≤–æ—Ä–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö –æ–Ω–∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ø. 3.1 –î–æ–≥–æ–≤–æ—Ä–∞, —Å. 2", "—Å—Ç. 5, —Å. 3", "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ 1, —Å. 7").

–ò–∑–ª–∞–≥–∞–π—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ, —Å–∂–∞—Ç–æ –∏ —Ç–æ—á–Ω–æ, –ø–µ—Ä–µ—Ñ—Ä–∞–∑–∏—Ä—É—è –∏ —Ü–∏—Ç–∏—Ä—É—è –∫–ª—é—á–µ–≤—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏ –∏–∑ –¥–æ–≥–æ–≤–æ—Ä–∞.

##–¢—Ä–µ–±—É–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤—ã–∂–∏–º–∫–∏

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –∞–Ω–∞–ª–∏–∑ –≤ –≤–∏–¥–µ —Ç–∞–±–ª–∏—Ü—ã —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏:

–†–∞–∑–¥–µ–ª –∞–Ω–∞–ª–∏–∑–∞ (–Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –Ω–∏–∂–µ)

–°—É—Ç—å –ø–æ–ª–æ–∂–µ–Ω–∏—è (–∫—Ä–∞—Ç–∫–æ–µ –∏–∑–ª–æ–∂–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏—è)

–°—Å—ã–ª–∫–∞ –Ω–∞ –ø—É–Ω–∫—Ç –¥–æ–≥–æ–≤–æ—Ä–∞ (—Ç–æ—á–Ω—ã–π –∞–¥—Ä–µ—Å –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º —É–∫–∞–∑–∞–Ω–∏–µ–º –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)

##–†–∞–∑–¥–µ–ª—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

–†–∞–∑–¥–µ–ª –∞–Ω–∞–ª–∏–∑–∞	–ß—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–¥–µ–ª–∏—Ç—å –∏ –æ–ø–∏—Å–∞—Ç—å

1. –°—Ç–æ—Ä–æ–Ω—ã –¥–æ–≥–æ–≤–æ—Ä–∞	–ü–æ–ª–Ω—ã–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è/–§–ò–û –ó–∞–∫–∞–∑—á–∏–∫–∞ –∏ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (–∏–ª–∏ –ü–æ—Å—Ç–∞–≤—â–∏–∫–∞/–ü–æ–∫—É–ø–∞—Ç–µ–ª—è –∏ —Ç.–¥.).
2. –ü—Ä–µ–¥–º–µ—Ç –¥–æ–≥–æ–≤–æ—Ä–∞	–ß–µ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≥–æ, –∫–∞–∫–∏–µ —É—Å–ª—É–≥–∏, —Ä–∞–±–æ—Ç—ã, —Ç–æ–≤–∞—Ä—ã —è–≤–ª—è—é—Ç—Å—è –ø—Ä–µ–¥–º–µ—Ç–æ–º –¥–æ–≥–æ–≤–æ—Ä–∞.
3. –°—Ä–æ–∫–∏	–î–∞—Ç—ã –Ω–∞—á–∞–ª–∞ –∏ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞, —Å—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∞–ø–æ–≤ —Ä–∞–±–æ—Ç/–æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥/–ø–æ—Å—Ç–∞–≤–∫–∏. –£—Å–ª–æ–≤–∏—è –ø—Ä–æ–¥–ª–µ–Ω–∏—è.
4. –ü–æ—Ä—è–¥–æ–∫ –æ–ø–ª–∞—Ç—ã	–ü–æ–ª–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å, —Ñ–æ—Ä–º–∞ –æ–ø–ª–∞—Ç—ã (–±–µ–∑–Ω–∞–ª, –Ω–∞–ª–∏—á–Ω—ã–µ), —ç—Ç–∞–ø—ã –∏ —Å—Ä–æ–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π, –∞–≤–∞–Ω—Å–æ–≤—ã–µ –ø–ª–∞—Ç–µ–∂–∏, –ø–æ—Ä—è–¥–æ–∫ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–æ–≤ –∏ –∞–∫—Ç–æ–≤.
5. –ü—Ä–∞–≤–∞ –∏ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ —Å—Ç–æ—Ä–æ–Ω	–ü–æ –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω–µ –æ—Ç–¥–µ–ª—å–Ω–æ: –ø–µ—Ä–µ—á–∏—Å–ª–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–∞–≤–∞, —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ –¥–æ–≥–æ–≤–æ—Ä–µ.
6. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç–æ—Ä–æ–Ω	–£—Å–ª–æ–≤–∏—è, –ø—Ä–∏ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–∞—Å—Ç—É–ø–∞–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å. –í–∏–¥—ã –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ –¥–æ–≥–æ–≤–æ—Ä–æ–º.
7. –ù–µ—É—Å—Ç–æ–π–∫–∏ (—à—Ç—Ä–∞—Ñ—ã, –ø–µ–Ω–∏)	–í–ù–ò–ú–ê–ù–ò–ï: –ù–ï–û–ë–•–û–î–ò–ú–û –í–´–Ø–í–ò–¢–¨ –ò –£–ö–ê–ó–ê–¢–¨ –í–°–ï –ë–ï–ó –ò–°–ö–õ–Æ–ß–ï–ù–ò–Ø –®–¢–†–ê–§–ù–´–ï –°–ê–ù–ö–¶–ò–ò, –ü–†–ï–î–£–°–ú–û–¢–†–ï–ù–ù–´–ï –î–û–ì–û–í–û–†–û–ú. –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –∏ —Ñ–æ—Ä–º—É–ª—ã: —Ä–∞–∑–º–µ—Ä —à—Ç—Ä–∞—Ñ–æ–≤, –ø—Ä–æ—Ü–µ–Ω—Ç –ø–µ–Ω–∏, –ø–æ—Ä—è–¥–æ–∫ –∏—Ö –∏—Å—á–∏—Å–ª–µ–Ω–∏—è –∏ –≤–∑—ã—Å–∫–∞–Ω–∏—è –∑–∞ –∫–∞–∂–¥—ã–π –≤–∏–¥ –Ω–∞—Ä—É—à–µ–Ω–∏—è (–ø—Ä–æ—Å—Ä–æ—á–∫–∞ –æ–ø–ª–∞—Ç—ã, –ø—Ä–æ—Å—Ä–æ—á–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤, –Ω–∞—Ä—É—à–µ–Ω–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã—Ö –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –∏ —Ç.–¥.). –ï—Å–ª–∏ –∑–∞ –∫–∞–∫–æ–µ-–ª–∏–±–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –Ω–µ—É—Å—Ç–æ–π–∫–∞ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞, –ø—Ä—è–º–æ —É–∫–∞–∂–∏—Ç–µ —ç—Ç–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–ù–µ—É—Å—Ç–æ–π–∫–∞ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ —Å—Ä–æ–∫–æ–≤ –ø—Ä–∏–µ–º–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞–±–æ—Ç –¥–æ–≥–æ–≤–æ—Ä–æ–º –Ω–µ –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–∞").
8. –†–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞	–û—Å–Ω–æ–≤–∞–Ω–∏—è –∏ –ø–æ—Ä—è–¥–æ–∫ –¥–ª—è –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–≥–æ —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏—è, –∞ —Ç–∞–∫–∂–µ —Ä–∞—Å—Ç–æ—Ä–∂–µ–Ω–∏—è –ø–æ —Å–æ–≥–ª–∞—à–µ–Ω–∏—é —Å—Ç–æ—Ä–æ–Ω. –°—Ä–æ–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
9. –ü—Ä–æ—á–∏–µ –∫–ª—é—á–µ–≤—ã–µ —É—Å–ª–æ–≤–∏—è	–í–∞–∂–Ω–æ: –í—ã—è–≤–∏—Ç–µ –∏ –æ–ø–∏—à–∏—Ç–µ "–ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏" –∏ —Ä–∏—Å–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä—è–º–æ —Å–ª–µ–¥—É—é—Ç –∏–∑ —Ç–µ–∫—Å—Ç–∞.
   ‚Ä¢ –§–æ—Ä—Å-–º–∞–∂–æ—Ä: —É—Å–ª–æ–≤–∏—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.
   ‚Ä¢ –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å: –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–æ–µ —É—Å–ª–æ–≤–∏–µ.
   ‚Ä¢ –ü–æ—Ä—è–¥–æ–∫ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å–ø–æ—Ä–æ–≤: –¥–æ—Å—É–¥–µ–±–Ω—ã–π –ø—Ä–µ—Ç–µ–Ω–∑–∏–æ–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫, –ø–æ–¥—Å—É–¥–Ω–æ—Å—Ç—å (—Å—É–¥, –∞—Ä–±–∏—Ç—Ä–∞–∂).
   ‚Ä¢ –ü—Ä–æ—á–∏–µ —É—Å–ª–æ–≤–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ–≥–æ–≤–æ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É—Å–ª–æ–≤–∏—è –æ –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã—Ö –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞—Ö, –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–µ–º–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, —É—Å—Ç—É–ø–∫–µ –ø—Ä–∞–≤).
10. –†–µ–∫–≤–∏–∑–∏—Ç—ã –∏ –ø–æ–¥–ø–∏—Å–∏	–ù–∞–ª–∏—á–∏–µ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–µ–∫–≤–∏–∑–∏—Ç–æ–≤ —Å—Ç–æ—Ä–æ–Ω, –ø–æ–¥–ø–∏—Å–µ–π, –ø–µ—á–∞—Ç–µ–π.

##–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ —É–∫–∞–∑–∞–Ω–∏—è

–ó–∞–ø—Ä–µ—Ç –Ω–∞ —Ñ–∞–Ω—Ç–∞–∑–∏—é: –ï—Å–ª–∏ –≤ –¥–æ–≥–æ–≤–æ—Ä–µ –∫–∞–∫–æ–π-–ª–∏–±–æ –∞—Å–ø–µ–∫—Ç –Ω–µ —É—Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–µ—É—Å—Ç–æ–π–∫–∞ –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É –æ–ø–ª–∞—Ç—ã –Ω–µ —É–∫–∞–∑–∞–Ω–∞), —Ç–∞–∫ –∏ –ø–∏—à–∏—Ç–µ: "–ü–æ–ª–æ–∂–µ–Ω–∏–µ –æ –Ω–µ—É—Å—Ç–æ–π–∫–µ –∑–∞ –ø—Ä–æ—Å—Ä–æ—á–∫—É –æ–ø–ª–∞—Ç—ã –≤ –¥–æ–≥–æ–≤–æ—Ä–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç". –ù–µ –ø—Ä–µ–¥–ª–∞–≥–∞–π—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

–¢–æ—á–Ω–æ—Å—Ç—å —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —Å—Å—ã–ª–æ–∫: –ü—Ä–∏–≤–æ–¥–∏—Ç–µ –¥–æ—Å–ª–æ–≤–Ω—ã–µ —Ü–∏—Ç–∞—Ç—ã –∏–∑ –¥–æ–≥–æ–≤–æ—Ä–∞ –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ –Ω–µ—É—Å—Ç–æ–π–∫–µ: "–ö–∞–∫ —É–∫–∞–∑–∞–Ω–æ –≤ –ø. 7.2, —Å. 4: '...–≤ —Ä–∞–∑–º–µ—Ä–µ 0,1% –æ—Ç —Å—É–º–º—ã –¥–æ–≥–æ–≤–æ—Ä–∞ –∑–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–æ—Å—Ä–æ—á–∫–∏...'"). –ö–∞–∂–¥–∞—è —Å—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤—ã—è–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —Å–∞–Ω–∫—Ü–∏–π: –ü—Ä–æ—è–≤–∏—Ç–µ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –∫ —Ä–∞–∑–¥–µ–ª—É 7 (–ù–µ—É—Å—Ç–æ–π–∫–∏). –¢—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –Ω–µ —Ç–æ–ª—å–∫–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ä–∞–∑–¥–µ–ª –æ–± –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, –Ω–æ –∏ –≤—Å–µ –ø—É–Ω–∫—Ç—ã –¥–æ–≥–æ–≤–æ—Ä–∞ (–æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç–∏, —Å—Ä–æ–∫–∏, –ø—Ä–∏–µ–º–∫–∞) –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç —Å–∫—Ä—ã—Ç—ã—Ö —à—Ç—Ä–∞—Ñ–Ω—ã—Ö –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π –∏—Ö –Ω–∞—Ä—É—à–µ–Ω–∏—è.

–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ—Å—Ç—å: –ò–∑–±–µ–≥–∞–π—Ç–µ –æ—Ü–µ–Ω–æ—á–Ω—ã—Ö —Å—É–∂–¥–µ–Ω–∏–π ("—ç—Ç–æ –Ω–µ–≤—ã–≥–æ–¥–Ω–æ–µ —É—Å–ª–æ–≤–∏–µ"). –ö–æ–Ω—Å—Ç–∞—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–∫—Ç—ã. –†–∏—Å–∫–∏ –æ–ø–∏—Å—ã–≤–∞–π—Ç–µ –∫–∞–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è, –≤—ã—Ç–µ–∫–∞—é—â–∏–µ –∏–∑ —Ç–µ–∫—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "–í –ø. 4.5, —Å. 3 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —á—Ç–æ –æ–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –≤ –ø–æ–ª–Ω–æ–º –æ–±—ä–µ–º–µ –¥–æ –Ω–∞—á–∞–ª–∞ –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥, —á—Ç–æ —Å–æ–∑–¥–∞–µ—Ç —Ä–∏—Å–∫ –Ω–µ–∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–º –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã").

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Ç–µ–∫—Å—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–∞: –ï—Å–ª–∏ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è—Ö –µ—Å—Ç—å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º, —É–∫–∞–∂–∏—Ç–µ –Ω–∞ —ç—Ç–æ, –Ω–æ –æ—Ä–∏–µ–Ω—Ç–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–µ–∫—Å—Ç, –µ—Å–ª–∏ –∏–Ω–æ–µ –Ω–µ –æ–≥–æ–≤–æ—Ä–µ–Ω–æ.

##–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞

–ù–∞—á–Ω–∏—Ç–µ —Å –æ–±—â–µ–≥–æ –≤—ã–≤–æ–¥–∞: "–ù–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–∞ ‚Ññ [—É–∫–∞–∑–∞—Ç—å –Ω–æ–º–µ—Ä, –µ—Å–ª–∏ –µ—Å—Ç—å] –æ—Ç [—É–∫–∞–∑–∞—Ç—å –¥–∞—Ç—É] –º–µ–∂–¥—É [–∫—Ä–∞—Ç–∫–æ —É–∫–∞–∑–∞—Ç—å —Å—Ç–æ—Ä–æ–Ω—ã] —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ —Å–ª–µ–¥—É—é—â–∞—è –≤—ã–∂–∏–º–∫–∞." –ó–∞—Ç–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤—ã—à–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ.
--- –ö–û–ù–ï–¶ –°–û–î–ï–†–ñ–ò–ú–û–ì–û –§–ê–ô–õ–ê ---

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `data/prompts/summary_prompt.txt` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ß–ò–°–¢–´–ô —Ç–µ–∫—Å—Ç (–ë–ï–ó markdown-—Ä–∞–∑–º–µ—Ç–∫–∏ —Ç–∏–ø–∞ \`\`\`text)
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç (–Ω–µ –º–µ–Ω–µ–µ 1000 —Å–∏–º–≤–æ–ª–æ–≤)
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `##–†–æ–ª—å`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `##–†–∞–∑–¥–µ–ª—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ 10 —Ä–∞–∑–¥–µ–ª–∞—Ö –∞–Ω–∞–ª–∏–∑–∞

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 4.2: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `data/prompts/legal_check_prompt.txt` —Å –ø—Ä–æ–º–ø—Ç–æ–º –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞.

> ‚ö†Ô∏è **–í–ê–ñ–ù–û:** –°–æ–∑–¥–∞–π—Ç–µ –ß–ò–°–¢–´–ô —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª. –ù–ï –¥–æ–±–∞–≤–ª—è–π—Ç–µ markdown-—Ä–∞–∑–º–µ—Ç–∫—É (```text –∏ —Ç.–¥.). –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –¢–û–õ–¨–ö–û —Ç–µ–∫—Å—Ç –º–µ–∂–¥—É –º–∞—Ä–∫–µ—Ä–∞–º–∏ `--- –ù–ê–ß–ê–õ–û –°–û–î–ï–†–ñ–ò–ú–û–ì–û –§–ê–ô–õ–ê ---` –∏ `--- –ö–û–ù–ï–¶ –°–û–î–ï–†–ñ–ò–ú–û–ì–û –§–ê–ô–õ–ê ---`.

**–§–∞–π–ª:** `data/prompts/legal_check_prompt.txt`

--- –ù–ê–ß–ê–õ–û –°–û–î–ï–†–ñ–ò–ú–û–ì–û –§–ê–ô–õ–ê ---
##–†–æ–ª—å –∏ –∑–∞–¥–∞—á–∞:

–í—ã ‚Äî –ò–ò-—é—Ä–∏—Å—Ç, —É–∑–∫–æ—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —ç–∫—Å–ø–µ—Ä—Ç –ø–æ —Ä–æ—Å—Å–∏–π—Å–∫–æ–º—É –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–º—É, —Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω–æ–º—É –∏ –¥–æ–≥–æ–≤–æ—Ä–Ω–æ–º—É –ø—Ä–∞–≤—É. –í–∞—à–∞ –æ—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ–≤–µ—Å—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–∞ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –µ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –¥–µ–π—Å—Ç–≤—É—é—â–µ–º—É —Ä–æ—Å—Å–∏–π—Å–∫–æ–º—É –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É.

##–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:

–¢–æ—á–Ω–æ—Å—Ç—å –∏ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å: –í—Å–µ –≤—ã–≤–æ–¥—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Å–Ω–æ–≤–∞–Ω—ã –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –Ω–æ—Ä–º–∞—Ö —Ä–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –ø—Ä–∞–≤–∞. –ó–∞–ø—Ä–µ—â–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–∫–æ–Ω—ã, –Ω–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–ª–∏ –¥–æ–º—ã—Å–ª—ã.

–û–±—ä–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: –í—ã –Ω–µ –¥–æ–ª–∂–Ω—ã –¥–∞–≤–∞—Ç—å —Å—É–±—ä–µ–∫—Ç–∏–≤–Ω—ã—Ö –æ—Ü–µ–Ω–æ–∫, —Å–æ–≤–µ—Ç–æ–≤ –ø–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –≤–µ–¥–µ–Ω–∏—è –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤ –∏–ª–∏ —Ñ–∞–Ω—Ç–∞–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ–º—É "—á—Ç–æ –∏–º–µ–ª –≤ –≤–∏–¥—É —Å—Ç–æ—Ä–æ–Ω–∞". –í–∞—à –∞–Ω–∞–ª–∏–∑ ‚Äî —ç—Ç–æ —Ç–æ–ª—å–∫–æ —Å–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–∞ —Å –±—É–∫–≤–æ–π –∑–∞–∫–æ–Ω–∞.

–ù–µ–¥–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç—å –æ—à–∏–±–æ–∫: –ö–∞–∂–¥–æ–µ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ –Ω–∞—Ä—É—à–µ–Ω–∏–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–æ—Å–ø–æ—Ä–∏–º–æ –ø–æ–¥–∫—Ä–µ–ø–ª–µ–Ω–æ —Å—Å—ã–ª–∫–æ–π –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–π –∞–∫—Ç. –í —Å–ª—É—á–∞–µ –º–∞–ª–µ–π—à–µ–π –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏ –∏–ª–∏ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—è –≤ —Å—É–¥–µ–±–Ω–æ–π –ø—Ä–∞–∫—Ç–∏–∫–µ, –≤—ã –æ–±—è–∑–∞–Ω—ã —á–µ—Ç–∫–æ —É–∫–∞–∑–∞—Ç—å –Ω–∞ —ç—Ç–æ, –æ—Ç–º–µ—Ç–∏–≤, —á—Ç–æ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–π —Ç—Ä–∞–∫—Ç–æ–≤–∫–∏ –Ω–µ—Ç.

##–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∞–Ω–∞–ª–∏–∑—É:

##I. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É:

–°–∫—Ä—É–ø—É–ª–µ–∑–Ω–æ –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∫–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç –¥–æ–≥–æ–≤–æ—Ä–∞. –û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª–∏—Ç–µ:

–ü—Ä–µ–¥–º–µ—Ç—É –¥–æ–≥–æ–≤–æ—Ä–∞.

–ü—Ä–∞–≤–∞–º, –æ–±—è–∑–∞–Ω–Ω–æ—Å—Ç—è–º –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ —Å—Ç–æ—Ä–æ–Ω.

–¶–µ–Ω–µ, –ø–æ—Ä—è–¥–∫—É —Ä–∞—Å—á–µ—Ç–æ–≤ –∏ —Å—Ä–æ–∫–∞–º.

–û–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞–º –Ω–µ–ø—Ä–µ–æ–¥–æ–ª–∏–º–æ–π —Å–∏–ª—ã (—Ñ–æ—Ä—Å-–º–∞–∂–æ—Ä).

–ü–æ—Ä—è–¥–∫—É —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è —Å–ø–æ—Ä–æ–≤.

–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏.

–ó–∞–∫–ª—é—á–∏—Ç–µ–ª—å–Ω—ã–º –ø–æ–ª–æ–∂–µ–Ω–∏—è–º.

–í—ã—è–≤–ª—è—è –Ω–∞—Ä—É—à–µ–Ω–∏–µ, –¥–µ–π—Å—Ç–≤—É–π—Ç–µ –ø–æ —Å–ª–µ–¥—É—é—â–µ–º—É –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É:

–®–∞–≥ 1: –£–∫–∞–∂–∏—Ç–µ —Ç–æ—á–Ω—ã–π –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞/–ø—É–Ω–∫—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–∞, –≥–¥–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ –Ω–∞—Ä—É—à–µ–Ω–∏–µ.

–®–∞–≥ 2: –î–æ—Å–ª–æ–≤–Ω–æ –ø—Ä–∏–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –ø—É–Ω–∫—Ç–∞ –¥–æ–≥–æ–≤–æ—Ä–∞ (–∏–ª–∏ –µ–≥–æ –ø—Ä–æ–±–ª–µ–º–Ω—É—é —á–∞—Å—Ç—å), –∫–æ—Ç–æ—Ä—ã–π, –ø–æ –≤–∞—à–µ–º—É –º–Ω–µ–Ω–∏—é, –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –∑–∞–∫–æ–Ω—É.

–®–∞–≥ 3: –£–∫–∞–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –Ω–æ—Ä–º—É –ø—Ä–∞–≤–∞, –∫–æ—Ç–æ—Ä–∞—è –Ω–∞—Ä—É—à–∞–µ—Ç—Å—è. –°—Å—ã–ª–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∞–±—Å–æ–ª—é—Ç–Ω–æ —Ç–æ—á–Ω–æ–π:

–î–ª—è –∫–æ–¥–µ–∫—Å–æ–≤: ¬´–°—Ç–∞—Ç—å—è 123 –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–≥–æ –∫–æ–¥–µ–∫—Å–∞ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏ (–ì–ö –†–§)¬ª.

–î–ª—è —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –∑–∞–∫–æ–Ω–æ–≤: ¬´*–ü—É–Ω–∫—Ç 2 —Å—Ç–∞—Ç—å–∏ 5 –§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–∞ –æ—Ç 07.02.1992 ‚Ññ 2300-1 "–û –∑–∞—â–∏—Ç–µ –ø—Ä–∞–≤ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π"*¬ª.

–î–ª—è –∏–Ω—ã—Ö –∞–∫—Ç–æ–≤: –£–∫–∞–∑–∞—Ç—å –ø–æ–ª–Ω–æ–µ –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ, –Ω–æ–º–µ—Ä –∏ –¥–∞—Ç—É –ø—Ä–∏–Ω—è—Ç–∏—è –∞–∫—Ç–∞, –∞ —Ç–∞–∫–∂–µ –Ω–æ–º–µ—Ä —Å—Ç–∞—Ç—å–∏, –ø—É–Ω–∫—Ç–∞, –ø–∞—Ä–∞–≥—Ä–∞—Ñ–∞.

##II. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞:

–°—Ñ–æ—Ä–º–∏—Ä—É–π—Ç–µ –æ—Ç–≤–µ—Ç –≤ –≤–∏–¥–µ —á–µ—Ç–∫–æ–≥–æ –æ—Ç—á–µ—Ç–∞. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω–Ω—ã—Ö –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π.

–í–∞—Ä–∏–∞–Ω—Ç 1: –ù–∞—Ä—É—à–µ–Ω–∏—è –≤—ã—è–≤–ª–µ–Ω—ã.

# –û—Ç—á–µ—Ç –æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ –¥–æ–≥–æ–≤–æ—Ä–∞ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É –†–§

**–û–±—â–∏–π –≤–µ—Ä–¥–∏–∫—Ç:** –î–æ–≥–æ–≤–æ—Ä —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–æ–∂–µ–Ω–∏—è, –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—â–∏–µ –¥–µ–π—Å—Ç–≤—É—é—â–µ–º—É –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É –†–§.

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è:

| ‚Ññ | –ù–∞—Ä—É—à–µ–Ω–∏–µ (—Å—É—Ç—å)                 | –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –¥–æ–≥–æ–≤–æ—Ä–µ                                                  | –¢–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞ (–≤—ã–¥–µ—Ä–∂–∫–∞)                                                                                                                                                                                                | –ù–∞—Ä—É—à–µ–Ω–Ω–∞—è –Ω–æ—Ä–º–∞ –ø—Ä–∞–≤–∞ | –ü—Ä–∞–≤–æ–≤–æ–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                                                                                                                                                                                                                                                                                                 |
| -- | --------------------------------------------- | ------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1  | –ù–µ—Å–æ—Ä–∞–∑–º–µ—Ä–Ω–∞—è –Ω–µ—É—Å—Ç–æ–π–∫–∞ | –°—Ç—Ä–∞–Ω–∏—Ü–∞ 5, –†–∞–∑–¥–µ–ª 4 "–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å —Å—Ç–æ—Ä–æ–Ω", –ü—É–Ω–∫—Ç 4.2. | "–í —Å–ª—É—á–∞–µ –ø—Ä–æ—Å—Ä–æ—á–∫–∏ –æ–ø–ª–∞—Ç—ã –±–æ–ª–µ–µ —á–µ–º –Ω–∞ 3 –¥–Ω—è, –ó–∞–∫–∞–∑—á–∏–∫ —É–ø–ª–∞—á–∏–≤–∞–µ—Ç –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é –Ω–µ—É—Å—Ç–æ–π–∫—É –≤ —Ä–∞–∑–º–µ—Ä–µ 50% –æ—Ç –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –î–æ–≥–æ–≤–æ—Ä–∞." | –°—Ç–∞—Ç—å—è 333 –ì–ö –†–§                 | –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –Ω–µ—É—Å—Ç–æ–π–∫–∞ –≤ —Ä–∞–∑–º–µ—Ä–µ 50% –æ—Ç —Å—É–º–º—ã –¥–æ–≥–æ–≤–æ—Ä–∞ –∑–∞ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è —è–≤–Ω–æ –Ω–µ—Å–æ—Ä–∞–∑–º–µ—Ä–Ω–æ–π –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è–º –Ω–∞—Ä—É—à–µ–Ω–∏—è –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —É–º–µ–Ω—å—à–µ–Ω–∞ —Å—É–¥–æ–º. |

–í–∞—Ä–∏–∞–Ω—Ç 2: –ù–∞—Ä—É—à–µ–Ω–∏–π –Ω–µ –≤—ã—è–≤–ª–µ–Ω–æ.

# –û—Ç—á–µ—Ç –æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ –¥–æ–≥–æ–≤–æ—Ä–∞ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É –†–§

**–û–±—â–∏–π –≤–µ—Ä–¥–∏–∫—Ç:** –ü–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞, —è–≤–Ω—ã—Ö –Ω–∞—Ä—É—à–µ–Ω–∏–π –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã—Ö –Ω–æ—Ä–º –¥–µ–π—Å—Ç–≤—É—é—â–µ–≥–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏ –≤ —Ç–µ–∫—Å—Ç–µ –¥–æ–≥–æ–≤–æ—Ä–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ.

| –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ | –î–µ—Ç–∞–ª–∏                                                                                                                                                                                                                                                    |
| ----------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ:** | –í—Å–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø—É–Ω–∫—Ç—ã –¥–æ–≥–æ–≤–æ—Ä–∞ –Ω–µ –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∞—Ç –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω—ã–º –Ω–æ—Ä–º–∞–º –ì—Ä–∞–∂–¥–∞–Ω—Å–∫–æ–≥–æ –∫–æ–¥–µ–∫—Å–∞ –†–§ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –∑–∞–∫–æ–Ω–æ–≤.                   |
| **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:**     | –ù–∞—Å—Ç–æ—è—â–∏–π –∞–Ω–∞–ª–∏–∑ –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç –æ—Ü–µ–Ω–∫—É –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö —Ä–∏—Å–∫–æ–≤, –Ω–∞–ª–æ–≥–æ–≤—ã—Ö –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π –∏–ª–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–æ–π —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ—Å—Ç–∏ –∑–∞–∫–ª—é—á–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–∞. |

##III. –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:

–ó–∞–ø—Ä–µ—â–µ–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—â—É—é—Å—è –≤ –¥–æ–≥–æ–≤–æ—Ä–µ –∏–ª–∏ –≤ –∑–∞–∫–æ–Ω–µ.

–ó–∞–ø—Ä–µ—â–µ–Ω–æ –¥–∞–≤–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Ç–∏–ø–∞ "–ª—É—á—à–µ –∏–∑–º–µ–Ω–∏—Ç—å" –∏–ª–∏ "—Å–æ–≤–µ—Ç—É—é –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å". –í—ã —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Å—Ç–∞—Ç–∏—Ä—É–µ—Ç–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∏ –¥–∞–µ—Ç–µ –ø—Ä–∞–≤–æ–≤–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ.

–ó–∞–ø—Ä–µ—â–µ–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –Ω–∞ –æ—Å–Ω–æ–≤–µ "—Å–ª–æ–∂–∏–≤—à–µ–π—Å—è –ø—Ä–∞–∫—Ç–∏–∫–∏" –±–µ–∑ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∑–∞–∫–æ–Ω. –ï—Å–ª–∏ –Ω–æ—Ä–º–∞ –¥–∏—Å–ø–æ–∑–∏—Ç–∏–≤–Ω–∞ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ç–æ—Ä–æ–Ω–∞–º –¥–æ–≥–æ–≤–æ—Ä–∏—Ç—å—Å—è, –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –∫–≤–∞–ª–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ –∫–∞–∫ –Ω–∞—Ä—É—à–µ–Ω–∏–µ.

–ö—Ä–∏—Ç–µ—Ä–∏–π —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: –ü—Ä–∞–≤–æ–≤–æ–π –∞–Ω–∞–ª–∏–∑, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –º–æ–∂–Ω–æ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –≤ —Å—É–¥–µ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–ª—é—á–µ–Ω–∏—è –ø–æ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–º –ø—Ä–∞–≤–æ–≤—ã–º –æ—Å–Ω–æ–≤–∞–Ω–∏—è–º –¥–æ–≥–æ–≤–æ—Ä–∞.
--- –ö–û–ù–ï–¶ –°–û–î–ï–†–ñ–ò–ú–û–ì–û –§–ê–ô–õ–ê ---

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `data/prompts/legal_check_prompt.txt` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ß–ò–°–¢–´–ô —Ç–µ–∫—Å—Ç (–ë–ï–ó markdown-—Ä–∞–∑–º–µ—Ç–∫–∏ —Ç–∏–ø–∞ \`\`\`text)
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç (–Ω–µ –º–µ–Ω–µ–µ 1000 —Å–∏–º–≤–æ–ª–æ–≤)
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `##–†–æ–ª—å –∏ –∑–∞–¥–∞—á–∞:`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `##–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `##–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞:`

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 4.3: –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –≤ defaults [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –æ–±–∞ —Ñ–∞–π–ª–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ –≤ –ø–∞–ø–∫—É `defaults` –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–±—Ä–æ—Å–∞.

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (Windows PowerShell):**

```powershell
Copy-Item "data\prompts\summary_prompt.txt" -Destination "data\prompts\defaults\summary_prompt.txt"
Copy-Item "data\prompts\legal_check_prompt.txt" -Destination "data\prompts\defaults\legal_check_prompt.txt"
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `data/prompts/defaults/summary_prompt.txt` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª `data/prompts/defaults/legal_check_prompt.txt` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –û–±–∞ —Ñ–∞–π–ª–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã –æ—Ä–∏–≥–∏–Ω–∞–ª–∞–º (–∏–∑ `data/prompts/`)

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### üîó **–ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–ï –ü–†–û–í–ï–†–ö–ò –ü–û–°–õ–ï –§–ê–ó–´ 4**

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–æ–º–ø—Ç—ã —Å–æ–∑–¥–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –û–±–∞ –ø—Ä–æ–º–ø—Ç–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç (–Ω–µ markdown)
- [x] –§–∞–π–ª—ã defaults –∏–¥–µ–Ω—Ç–∏—á–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–º –ø—Ä–æ–º–ø—Ç–∞–º
- [x] –ü—Ä–æ–º–ø—Ç—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–ª—é—á–µ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏–∑ –¢–ó
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–º–ø—Ç–æ–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ú–∏–Ω–∏-—Ç–µ—Å—Ç—ã:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤
ls -la data/prompts/
ls -la data/prompts/defaults/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ (–Ω–µ –ø—É—Å—Ç—ã–µ)
wc -l data/prompts/summary_prompt.txt
wc -l data/prompts/legal_check_prompt.txt

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
grep -q "##–†–æ–ª—å" data/prompts/summary_prompt.txt && echo "Summary prompt OK"
grep -q "##–†–æ–ª—å –∏ –∑–∞–¥–∞—á–∞:" data/prompts/legal_check_prompt.txt && echo "Legal check prompt OK"
```

**Fallback-—Å—Ü–µ–Ω–∞—Ä–∏–π:**

- –ï—Å–ª–∏ –ø—Ä–æ–º–ø—Ç –ø–æ–≤—Ä–µ–∂–¥–µ–Ω ‚Üí –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ defaults
- –ï—Å–ª–∏ defaults –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç ‚Üí –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –ø–æ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

---

## –§–ê–ó–ê 5: PYDANTIC –ú–û–î–ï–õ–ò

### –®–∞–≥ 5.1: –°–æ–∑–¥–∞–Ω–∏–µ Pydantic –º–æ–¥–µ–ª–µ–π [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/models/schemas.py` —Å –º–æ–¥–µ–ª—è–º–∏ –¥–∞–Ω–Ω—ã—Ö.

**–§–∞–π–ª:** `backend/models/schemas.py`

```python
from pydantic import BaseModel, Field
from typing import Optional, Literal

# ===== –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø =====

class LoginRequest(BaseModel):
    username: str = Field(..., min_length=1, max_length=50)
    password: str = Field(..., min_length=1, max_length=100)

class LoginResponse(BaseModel):
    success: bool
    message: str
    ip: Optional[str] = None

class AuthCheckResponse(BaseModel):
    authorized: bool
    username: Optional[str] = None
    role: Optional[str] = None
    ip: Optional[str] = None

# ===== –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò =====

class UserBase(BaseModel):
    username: str = Field(..., min_length=1, max_length=50)
    role: Literal["admin", "user"] = "user"

class UserCreate(UserBase):
    password: str = Field(..., min_length=1, max_length=100)

class UserUpdate(BaseModel):
    password: Optional[str] = Field(None, min_length=1, max_length=100)
    role: Optional[Literal["admin", "user"]] = None

class UserResponse(UserBase):
    pass

# ===== –ê–ù–ê–õ–ò–ó –î–û–ì–û–í–û–†–û–í =====

class AnalyzeRequest(BaseModel):
    analysis_type: Literal["summary", "legal_check"]

class AnalyzeResponse(BaseModel):
    success: bool
    analysis_type: Optional[str] = None
    result: Optional[str] = None
    filename: Optional[str] = None
    error: Optional[str] = None
    queued: Optional[bool] = False
    message: Optional[str] = None

# ===== –≠–ö–°–ü–û–†–¢ =====

class ExportRequest(BaseModel):
    content: str
    filename: str = "–ê–Ω–∞–ª–∏–∑_–¥–æ–≥–æ–≤–æ—Ä–∞"

# ===== –ü–†–û–ú–ü–¢–´ =====

class PromptsResponse(BaseModel):
    success: bool
    prompts: dict

class PromptSaveRequest(BaseModel):
    prompt_type: Literal["summary", "legal_check"]
    content: str

class PromptResetRequest(BaseModel):
    prompt_type: Literal["summary", "legal_check"]

# ===== –ù–ê–°–¢–†–û–ô–ö–ò LLM =====

class LLMConfigResponse(BaseModel):
    success: bool
    config: dict

class LLMConfigUpdate(BaseModel):
    llm_type: Optional[Literal["deepseek", "lmstudio"]] = None
    deepseek_api_key: Optional[str] = None
    deepseek_base_url: Optional[str] = None
    lmstudio_base_url: Optional[str] = None
    lmstudio_model: Optional[str] = None

# ===== –ù–ê–°–¢–†–û–ô–ö–ò –°–ò–°–¢–ï–ú–´ =====

class SettingsResponse(BaseModel):
    success: bool
    settings: dict

class SettingsUpdate(BaseModel):
    max_file_size_mb: Optional[int] = None
    max_queue_size: Optional[int] = None
    max_concurrent_requests: Optional[int] = None
    rate_limit_per_minute: Optional[int] = None

# ===== –°–¢–ê–¢–ò–°–¢–ò–ö–ê –¢–û–ö–ï–ù–û–í =====

class TokensStatsResponse(BaseModel):
    success: bool
    stats: dict

# ===== –õ–û–ì–ò =====

class LogsResponse(BaseModel):
    success: bool
    logs: list

# ===== –û–ë–©–ò–ï =====

class SuccessResponse(BaseModel):
    success: bool
    message: str

class ErrorResponse(BaseModel):
    success: bool = False
    error: str
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `backend/models/schemas.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `BaseModel` –∏–∑ `pydantic`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª–∞—Å—Å `LoginRequest`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª–∞—Å—Å `UserCreate`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª–∞—Å—Å `AnalyzeRequest`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª–∞—Å—Å `AnalyzeResponse`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª–∞—Å—Å `LLMConfigUpdate`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª–∞—Å—Å `SettingsUpdate`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª–∞—Å—Å `TokensStatsResponse`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª–∞—Å—Å `ErrorResponse`

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### üîó **–ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–ï –ü–†–û–í–ï–†–ö–ò –ü–û–°–õ–ï –§–ê–ó–´ 5**

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ Pydantic –º–æ–¥–µ–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã.

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –í—Å–µ –º–æ–¥–µ–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] –ú–æ–¥–µ–ª–∏ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] –°—Ö–µ–º—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç API endpoints
- [x] –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–ú–∏–Ω–∏-—Ç–µ—Å—Ç—ã:**

```bash
# –¢–µ—Å—Ç –∏–º–ø–æ—Ä—Ç–∞ –º–æ–¥–µ–ª–µ–π
cd backend
python -c "from models.schemas import LoginRequest, UserCreate, AnalyzeRequest; print('Models imported successfully')"

# –¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏
python -c "
from models.schemas import LoginRequest, AnalyzeRequest
req1 = LoginRequest(username='test', password='pass')
req2 = AnalyzeRequest(analysis_type='summary')
print('Validation works:', req1.username, req2.analysis_type)
"
```

**Fallback-—Å—Ü–µ–Ω–∞—Ä–∏–π:**

- –ï—Å–ª–∏ –∏–º–ø–æ—Ä—Ç –ø–∞–¥–∞–µ—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—Å Pydantic –º–æ–¥–µ–ª–µ–π
- –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∏ Field constraints

---

## –§–ê–ó–ê 6: –°–ï–†–í–ò–°–´ - –†–ê–ë–û–¢–ê –° JSON –§–ê–ô–õ–ê–ú–ò

### –®–∞–≥ 6.1: –°–æ–∑–¥–∞–Ω–∏–µ —É—Ç–∏–ª–∏—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å JSON [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/services/json_utils.py` —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ —á—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ JSON.

**–§–∞–π–ª:** `backend/services/json_utils.py`

```python
import json
from pathlib import Path
from typing import Any, Dict
import threading

# –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
_locks: Dict[str, threading.Lock] = {}
_locks_lock = threading.Lock()

def _get_lock(file_path: Path) -> threading.Lock:
    """–ü–æ–ª—É—á–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –¥–ª—è —Ñ–∞–π–ª–∞."""
    with _locks_lock:
        key = str(file_path)
        if key not in _locks:
            _locks[key] = threading.Lock()
        return _locks[key]

def read_json(file_path: Path, default: Any = None) -> Any:
    """
    –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ JSON —Ñ–∞–π–ª–∞.
  
    Args:
        file_path: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
        default: –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω
  
    Returns:
        –°–æ–¥–µ—Ä–∂–∏–º–æ–µ JSON —Ñ–∞–π–ª–∞ –∏–ª–∏ default
    """
    lock = _get_lock(file_path)
    with lock:
        try:
            if not file_path.exists():
                return default
        
            with open(file_path, "r", encoding="utf-8") as f:
                return json.load(f)
        except (json.JSONDecodeError, IOError) as e:
            print(f"–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è {file_path}: {e}")
            return default

def write_json(file_path: Path, data: Any, indent: int = 2) -> bool:
    """
    –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∑–∞–ø–∏—Å—å JSON —Ñ–∞–π–ª–∞.
  
    Args:
        file_path: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
        data: –î–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏
        indent: –û—Ç—Å—Ç—É–ø –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 2)
  
    Returns:
        True –µ—Å–ª–∏ –∑–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–∞, False –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
    """
    lock = _get_lock(file_path)
    with lock:
        try:
            # –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            file_path.parent.mkdir(parents=True, exist_ok=True)
        
            # –ó–∞–ø–∏—Å–∞—Ç—å –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
            temp_path = file_path.with_suffix('.tmp')
            with open(temp_path, "w", encoding="utf-8") as f:
                json.dump(data, f, ensure_ascii=False, indent=indent)
        
            # –ê—Ç–æ–º–∞—Ä–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª
            temp_path.replace(file_path)
            return True
        except (IOError, TypeError) as e:
            print(f"–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ {file_path}: {e}")
            return False

def update_json(file_path: Path, updates: Dict, default: Any = None) -> bool:
    """
    –û–±–Ω–æ–≤–∏—Ç—å JSON —Ñ–∞–π–ª (merge).
  
    Args:
        file_path: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
        updates: –°–ª–æ–≤–∞—Ä—å —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
        default: –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞
  
    Returns:
        True –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ, False –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
    """
    lock = _get_lock(file_path)
    with lock:
        data = read_json(file_path, default or {})
    
        if isinstance(data, dict):
            data.update(updates)
        else:
            data = updates
    
        return write_json(file_path, data)
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `backend/services/json_utils.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `json`, `Path`, `threading`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `read_json()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `write_json()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `update_json()`
- [x] –§—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `threading.Lock()` –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [x] –§—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç docstrings —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

**üö® FALLBACK-–°–¶–ï–ù–ê–†–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° JSON:**

- –ï—Å–ª–∏ —Ñ–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å default –∑–Ω–∞—á–µ–Ω–∏—è
- –ï—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∑–∞–ø–∏—Å—å ‚Üí —Ä–∞–±–æ—Ç–∞—Ç—å –≤ read-only —Ä–µ–∂–∏–º–µ
- –ü—Ä–∏ race conditions ‚Üí –ø–æ–≤—Ç–æ—Ä—è—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
- –ï—Å–ª–∏ JSON malformed ‚Üí —Å–æ–∑–¥–∞–≤–∞—Ç—å backup –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∏–∑ defaults
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ ‚Üí graceful –æ—Ç–∫–∞–∑ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º

---

## –§–ê–ó–ê 7: –°–ï–†–í–ò–°–´ - –†–ê–ë–û–¢–ê –° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú–ò

### –®–∞–≥ 7.1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/services/users.py` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏.

**–§–∞–π–ª:** `backend/services/users.py`

```python
from pathlib import Path
from typing import List, Optional, Dict
from backend.config import DATA_DIR
from backend.services.json_utils import read_json, write_json

USERS_FILE = DATA_DIR / "users.json"

def get_all_users() -> List[Dict]:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
  
    Returns:
        –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–±–µ–∑ –ø–∞—Ä–æ–ª–µ–π –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
    """
    data = read_json(USERS_FILE, {"users": []})
    users = data.get("users", [])
  
    # –£–±—Ä–∞—Ç—å –ø–∞—Ä–æ–ª–∏ –∏–∑ –æ—Ç–≤–µ—Ç–∞
    return [
        {"username": u["username"], "role": u["role"]}
        for u in users
    ]

def get_user_by_username(username: str) -> Optional[Dict]:
    """
    –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–º–µ–Ω–∏.
  
    Args:
        username: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ None
    """
    data = read_json(USERS_FILE, {"users": []})
    users = data.get("users", [])
  
    for user in users:
        if user["username"] == username:
            return user
  
    return None

def create_user(username: str, password: str, role: str = "user") -> bool:
    """
    –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  
    Args:
        username: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        password: –ü–∞—Ä–æ–ª—å
        role: –†–æ–ª—å (admin –∏–ª–∏ user)
  
    Returns:
        True –µ—Å–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ, False –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    """
    data = read_json(USERS_FILE, {"users": []})
    users = data.get("users", [])
  
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è
    if any(u["username"] == username for u in users):
        return False
  
    # –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    users.append({
        "username": username,
        "password": password,
        "role": role
    })
  
    data["users"] = users
    return write_json(USERS_FILE, data)

def update_user(username: str, password: Optional[str] = None, 
                role: Optional[str] = None) -> bool:
    """
    –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  
    Args:
        username: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        password: –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        role: –ù–æ–≤–∞—è —Ä–æ–ª—å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
  
    Returns:
        True –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ, False –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
    """
    data = read_json(USERS_FILE, {"users": []})
    users = data.get("users", [])
  
    for user in users:
        if user["username"] == username:
            if password is not None:
                user["password"] = password
            if role is not None:
                user["role"] = role
        
            data["users"] = users
            return write_json(USERS_FILE, data)
  
    return False

def verify_credentials(username: str, password: str) -> Optional[Dict]:
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  
    Args:
        username: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        password: –ü–∞—Ä–æ–ª—å
  
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–µ–∑ –ø–∞—Ä–æ–ª—è) –∏–ª–∏ None
    """
    user = get_user_by_username(username)
  
    if user and user["password"] == password:
        return {
            "username": user["username"],
            "role": user["role"]
        }
  
    return None
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `backend/services/users.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `json_utils`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `get_all_users()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `get_user_by_username()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `create_user()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `update_user()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `verify_credentials()`
- [x] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç docstrings

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 7.2: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ IP [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/services/auth.py` –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ IP.

**–§–∞–π–ª:** `backend/services/auth.py`

```python
from pathlib import Path
from typing import Optional, Dict
from backend.config import DATA_DIR
from backend.services.json_utils import read_json, write_json
from backend.services.users import get_user_by_username

AUTH_IPS_FILE = DATA_DIR / "auth_ips.json"

def get_user_by_ip(ip: str) -> Optional[Dict]:
    """
    –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ IP-–∞–¥—Ä–µ—Å—É.
  
    Args:
        ip: IP-–∞–¥—Ä–µ—Å
  
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ None
    """
    data = read_json(AUTH_IPS_FILE, {"authorized_ips": {}})
    authorized_ips = data.get("authorized_ips", {})
  
    username = authorized_ips.get(ip)
    if not username:
        return None
  
    user = get_user_by_username(username)
    if user:
        return {
            "username": user["username"],
            "role": user["role"],
            "ip": ip
        }
  
    return None

def authorize_ip(ip: str, username: str) -> bool:
    """
    –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å IP-–∞–¥—Ä–µ—Å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  
    Args:
        ip: IP-–∞–¥—Ä–µ—Å
        username: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  
    Returns:
        True –µ—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
    """
    data = read_json(AUTH_IPS_FILE, {"authorized_ips": {}})
    authorized_ips = data.get("authorized_ips", {})
  
    authorized_ips[ip] = username
    data["authorized_ips"] = authorized_ips
  
    return write_json(AUTH_IPS_FILE, data)

def is_ip_authorized(ip: str) -> bool:
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ IP-–∞–¥—Ä–µ—Å.
  
    Args:
        ip: IP-–∞–¥—Ä–µ—Å
  
    Returns:
        True –µ—Å–ª–∏ IP –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
    """
    user = get_user_by_ip(ip)
    return user is not None

def remove_ip_authorization(ip: str) -> bool:
    """
    –£–¥–∞–ª–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é IP-–∞–¥—Ä–µ—Å–∞.
  
    Args:
        ip: IP-–∞–¥—Ä–µ—Å
  
    Returns:
        True –µ—Å–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ
    """
    data = read_json(AUTH_IPS_FILE, {"authorized_ips": {}})
    authorized_ips = data.get("authorized_ips", {})
  
    if ip in authorized_ips:
        del authorized_ips[ip]
        data["authorized_ips"] = authorized_ips
        return write_json(AUTH_IPS_FILE, data)
  
    return False
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `backend/services/auth.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `json_utils` –∏ `users`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `get_user_by_ip()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `authorize_ip()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `is_ip_authorized()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `remove_ip_authorization()`
- [x] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç docstrings

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### üîó **–ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–ï –ü–†–û–í–ï–†–ö–ò –ü–û–°–õ–ï –§–ê–ó–´ 7**

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–µ—Ä–≤–∏—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–º–µ—Å—Ç–µ.

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –°–µ—Ä–≤–∏—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å JSON —Ñ–∞–π–ª–∞–º–∏
- [x] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ IP –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- [x] –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∏ —á–∏—Ç–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ú–∏–Ω–∏-—Ç–µ—Å—Ç—ã:**

```bash
# –¢–µ—Å—Ç —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
cd backend
python -c "
from services.users import get_all_users, create_user
from services.auth import authorize_ip, is_ip_authorized

# –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
users = get_all_users()
print('Users loaded:', len(users))

# –¢–µ—Å—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ IP
authorize_ip('192.168.1.100', 'admin')
print('IP authorized:', is_ip_authorized('192.168.1.100'))
"

# –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
python -c "
from services.users import create_user
result = create_user('testuser', 'testpass', 'user')
print('User created:', result)
"
```

**Fallback-—Å—Ü–µ–Ω–∞—Ä–∏–π:**

- –ï—Å–ª–∏ JSON –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–∞–¥–∞—é—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
- –ï—Å–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç IP –∞–¥—Ä–µ—Å–æ–≤

---

## –§–ê–ó–ê 8: MIDDLEWARE

### –®–∞–≥ 8.1: –°–æ–∑–¥–∞–Ω–∏–µ middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/middleware/auth.py` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**–§–∞–π–ª:** `backend/middleware/auth.py`

```python
from fastapi import Request, HTTPException, status
from fastapi.responses import JSONResponse
from backend.services.auth import get_user_by_ip

def get_client_ip(request: Request) -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π IP-–∞–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞.
  
    Args:
        request: FastAPI Request –æ–±—ä–µ–∫—Ç
  
    Returns:
        IP-–∞–¥—Ä–µ—Å –∫–ª–∏–µ–Ω—Ç–∞
    """
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –ø—Ä–æ–∫—Å–∏
    forwarded_for = request.headers.get("X-Forwarded-For")
    if forwarded_for:
        # –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π IP –∏–∑ —Å–ø–∏—Å–∫–∞
        return forwarded_for.split(",")[0].strip()
  
    real_ip = request.headers.get("X-Real-IP")
    if real_ip:
        return real_ip.strip()
  
    # Fallback –Ω–∞ –ø—Ä—è–º–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    return request.client.host

async def require_auth(request: Request) -> dict:
    """
    Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ IP.
  
    Args:
        request: FastAPI Request –æ–±—ä–µ–∫—Ç
  
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  
    Raises:
        HTTPException: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
    """
    ip = get_client_ip(request)
    user = get_user_by_ip(ip)
  
    if not user:
        raise HTTPException(
            status_code=status.HTTP_401_UNAUTHORIZED,
            detail="–¢—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è. IP –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω."
        )
  
    return user

async def require_admin(request: Request) -> dict:
    """
    Middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
  
    Args:
        request: FastAPI Request –æ–±—ä–µ–∫—Ç
  
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  
    Raises:
        HTTPException: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
    """
    user = await require_auth(request)
  
    if user["role"] != "admin":
        raise HTTPException(
            status_code=status.HTTP_403_FORBIDDEN,
            detail="–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞."
        )
  
    return user
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `backend/middleware/auth.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `Request`, `HTTPException` –∏–∑ FastAPI
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `get_client_ip()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `require_auth()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `require_admin()`
- [x] –§—É–Ω–∫—Ü–∏–∏ –ø–æ–¥–Ω–∏–º–∞—é—Ç `HTTPException` –ø—Ä–∏ –æ—à–∏–±–∫–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [x] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç docstrings

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 8.2: –°–æ–∑–¥–∞–Ω–∏–µ middleware –¥–ª—è Rate Limiting [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/middleware/rate_limit.py` –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤.

**–§–∞–π–ª:** `backend/middleware/rate_limit.py`

```python
from slowapi import Limiter
from slowapi.util import get_remote_address
from slowapi.errors import RateLimitExceeded
from fastapi import Request
from fastapi.responses import JSONResponse
from backend.services.settings import get_settings

# –°–æ–∑–¥–∞—Ç—å limiter —Å —Ñ—É–Ω–∫—Ü–∏–µ–π –ø–æ–ª—É—á–µ–Ω–∏—è IP
limiter = Limiter(key_func=get_remote_address)

def get_rate_limit_string() -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–æ–∫—É –ª–∏–º–∏—Ç–∞ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫.
  
    Returns:
        –°—Ç—Ä–æ–∫–∞ –≤–∏–¥–∞ "10/minute"
    """
    settings = get_settings()
    limit = settings.get("rate_limit_per_minute", 10)
    return f"{limit}/minute"

async def rate_limit_exceeded_handler(request: Request, exc: RateLimitExceeded) -> JSONResponse:
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤.
  
    Args:
        request: FastAPI Request –æ–±—ä–µ–∫—Ç
        exc: –ò—Å–∫–ª—é—á–µ–Ω–∏–µ RateLimitExceeded
  
    Returns:
        JSONResponse —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ
    """
    # –ò–∑–≤–ª–µ—á—å –≤—Ä–µ–º—è –¥–æ —Å–±—Ä–æ—Å–∞ –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞
    retry_after = exc.detail.split("retry after ")[1] if "retry after" in exc.detail else "60"
  
    return JSONResponse(
        status_code=429,
        content={
            "success": False,
            "error": f"–ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ (10 –∞–Ω–∞–ª–∏–∑–æ–≤ –≤ –º–∏–Ω—É—Ç—É). –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ —á–µ—Ä–µ–∑ {retry_after} —Å–µ–∫—É–Ω–¥."
        }
    )
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `backend/middleware/rate_limit.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `Limiter` –∏–∑ `slowapi`
- [x] –§–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä `limiter`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `get_rate_limit_string()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `rate_limit_exceeded_handler()`
- [x] –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTTP 429 —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- [x] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç docstrings

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

**üö® FALLBACK-–°–¶–ï–ù–ê–†–ò–ô –î–õ–Ø RATE LIMITING:**

- –ï—Å–ª–∏ `slowapi` –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—É—é in-memory –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –ø–æ IP
- –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å hardcoded –ª–∏–º–∏—Ç 10 req/min
- –ü—Ä–∏ –æ—à–∏–±–∫–µ middleware ‚Üí –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –∑–∞–ø—Ä–æ—Å –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (graceful degradation)

---

### –®–∞–≥ 8.3: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –æ—á–µ—Ä–µ–¥–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/services/queue.py` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—å—é –∑–∞–ø—Ä–æ—Å–æ–≤ –∞–Ω–∞–ª–∏–∑–∞.

**–§–∞–π–ª:** `backend/services/queue.py`

```python
import asyncio
from typing import Optional, Dict, Any
from datetime import datetime
from backend.services.settings import get_settings

class RequestQueue:
    """
    –ú–µ–Ω–µ–¥–∂–µ—Ä –æ—á–µ—Ä–µ–¥–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –∞–Ω–∞–ª–∏–∑ –¥–æ–≥–æ–≤–æ—Ä–æ–≤.
  
    –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
    - –ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç–æ–∫: –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5)
    - –ú–∞–∫—Å–∏–º—É–º –≤ –æ—á–µ—Ä–µ–¥–∏ –æ–∂–∏–¥–∞–Ω–∏—è: –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 5)
    """
  
    def __init__(self):
        self._active_count = 0
        self._queue_count = 0
        self._lock = asyncio.Lock()
  
    async def acquire(self) -> Dict[str, Any]:
        """
        –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø–æ–ª—É—á–∏—Ç—å —Å–ª–æ—Ç –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.
    
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º:
            - {"allowed": True} - –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å—Ä–∞–∑—É
            - {"allowed": True, "queued": True} - –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –æ—á–µ—Ä–µ–¥—å
            - {"allowed": False, "error": "..."} - –æ—Ç–∫–ª–æ–Ω–µ–Ω–æ
        """
        settings = get_settings()
        max_concurrent = settings.get("max_concurrent_requests", 5)
        max_queue = settings.get("max_queue_size", 5)
    
        async with self._lock:
            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –º–æ–∂–Ω–æ –ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ä–∞–∑—É
            if self._active_count < max_concurrent:
                self._active_count += 1
                return {"allowed": True, "queued": False}
        
            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –º–æ–∂–Ω–æ –ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å
            if self._queue_count < max_queue:
                self._queue_count += 1
                return {"allowed": True, "queued": True, "message": "–ò–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –í–∞—à –∑–∞–ø—Ä–æ—Å –≤ –æ—á–µ—Ä–µ–¥–∏."}
        
            # –û—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞
            return {
                "allowed": False, 
                "error": "–°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ (—á–µ—Ä–µ–∑ 1-2 –º–∏–Ω—É—Ç—ã)."
            }
  
    async def wait_for_slot(self) -> bool:
        """
        –û–∂–∏–¥–∞—Ç—å –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Å–ª–æ—Ç–∞ (–¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ—á–µ—Ä–µ–¥–∏).
    
        Returns:
            True –∫–æ–≥–¥–∞ —Å–ª–æ—Ç –æ—Å–≤–æ–±–æ–¥–∏–ª—Å—è
        """
        settings = get_settings()
        max_concurrent = settings.get("max_concurrent_requests", 5)
    
        # –û–∂–∏–¥–∞—Ç—å —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –ø—Ä–æ–≤–µ—Ä–∫–∏
        while True:
            async with self._lock:
                if self._active_count < max_concurrent:
                    # –°–ª–æ—Ç –æ—Å–≤–æ–±–æ–¥–∏–ª—Å—è, –∑–∞–Ω–∏–º–∞–µ–º –µ–≥–æ
                    self._queue_count -= 1
                    self._active_count += 1
                    return True
        
            # –ñ–¥–µ–º –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø—Ä–æ–≤–µ—Ä–∫–æ–π
            await asyncio.sleep(1)
  
    async def release(self):
        """
        –û—Å–≤–æ–±–æ–¥–∏—Ç—å —Å–ª–æ—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏.
        """
        async with self._lock:
            if self._active_count > 0:
                self._active_count -= 1
  
    def get_status(self) -> Dict[str, int]:
        """
        –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –æ—á–µ—Ä–µ–¥–∏.
    
        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏ –æ–∂–∏–¥–∞—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
        """
        return {
            "active": self._active_count,
            "queued": self._queue_count
        }

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –æ—á–µ—Ä–µ–¥–∏
request_queue = RequestQueue()
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `backend/services/queue.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–ª–∞—Å—Å `RequestQueue`
- [x] –ö–ª–∞—Å—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `asyncio.Lock()` –¥–ª—è –ø–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- [x] –ú–µ—Ç–æ–¥ `acquire()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–∏–º–∏—Ç—ã –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- [x] –ú–µ—Ç–æ–¥ `acquire()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã: allowed, queued, rejected
- [x] –ú–µ—Ç–æ–¥ `wait_for_slot()` –æ–∂–∏–¥–∞–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Å–ª–æ—Ç–∞
- [x] –ú–µ—Ç–æ–¥ `release()` –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç —Å–ª–æ—Ç
- [x] –ú–µ—Ç–æ–¥ `get_status()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- [x] –°–æ–∑–¥–∞–Ω –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä `request_queue`
- [x] –í—Å–µ –º–µ—Ç–æ–¥—ã –∏–º–µ—é—Ç docstrings

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

## –°–¢–ê–¢–£–° –ü–†–û–ï–ö–¢–ê

**–û–±—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å:** 22 –∏–∑ ~65 —à–∞–≥–æ–≤

**–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Ñ–∞–∑—ã:**

- [x] –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ (5/5) - –≤–∫–ª—é—á–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ .env
- [x] –§–∞–∑–∞ 2: –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (2/2)
- [x] –§–∞–∑–∞ 3: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (5/5)
- [x] –§–∞–∑–∞ 4: –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è LLM (3/3)
- [x] –§–∞–∑–∞ 5: Pydantic –º–æ–¥–µ–ª–∏ (1/1)
- [x] –§–∞–∑–∞ 6: –°–µ—Ä–≤–∏—Å—ã - JSON (1/1)
- [x] –§–∞–∑–∞ 7: –°–µ—Ä–≤–∏—Å—ã - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (2/2)
- [x] –§–∞–∑–∞ 8: Middleware, Rate Limiting –∏ Queue (3/3)

---

### üîó **–ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–ï –ü–†–û–í–ï–†–ö–ò –ü–û–°–õ–ï –§–ê–ó–´ 8**

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ middleware –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å –æ—Å—Ç–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π.

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] Middleware –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ main.py –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ IP
- [x] –û—á–µ—Ä–µ–¥—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- [x] Middleware –Ω–µ –ª–æ–º–∞–µ—Ç –±–∞–∑–æ–≤—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å FastAPI

**–ú–∏–Ω–∏-—Ç–µ—Å—Ç—ã:**

```bash
# –¢–µ—Å—Ç middleware
python -c "
from backend.middleware.auth import require_auth, require_admin, get_client_ip
from backend.middleware.rate_limit import limiter
print('Middleware imported successfully')
"

# –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å FastAPI
python -c "
from backend.main import app
routes = [route.path for route in app.routes]
print('Routes available:', len(routes))
"
```

**Fallback-—Å—Ü–µ–Ω–∞—Ä–∏–π:**

- –ï—Å–ª–∏ middleware –ø–∞–¥–∞–µ—Ç ‚Üí –æ—Ç–∫–ª—é—á–∞—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–π middleware —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º
- –ï—Å–ª–∏ rate limiting –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

---

## –§–ê–ó–ê 9: –°–ï–†–í–ò–°–´ - –ü–†–û–ú–ü–¢–´

### –®–∞–≥ 9.1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏ [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/services/prompts.py` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏.

**–§–∞–π–ª:** `backend/services/prompts.py`

```python
from pathlib import Path
from typing import Dict, Optional
from backend.config import PROMPTS_DIR, DEFAULTS_DIR

def get_prompt(prompt_type: str) -> Optional[str]:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π –ø—Ä–æ–º–ø—Ç.
  
    Args:
        prompt_type: –¢–∏–ø –ø—Ä–æ–º–ø—Ç–∞ ("summary" –∏–ª–∏ "legal_check")
  
    Returns:
        –¢–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ –∏–ª–∏ None
    """
    if prompt_type == "summary":
        file_path = PROMPTS_DIR / "summary_prompt.txt"
    elif prompt_type == "legal_check":
        file_path = PROMPTS_DIR / "legal_check_prompt.txt"
    else:
        return None
  
    try:
        with open(file_path, "r", encoding="utf-8") as f:
            return f.read()
    except IOError:
        return None

def get_all_prompts() -> Dict[str, str]:
    """
    –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –ø—Ä–æ–º–ø—Ç—ã.
  
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏ {"summary": "...", "legal_check": "..."}
    """
    return {
        "summary": get_prompt("summary") or "",
        "legal_check": get_prompt("legal_check") or ""
    }

def save_prompt(prompt_type: str, content: str) -> bool:
    """
    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–º–ø—Ç.
  
    Args:
        prompt_type: –¢–∏–ø –ø—Ä–æ–º–ø—Ç–∞ ("summary" –∏–ª–∏ "legal_check")
        content: –ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞
  
    Returns:
        True –µ—Å–ª–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ
    """
    if prompt_type == "summary":
        file_path = PROMPTS_DIR / "summary_prompt.txt"
    elif prompt_type == "legal_check":
        file_path = PROMPTS_DIR / "legal_check_prompt.txt"
    else:
        return False
  
    try:
        with open(file_path, "w", encoding="utf-8") as f:
            f.write(content)
        return True
    except IOError:
        return False

def reset_prompt(prompt_type: str) -> Optional[str]:
    """
    –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é –∏–∑ defaults.
  
    Args:
        prompt_type: –¢–∏–ø –ø—Ä–æ–º–ø—Ç–∞ ("summary" –∏–ª–∏ "legal_check")
  
    Returns:
        –ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–æ–º–ø—Ç–∞ –∏–ª–∏ None
    """
    if prompt_type == "summary":
        default_file = DEFAULTS_DIR / "summary_prompt.txt"
        current_file = PROMPTS_DIR / "summary_prompt.txt"
    elif prompt_type == "legal_check":
        default_file = DEFAULTS_DIR / "legal_check_prompt.txt"
        current_file = PROMPTS_DIR / "legal_check_prompt.txt"
    else:
        return None
  
    try:
        # –ß–∏—Ç–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        with open(default_file, "r", encoding="utf-8") as f:
            default_content = f.read()
    
        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —Ç–µ–∫—É—â–∏–π
        with open(current_file, "w", encoding="utf-8") as f:
            f.write(default_content)
    
        return default_content
    except IOError:
        return None
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `backend/services/prompts.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `get_prompt()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `get_all_prompts()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `save_prompt()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `reset_prompt()`
- [x] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç docstrings
- [x] –§—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π UTF-8

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [‚úÖ] –ó–∞–≤–µ—Ä—à–µ–Ω

---

## –§–ê–ó–ê 10: –°–ï–†–í–ò–°–´ - –ù–ê–°–¢–†–û–ô–ö–ò

### –®–∞–≥ 10.1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ LLM [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/services/llm_config.py` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ LLM.

**–§–∞–π–ª:** `backend/services/llm_config.py`

```python
from pathlib import Path
from typing import Dict
from backend.config import DATA_DIR
from backend.services.json_utils import read_json, write_json, update_json

LLM_CONFIG_FILE = DATA_DIR / "llm_config.json"

DEFAULT_CONFIG = {
    "llm_type": "deepseek",
    "deepseek_api_key": "",
    "deepseek_base_url": "https://api.deepseek.com",
    "lmstudio_base_url": "http://localhost:1234/v1",
    "lmstudio_model": "deepseek-coder"
}

def get_llm_config() -> Dict:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é LLM.
  
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ LLM
    """
    return read_json(LLM_CONFIG_FILE, DEFAULT_CONFIG.copy())

def update_llm_config(updates: Dict) -> bool:
    """
    –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é LLM.
  
    Args:
        updates: –°–ª–æ–≤–∞—Ä—å —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
  
    Returns:
        True –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ
    """
    return update_json(LLM_CONFIG_FILE, updates, DEFAULT_CONFIG.copy())

def get_current_llm_type() -> str:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–π —Ç–∏–ø LLM.

    Returns:
        "deepseek" –∏–ª–∏ "lmstudio"
    """
    config = get_llm_config()
    return config.get("llm_type", "deepseek")
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [‚úÖ] –§–∞–π–ª `backend/services/llm_config.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `DEFAULT_CONFIG`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `get_llm_config()`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `update_llm_config()`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `get_current_llm_type()`
- [‚úÖ] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç docstrings

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [‚úÖ] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 10.2: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏—Å—Ç–µ–º—ã [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/services/settings.py` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —Å–∏—Å—Ç–µ–º—ã.

**–§–∞–π–ª:** `backend/services/settings.py`

```python
from pathlib import Path
from typing import Dict
from backend.config import DATA_DIR
from backend.services.json_utils import read_json, write_json, update_json

SETTINGS_FILE = DATA_DIR / "settings.json"

DEFAULT_SETTINGS = {
    "max_file_size_mb": 50,
    "max_queue_size": 5,
    "max_concurrent_requests": 5,
    "rate_limit_per_minute": 10
}

def get_settings() -> Dict:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã.
  
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
    """
    return read_json(SETTINGS_FILE, DEFAULT_SETTINGS.copy())

def update_settings(updates: Dict) -> bool:
    """
    –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã.
  
    Args:
        updates: –°–ª–æ–≤–∞—Ä—å —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
  
    Returns:
        True –µ—Å–ª–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ
    """
    return update_json(SETTINGS_FILE, updates, DEFAULT_SETTINGS.copy())

def get_max_file_size_bytes() -> int:
    """
    –ü–æ–ª—É—á–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ –±–∞–π—Ç–∞—Ö.

    Returns:
        –†–∞–∑–º–µ—Ä –≤ –±–∞–π—Ç–∞—Ö
    """
    settings = get_settings()
    size_mb = settings.get("max_file_size_mb", 50)
    return size_mb * 1024 * 1024
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [‚úÖ] –§–∞–π–ª `backend/services/settings.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `DEFAULT_SETTINGS`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `get_settings()`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `update_settings()`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `get_max_file_size_bytes()`
- [‚úÖ] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç docstrings

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [‚úÖ] –ó–∞–≤–µ—Ä—à–µ–Ω

---

## –§–ê–ó–ê 11: –°–ï–†–í–ò–°–´ - –õ–û–ì–ò–†–û–í–ê–ù–ò–ï

### –®–∞–≥ 11.1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è [‚úÖ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/services/logger.py` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.

**–§–∞–π–ª:** `backend/services/logger.py`

```python
import sys
from loguru import logger
from pathlib import Path
from backend.config import LOGS_DIR, LOG_LEVEL, LOG_ROTATION

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π handler
logger.remove()

# –î–æ–±–∞–≤–∏—Ç—å –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
logger.add(
    sys.stdout,
    level=LOG_LEVEL,
    format="<green>{time:YYYY-MM-DD HH:mm:ss}</green> | <level>{level: <8}</level> | <cyan>{name}</cyan>:<cyan>{function}</cyan> - <level>{message}</level>"
)

# –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
logger.add(
    LOGS_DIR / "app.log",
    level="INFO",
    format="{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {message}",
    rotation=LOG_ROTATION,
    retention="30 days",
    encoding="utf-8"
)

# –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
logger.add(
    LOGS_DIR / "error.log",
    level="ERROR",
    format="{time:YYYY-MM-DD HH:mm:ss} | {level: <8} | {name}:{function}:{line} - {message}",
    rotation=LOG_ROTATION,
    retention="30 days",
    encoding="utf-8"
)

def log_user_action(username: str, action: str, details: str = ""):
    """
    –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  
    Args:
        username: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        action: –î–µ–π—Å—Ç–≤–∏–µ (login, analyze, export –∏ —Ç.–¥.)
        details: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
    """
    message = f"USER:{username} | ACTION:{action}"
    if details:
        message += f" | DETAILS:{details}"
    logger.info(message)

def log_error(username: str, action: str, error: str):
    """
    –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É.
  
    Args:
        username: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        action: –î–µ–π—Å—Ç–≤–∏–µ, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞
        error: –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
    """
    message = f"USER:{username} | ACTION:{action} | ERROR:{error}"
    logger.error(message)

def get_logs(log_type: str = "app", limit: int = 100) -> list:
    """
    –ü–æ–ª—É—á–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∏–∑ –ª–æ–≥–∞.
  
    Args:
        log_type: –¢–∏–ø –ª–æ–≥–∞ ("app" –∏–ª–∏ "error")
        limit: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
  
    Returns:
        –°–ø–∏—Å–æ–∫ –∑–∞–ø–∏—Å–µ–π –ª–æ–≥–∞
    """
    if log_type == "app":
        log_file = LOGS_DIR / "app.log"
    elif log_type == "error":
        log_file = LOGS_DIR / "error.log"
    else:
        return []
  
    try:
        if not log_file.exists():
            return []
    
        with open(log_file, "r", encoding="utf-8") as f:
            lines = f.readlines()
    
        # –í–µ—Ä–Ω—É—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ limit —Å—Ç—Ä–æ–∫
        return [line.strip() for line in lines[-limit:]]
    except IOError:
        return []
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [‚úÖ] –§–∞–π–ª `backend/services/logger.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [‚úÖ] –§–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `loguru.logger`
- [‚úÖ] –§–∞–π–ª –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `app.log`
- [‚úÖ] –§–∞–π–ª –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `error.log`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `log_user_action()`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `log_error()`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `get_logs()`
- [‚úÖ] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç docstrings

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [‚úÖ] –ó–∞–≤–µ—Ä—à–µ–Ω

---

## –§–ê–ó–ê 12: –°–ï–†–í–ò–°–´ - –¢–û–ö–ï–ù–´

### –®–∞–≥ 12.1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ —É—á–µ—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/services/tokens.py` –¥–ª—è —É—á–µ—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤.

**–§–∞–π–ª:** `backend/services/tokens.py`

```python
from datetime import datetime
from typing import Dict
from backend.config import DATA_DIR
from backend.services.json_utils import read_json, write_json

TOKENS_FILE = DATA_DIR / "tokens_usage.json"

# –¢–∞—Ä–∏—Ñ—ã DeepSeek (–Ω–∞ –¥–µ–∫–∞–±—Ä—å 2025)
PROMPT_TOKEN_COST = 0.0014 / 1000  # $0.0014 –∑–∞ 1K —Ç–æ–∫–µ–Ω–æ–≤
COMPLETION_TOKEN_COST = 0.0028 / 1000  # $0.0028 –∑–∞ 1K —Ç–æ–∫–µ–Ω–æ–≤

DEFAULT_STATS = {
    "total_prompt_tokens": 0,
    "total_completion_tokens": 0,
    "total_cost_usd": 0.0,
    "users": {},
    "last_updated": ""
}

def get_tokens_stats() -> Dict:
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤.
  
    Returns:
        –°–ª–æ–≤–∞—Ä—å —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
    """
    return read_json(TOKENS_FILE, DEFAULT_STATS.copy())

def track_tokens(username: str, prompt_tokens: int, completion_tokens: int):
    """
    –£—á–µ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.
  
    Args:
        username: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        prompt_tokens: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –ø—Ä–æ–º–ø—Ç–µ
        completion_tokens: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –≤ –æ—Ç–≤–µ—Ç–µ
    """
    stats = get_tokens_stats()
  
    # –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å
    cost = (prompt_tokens * PROMPT_TOKEN_COST) + (completion_tokens * COMPLETION_TOKEN_COST)
  
    # –û–±–Ω–æ–≤–∏—Ç—å –æ–±—â—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    stats["total_prompt_tokens"] += prompt_tokens
    stats["total_completion_tokens"] += completion_tokens
    stats["total_cost_usd"] += cost
    stats["last_updated"] = datetime.now().isoformat()
  
    # –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if username not in stats["users"]:
        stats["users"][username] = {
            "prompt_tokens": 0,
            "completion_tokens": 0,
            "requests_count": 0,
            "cost_usd": 0.0
        }
  
    user_stats = stats["users"][username]
    user_stats["prompt_tokens"] += prompt_tokens
    user_stats["completion_tokens"] += completion_tokens
    user_stats["requests_count"] += 1
    user_stats["cost_usd"] += cost
  
    write_json(TOKENS_FILE, stats)

def format_stats_for_display(stats: Dict) -> Dict:
    """
    –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.
  
    Args:
        stats: –°—ã—Ä–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
  
    Returns:
        –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    """
    users_list = []
    for username, user_stats in stats.get("users", {}).items():
        users_list.append({
            "username": username,
            "prompt_tokens": user_stats["prompt_tokens"],
            "completion_tokens": user_stats["completion_tokens"],
            "requests_count": user_stats["requests_count"],
            "cost_usd": round(user_stats["cost_usd"], 2)
        })
  
    # –°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ç–æ–∫–µ–Ω–æ–≤ (—É–±—ã–≤–∞–Ω–∏–µ)
    users_list.sort(key=lambda x: x["prompt_tokens"] + x["completion_tokens"], reverse=True)
  
    return {
        "total_prompt_tokens": stats.get("total_prompt_tokens", 0),
        "total_completion_tokens": stats.get("total_completion_tokens", 0),
        "total_cost_usd": round(stats.get("total_cost_usd", 0.0), 2),
        "users": users_list,
        "last_updated": stats.get("last_updated", "")
    }
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [‚úÖ] –§–∞–π–ª `backend/services/tokens.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã `PROMPT_TOKEN_COST` –∏ `COMPLETION_TOKEN_COST`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É `DEFAULT_STATS`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `get_tokens_stats()`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `track_tokens()`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `format_stats_for_display()`
- [‚úÖ] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç docstrings

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [‚úÖ] –ó–∞–≤–µ—Ä—à–µ–Ω

---

## –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Æ

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —ç—Ç–∏–º –ø–ª–∞–Ω–æ–º:**

1. **–í—ã–ø–æ–ª–Ω—è–π—Ç–µ –¢–û–õ–¨–ö–û –û–î–ò–ù —à–∞–≥ –∑–∞ —Ä–∞–∑**
2. **–ù–ï –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É, –ø–æ–∫–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω —Ç–µ–∫—É—â–∏–π**
3. **–ö–∞–∂–¥—ã–π —à–∞–≥ –Ω–µ–∑–∞–≤–∏—Å–∏–º - –Ω–µ –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ**
4. **–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —à–∞–≥–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º**
5. **–û—Ç–º–µ—Ç—å—Ç–µ —à–∞–≥ –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π: –º–µ–Ω—è–π—Ç–µ `[ ]` –Ω–∞ `[X]`**

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã:**

```
–ü—Ä–∏—Å—Ç—É–ø–∞–π –∫ —à–∞–≥—É X.X
```

–ì–¥–µ X.X - –Ω–æ–º–µ—Ä —à–∞–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ü—Ä–∏—Å—Ç—É–ø–∞–π –∫ —à–∞–≥—É 1.1")

**–í–∞–∂–Ω–æ:**

- –ï—Å–ª–∏ —à–∞–≥ –Ω–µ –ø—Ä–æ—à–µ–ª –ø—Ä–æ–≤–µ—Ä–∫—É - –∏—Å–ø—Ä–∞–≤—å—Ç–µ –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø—Ä–æ–≤–µ—Ä–∫—É
- –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ
- –í –∫–æ–Ω—Ü–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –æ—Ç–º–µ—á–∞–π—Ç–µ –µ–≥–æ –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ

---

## –§–ê–ó–ê 13: –°–ï–†–í–ò–°–´ - –†–ê–ë–û–¢–ê –° –î–û–ö–£–ú–ï–ù–¢–ê–ú–ò (–ß–ê–°–¢–¨ 1)

### –®–∞–≥ 13.1: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–µ—Ä–≤–∏—Å–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ [‚úÖ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/services/document.py` —Å –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.

**–§–∞–π–ª:** `backend/services/document.py`

```python
from pathlib import Path
from typing import Optional, Tuple
import tempfile
import os

def extract_text_from_file(file_path: Path, file_extension: str) -> Tuple[Optional[str], Optional[str]]:
    """
    –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ —Ñ–∞–π–ª–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.
  
    Args:
        file_path: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
        file_extension: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ (.doc, .docx, .pdf)
  
    Returns:
        –ö–æ—Ä—Ç–µ–∂ (—Ç–µ–∫—Å—Ç, –æ—à–∏–±–∫–∞). –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ - (—Ç–µ–∫—Å—Ç, None), –µ—Å–ª–∏ –æ—à–∏–±–∫–∞ - (None, —Ç–µ–∫—Å—Ç_–æ—à–∏–±–∫–∏)
    """
    try:
        if file_extension == ".docx":
            return extract_from_docx(file_path)
        elif file_extension == ".doc":
            return extract_from_doc(file_path)
        elif file_extension == ".pdf":
            return extract_from_pdf(file_path)
        else:
            return None, "–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –î–æ–ø—É—Å—Ç–∏–º—ã: .doc, .docx, .pdf"
    except Exception as e:
        return None, f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞: {str(e)}"

def extract_from_docx(file_path: Path) -> Tuple[Optional[str], Optional[str]]:
    """
    –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ .docx —Ñ–∞–π–ª–∞.
  
    Args:
        file_path: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
  
    Returns:
        –ö–æ—Ä—Ç–µ–∂ (—Ç–µ–∫—Å—Ç, –æ—à–∏–±–∫–∞)
    """
    # –ë—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ
    return None, "–§—É–Ω–∫—Ü–∏—è –µ—â–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞"

def extract_from_doc(file_path: Path) -> Tuple[Optional[str], Optional[str]]:
    """
    –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ .doc —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ COM (pywin32).
  
    Args:
        file_path: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
  
    Returns:
        –ö–æ—Ä—Ç–µ–∂ (—Ç–µ–∫—Å—Ç, –æ—à–∏–±–∫–∞)
    """
    # –ë—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ–∑–∂–µ
    return None, "–§—É–Ω–∫—Ü–∏—è –µ—â–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞"

def extract_from_pdf(file_path: Path) -> Tuple[Optional[str], Optional[str]]:
    """
    –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ .pdf —Ñ–∞–π–ª–∞.
  
    Args:
        file_path: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
  
    Returns:
        –ö–æ—Ä—Ç–µ–∂ (—Ç–µ–∫—Å—Ç, –æ—à–∏–±–∫–∞)
    """
    # –ë—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ–∑–∂–µ
    return None, "–§—É–Ω–∫—Ü–∏—è –µ—â–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞"

def estimate_token_count(text: str) -> int:
    """
    –û—Ü–µ–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ –≤ —Ç–µ–∫—Å—Ç–µ.
  
    –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç—É—é —ç–≤—Ä–∏—Å—Ç–∏–∫—É: ~1 —Ç–æ–∫–µ–Ω = 4 —Å–∏–º–≤–æ–ª–∞ –¥–ª—è —Ä—É—Å—Å–∫–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.
  
    Args:
        text: –¢–µ–∫—Å—Ç –¥–ª—è –æ—Ü–µ–Ω–∫–∏
  
    Returns:
        –ü—Ä–∏–º–µ—Ä–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤
    """
    return len(text) // 4

def check_text_size(text: str, max_tokens: int = 128000) -> Tuple[bool, Optional[str]]:
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤.
  
    Args:
        text: –¢–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
        max_tokens: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 128K)
  
    Returns:
        –ö–æ—Ä—Ç–µ–∂ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç, –æ—à–∏–±–∫–∞). True –µ—Å–ª–∏ —Ä–∞–∑–º–µ—Ä –¥–æ–ø—É—Å—Ç–∏–º, False –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω
    """
    token_count = estimate_token_count(text)
  
    if token_count > max_tokens:
        pages_estimate = token_count // 1500  # –ü—Ä–∏–º–µ—Ä–Ω–æ 1500 —Ç–æ–∫–µ–Ω–æ–≤ = 1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞
        return False, f"–î–æ–∫—É–º–µ–Ω—Ç —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–ø—Ä–∏–º–µ—Ä–Ω–æ {pages_estimate} —Å—Ç—Ä–∞–Ω–∏—Ü, –ª–∏–º–∏—Ç: 100 —Å—Ç—Ä–∞–Ω–∏—Ü)."
  
    return True, None
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [‚úÖ] –§–∞–π–ª `backend/services/document.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [‚úÖ] –§–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `Path`, `tempfile`, `os`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `extract_text_from_file()`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `extract_from_docx()` (–∑–∞–≥–ª—É—à–∫–∞)
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `extract_from_doc()` (–∑–∞–≥–ª—É—à–∫–∞)
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `extract_from_pdf()` (–∑–∞–≥–ª—É—à–∫–∞)
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `estimate_token_count()`
- [‚úÖ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `check_text_size()`
- [‚úÖ] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç docstrings

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [‚úÖ] –ó–∞–≤–µ—Ä—à–µ–Ω

**üö® FALLBACK-–°–¶–ï–ù–ê–†–ò–ò –î–õ–Ø –û–ë–†–ê–ë–û–¢–ö–ò –î–û–ö–£–ú–ï–ù–¢–û–í:**

- –ï—Å–ª–∏ —Ñ–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ –ø–∞–Ω–∏–∫–∏
- –ï—Å–ª–∏ —Ñ–æ—Ä–º–∞—Ç –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è ‚Üí graceful –æ—Ç–∫–∞–∑ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏
- –ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback UTF-8 —Å –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—à–∏–±–æ–∫
- –ï—Å–ª–∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∑–∞–Ω–∏–º–∞–µ—Ç —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ ‚Üí —Ç–∞–π–º–∞—É—Ç —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- –î–ª—è —Å–∫–∞–Ω–æ–≤ PDF ‚Üí –æ—Ç–∫–∞–∑ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OCR

---

### –®–∞–≥ 13.2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–∑ DOCX [‚úÖ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `extract_from_docx()` –≤ —Ñ–∞–π–ª–µ `backend/services/document.py`.

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**
–ó–∞–º–µ–Ω–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `extract_from_docx()` –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:

```python
def extract_from_docx(file_path: Path) -> Tuple[Optional[str], Optional[str]]:
    """
    –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ .docx —Ñ–∞–π–ª–∞.
  
    Args:
        file_path: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
  
    Returns:
        –ö–æ—Ä—Ç–µ–∂ (—Ç–µ–∫—Å—Ç, –æ—à–∏–±–∫–∞)
    """
    try:
        from docx import Document
    
        doc = Document(str(file_path))
    
        # –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤
        paragraphs_text = []
        for para in doc.paragraphs:
            if para.text.strip():
                paragraphs_text.append(para.text)
    
        # –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ —Ç–∞–±–ª–∏—Ü
        tables_text = []
        for table in doc.tables:
            for row in table.rows:
                row_text = []
                for cell in row.cells:
                    if cell.text.strip():
                        row_text.append(cell.text)
                if row_text:
                    tables_text.append(" | ".join(row_text))
    
        # –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤–µ—Å—å —Ç–µ–∫—Å—Ç
        full_text = "\n".join(paragraphs_text)
        if tables_text:
            full_text += "\n\n=== –¢–ê–ë–õ–ò–¶–´ ===\n\n" + "\n".join(tables_text)
    
        if not full_text.strip():
            return None, "–§–∞–π–ª –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ –ø—É—Å—Ç."
    
        return full_text, None
    
    except Exception as e:
        error_msg = str(e).lower()
        if "password" in error_msg or "encrypted" in error_msg:
            return None, "–§–∞–π–ª –∑–∞—â–∏—â–µ–Ω –ø–∞—Ä–æ–ª–µ–º. –°–Ω–∏–º–∏—Ç–µ –∑–∞—â–∏—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
        elif "corrupt" in error_msg or "invalid" in error_msg:
            return None, "–§–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª."
        else:
            return None, f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: {str(e)}"
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [‚úÖ] –§—É–Ω–∫—Ü–∏—è `extract_from_docx()` –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `Document` –∏–∑ `docx`
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ –ø–∞—Ä–∞–≥—Ä–∞—Ñ–æ–≤
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ —Ç–∞–±–ª–∏—Ü
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ –ø–∞—Ä–æ–ª–µ–º —Ñ–∞–π–ª–∞
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ç–µ–∂ (—Ç–µ–∫—Å—Ç, –æ—à–∏–±–∫–∞)

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [‚úÖ] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 13.3: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–∑ PDF [‚úÖ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `extract_from_pdf()` –≤ —Ñ–∞–π–ª–µ `backend/services/document.py`.

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**
–ó–∞–º–µ–Ω–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `extract_from_pdf()` –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:

```python
def extract_from_pdf(file_path: Path) -> Tuple[Optional[str], Optional[str]]:
    """
    –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ .pdf —Ñ–∞–π–ª–∞.
  
    Args:
        file_path: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
  
    Returns:
        –ö–æ—Ä—Ç–µ–∂ (—Ç–µ–∫—Å—Ç, –æ—à–∏–±–∫–∞)
    """
    try:
        import PyPDF2
    
        with open(file_path, "rb") as f:
            pdf_reader = PyPDF2.PdfReader(f)
        
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞—â–∏—Ç—É –ø–∞—Ä–æ–ª–µ–º
            if pdf_reader.is_encrypted:
                return None, "–§–∞–π–ª –∑–∞—â–∏—â–µ–Ω –ø–∞—Ä–æ–ª–µ–º. –°–Ω–∏–º–∏—Ç–µ –∑–∞—â–∏—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
        
            # –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç —Å–æ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
            text_parts = []
            for page_num, page in enumerate(pdf_reader.pages, start=1):
                page_text = page.extract_text()
                if page_text.strip():
                    text_parts.append(f"=== –°—Ç—Ä–∞–Ω–∏—Ü–∞ {page_num} ===\n{page_text}")
        
            full_text = "\n\n".join(text_parts)
        
            if not full_text.strip():
                return None, "PDF –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–ª–æ—è (–≤–æ–∑–º–æ–∂–Ω–æ, —ç—Ç–æ —Å–∫–∞–Ω). –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .docx"
        
            return full_text, None
        
    except Exception as e:
        error_msg = str(e).lower()
        if "password" in error_msg or "encrypted" in error_msg:
            return None, "–§–∞–π–ª –∑–∞—â–∏—â–µ–Ω –ø–∞—Ä–æ–ª–µ–º. –°–Ω–∏–º–∏—Ç–µ –∑–∞—â–∏—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
        elif "corrupt" in error_msg or "invalid" in error_msg or "damaged" in error_msg:
            return None, "–§–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª."
        else:
            return None, f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ PDF: {str(e)}"
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [‚úÖ] –§—É–Ω–∫—Ü–∏—è `extract_from_pdf()` –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `PyPDF2`
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞—â–∏—Ç—É –ø–∞—Ä–æ–ª–µ–º (`is_encrypted`)
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç —Å–æ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–π –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–ª–æ—è
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ç–µ–∂ (—Ç–µ–∫—Å—Ç, –æ—à–∏–±–∫–∞)

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [‚úÖ] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 13.4: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –∏–∑ DOC (pywin32) [‚úÖ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `extract_from_doc()` –≤ —Ñ–∞–π–ª–µ `backend/services/document.py` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å .doc —Ñ–∞–π–ª–∞–º–∏ —á–µ—Ä–µ–∑ Microsoft Word COM.

> ‚ö†Ô∏è **–í–ê–ñ–ù–û:** –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –¢–û–õ–¨–ö–û –Ω–∞ Windows —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º Microsoft Word!

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**
–ó–∞–º–µ–Ω–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `extract_from_doc()` –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:

```python
def extract_from_doc(file_path: Path) -> Tuple[Optional[str], Optional[str]]:
    """
    –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ .doc —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ COM (pywin32).
  
    –í–ê–ñ–ù–û: –†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ Windows —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º Microsoft Word!
  
    Args:
        file_path: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É
  
    Returns:
        –ö–æ—Ä—Ç–µ–∂ (—Ç–µ–∫—Å—Ç, –æ—à–∏–±–∫–∞)
    """
    try:
        import pythoncom
        import win32com.client
    
        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è COM –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ—Ç–æ–∫–∞
        pythoncom.CoInitialize()
    
        try:
            # –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä Word
            word = win32com.client.Dispatch("Word.Application")
            word.Visible = False  # –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–∫–Ω–æ Word
        
            # –û—Ç–∫—Ä—ã—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
            # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –ø—É—Ç—å –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –¥–ª—è COM
            abs_path = str(file_path.resolve())
        
            try:
                doc = word.Documents.Open(abs_path, ReadOnly=True, PasswordDocument="")
            except Exception as e:
                if "password" in str(e).lower():
                    return None, "–§–∞–π–ª –∑–∞—â–∏—â–µ–Ω –ø–∞—Ä–æ–ª–µ–º. –°–Ω–∏–º–∏—Ç–µ –∑–∞—â–∏—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
                raise
        
            try:
                # –ò–∑–≤–ª–µ—á—å –≤–µ—Å—å —Ç–µ–∫—Å—Ç
                full_text = doc.Content.Text
            
                # –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç –∏–∑ —Ç–∞–±–ª–∏—Ü (–æ–Ω–∏ –º–æ–≥—É—Ç –Ω–µ –ø–æ–ø–∞—Å—Ç—å –≤ Content.Text)
                tables_text = []
                for table in doc.Tables:
                    table_content = []
                    for row in table.Rows:
                        row_text = []
                        for cell in row.Cells:
                            cell_text = cell.Range.Text.strip()
                            # –£–±—Ä–∞—Ç—å —Å–ª—É–∂–µ–±–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã Word
                            cell_text = cell_text.replace('\r', '').replace('\x07', '')
                            if cell_text:
                                row_text.append(cell_text)
                        if row_text:
                            table_content.append(" | ".join(row_text))
                    if table_content:
                        tables_text.append("\n".join(table_content))
            
                # –û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç
                result_text = full_text.strip()
                if tables_text:
                    result_text += "\n\n=== –¢–ê–ë–õ–ò–¶–´ ===\n\n" + "\n\n".join(tables_text)
            
                if not result_text.strip():
                    return None, "–§–∞–π–ª –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ –ø—É—Å—Ç."
            
                return result_text, None
            
            finally:
                # –ó–∞–∫—Ä—ã—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç –±–µ–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                doc.Close(SaveChanges=False)
            
        finally:
            # –ó–∞–∫—Ä—ã—Ç—å Word
            word.Quit()
            pythoncom.CoUninitialize()
        
    except ImportError:
        return None, "–ú–æ–¥—É–ª—å pywin32 –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install pywin32"
    except Exception as e:
        error_msg = str(e).lower()
        if "password" in error_msg:
            return None, "–§–∞–π–ª –∑–∞—â–∏—â–µ–Ω –ø–∞—Ä–æ–ª–µ–º. –°–Ω–∏–º–∏—Ç–µ –∑–∞—â–∏—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
        elif "corrupt" in error_msg or "cannot open" in error_msg:
            return None, "–§–∞–π–ª –ø–æ–≤—Ä–µ–∂–¥–µ–Ω –∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª."
        elif "word" in error_msg and ("not found" in error_msg or "failed" in error_msg):
            return None, "Microsoft Word –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .docx –∏–ª–∏ .pdf —Ñ–æ—Ä–º–∞—Ç."
        else:
            return None, f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ .doc —Ñ–∞–π–ª–∞: {str(e)}"
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [‚úÖ] –§—É–Ω–∫—Ü–∏—è `extract_from_doc()` –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `pythoncom` –∏ `win32com.client`
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç COM —á–µ—Ä–µ–∑ `pythoncom.CoInitialize()`
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä Word —á–µ—Ä–µ–∑ `win32com.client.Dispatch`
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –≤ —Ä–µ–∂–∏–º–µ ReadOnly
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ `doc.Content.Text`
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–∑ —Ç–∞–±–ª–∏—Ü
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –∏ Word –≤ –±–ª–æ–∫–µ `finally`
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç `pythoncom.CoUninitialize()` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏: –ø–∞—Ä–æ–ª—å, –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Word
- [‚úÖ] –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ç–µ–∂ (—Ç–µ–∫—Å—Ç, –æ—à–∏–±–∫–∞)

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [‚úÖ] –ó–∞–≤–µ—Ä—à–µ–Ω

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–∑—ã 13:**

- [‚úÖ] –í—Å–µ –ø–æ–¥—à–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [‚úÖ] –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [‚úÖ] –ò–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

## –§–ê–ó–ê 14: –°–ï–†–í–ò–°–´ - LLM –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø

### –®–∞–≥ 14.1: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã LLM —Å–µ—Ä–≤–∏—Å–∞ [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `backend/services/llm.py` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LLM.

**–§–∞–π–ª:** `backend/services/llm.py`

```python
from typing import Optional, Tuple
from openai import OpenAI
from backend.services.llm_config import get_llm_config, get_current_llm_type
from backend.services.prompts import get_prompt
from backend.services.tokens import track_tokens
from backend.services.logger import log_error

def analyze_contract(text: str, analysis_type: str, username: str) -> Tuple[Optional[str], Optional[str]]:
    """
    –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–æ–≥–æ–≤–æ—Ä —á–µ—Ä–µ–∑ LLM.
  
    Args:
        text: –¢–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞
        analysis_type: –¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞ ("summary" –∏–ª–∏ "legal_check")
        username: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–¥–ª—è —É—á–µ—Ç–∞ —Ç–æ–∫–µ–Ω–æ–≤)
  
    Returns:
        –ö–æ—Ä—Ç–µ–∂ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç, –æ—à–∏–±–∫–∞)
    """
    # –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–æ–º–ø—Ç
    prompt = get_prompt(analysis_type)
    if not prompt:
        return None, "–ü—Ä–æ–º–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω"
  
    # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø LLM
    llm_type = get_current_llm_type()
  
    if llm_type == "deepseek":
        return call_deepseek_api(prompt, text, username)
    elif llm_type == "lmstudio":
        return call_lmstudio_api(prompt, text, username)
    else:
        return None, f"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø LLM: {llm_type}"

def call_deepseek_api(prompt: str, text: str, username: str) -> Tuple[Optional[str], Optional[str]]:
    """
    –í—ã–∑–≤–∞—Ç—å DeepSeek API.
  
    Args:
        prompt: –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        text: –¢–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞
        username: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  
    Returns:
        –ö–æ—Ä—Ç–µ–∂ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç, –æ—à–∏–±–∫–∞)
    """
    # –ë—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ
    return None, "–§—É–Ω–∫—Ü–∏—è –µ—â–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞"

def call_lmstudio_api(prompt: str, text: str, username: str) -> Tuple[Optional[str], Optional[str]]:
    """
    –í—ã–∑–≤–∞—Ç—å LM Studio API.
  
    Args:
        prompt: –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        text: –¢–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞
        username: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  
    Returns:
        –ö–æ—Ä—Ç–µ–∂ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç, –æ—à–∏–±–∫–∞)
    """
    # –ë—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ–∑–∂–µ
    return None, "–§—É–Ω–∫—Ü–∏—è –µ—â–µ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞"
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `backend/services/llm.py` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [x] –§–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `OpenAI` –∏–∑ `openai`
- [x] –§–∞–π–ª –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –¥—Ä—É–≥–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `analyze_contract()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `call_deepseek_api()` (–∑–∞–≥–ª—É—à–∫–∞)
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `call_lmstudio_api()` (–∑–∞–≥–ª—É—à–∫–∞)
- [x] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–º–µ—é—Ç docstrings

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

**üö® FALLBACK-–°–¶–ï–ù–ê–†–ò–ò –î–õ–Ø LLM –ò–ù–¢–ï–ì–†–ê–¶–ò–ò:**

- –ï—Å–ª–∏ DeepSeek –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ LM Studio
- –ï—Å–ª–∏ –æ–±–∞ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ "–°–µ—Ä–≤–∏—Å –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
- –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω—ã –∑–∞–∫–æ–Ω—á–∏–ª–∏—Å—å ‚Üí graceful —Å–æ–æ–±—â–µ–Ω–∏–µ –±–µ–∑ –ø–∞–Ω–∏–∫–∏
- –ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º —Ç–∞–π–º–∞—É—Ç–æ–º
- –ü—Ä–∏ –æ—à–∏–±–∫–µ —Ç–æ–∫–µ–Ω–∏–∑–∞—Ü–∏–∏ ‚Üí fallback –Ω–∞ –ø—Ä–æ—Å—Ç—É—é –æ—Ü–µ–Ω–∫—É —Ä–∞–∑–º–µ—Ä–∞

---

### –®–∞–≥ 14.2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–∑–æ–≤–∞ DeepSeek API [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `call_deepseek_api()` –≤ —Ñ–∞–π–ª–µ `backend/services/llm.py`.

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**
–ó–∞–º–µ–Ω–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `call_deepseek_api()` –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:

```python
def call_deepseek_api(prompt: str, text: str, username: str) -> Tuple[Optional[str], Optional[str]]:
    """
    –í—ã–∑–≤–∞—Ç—å DeepSeek API.
  
    Args:
        prompt: –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        text: –¢–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞
        username: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  
    Returns:
        –ö–æ—Ä—Ç–µ–∂ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç, –æ—à–∏–±–∫–∞)
    """
    try:
        config = get_llm_config()
        api_key = config.get("deepseek_api_key", "")
        base_url = config.get("deepseek_base_url", "https://api.deepseek.com")
    
        if not api_key:
            return None, "API –∫–ª—é—á DeepSeek –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
    
        # –°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç OpenAI (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å DeepSeek)
        client = OpenAI(
            api_key=api_key,
            base_url=base_url,
            timeout=60.0
        )
    
        # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
        messages = [
            {"role": "system", "content": prompt},
            {"role": "user", "content": f"–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –¥–æ–≥–æ–≤–æ—Ä:\n\n{text}"}
        ]
    
        # –í—ã–∑–æ–≤ API
        response = client.chat.completions.create(
            model="deepseek-chat",
            messages=messages,
            temperature=0.7,
            max_tokens=4000
        )
    
        # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        result = response.choices[0].message.content
    
        # –£—á–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤
        prompt_tokens = response.usage.prompt_tokens
        completion_tokens = response.usage.completion_tokens
        track_tokens(username, prompt_tokens, completion_tokens)
    
        return result, None
    
    except Exception as e:
        error_msg = f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ DeepSeek API: {str(e)}"
        log_error(username, "deepseek_api_call", error_msg)
        return None, error_msg
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§—É–Ω–∫—Ü–∏—è `call_deepseek_api()` –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [x] –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ `get_llm_config()`
- [x] –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ API –∫–ª—é—á–∞
- [x] –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç `OpenAI()`
- [x] –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º –∏ —Ç–µ–∫—Å—Ç–æ–º
- [x] –§—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç `client.chat.completions.create()`
- [x] –§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ –æ—Ç–≤–µ—Ç–∞
- [x] –§—É–Ω–∫—Ü–∏—è —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã —á–µ—Ä–µ–∑ `track_tokens()`
- [x] –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 14.3: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã–∑–æ–≤–∞ LM Studio API [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `call_lmstudio_api()` –≤ —Ñ–∞–π–ª–µ `backend/services/llm.py`.

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å:**
–ó–∞–º–µ–Ω–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `call_lmstudio_api()` –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:

```python
def call_lmstudio_api(prompt: str, text: str, username: str) -> Tuple[Optional[str], Optional[str]]:
    """
    –í—ã–∑–≤–∞—Ç—å LM Studio API.
  
    Args:
        prompt: –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
        text: –¢–µ–∫—Å—Ç –¥–æ–≥–æ–≤–æ—Ä–∞
        username: –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–∫–µ–Ω—ã –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π LLM)
  
    Returns:
        –ö–æ—Ä—Ç–µ–∂ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç, –æ—à–∏–±–∫–∞)
    """
    try:
        config = get_llm_config()
        base_url = config.get("lmstudio_base_url", "http://localhost:1234/v1")
        model = config.get("lmstudio_model", "deepseek-coder")
    
        # –°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç OpenAI (—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å LM Studio)
        client = OpenAI(
            api_key="not-needed",  # LM Studio –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –∫–ª—é—á
            base_url=base_url,
            timeout=180.0  # –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
        )
    
        # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
        messages = [
            {"role": "system", "content": prompt},
            {"role": "user", "content": f"–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –¥–æ–≥–æ–≤–æ—Ä:\n\n{text}"}
        ]
    
        # –í—ã–∑–æ–≤ API
        response = client.chat.completions.create(
            model=model,
            messages=messages,
            temperature=0.7,
            max_tokens=4000
        )
    
        # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
        result = response.choices[0].message.content
    
        # –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: —Ç–æ–∫–µ–Ω—ã –ù–ï —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π LLM
    
        return result, None
    
    except Exception as e:
        error_msg = f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ LM Studio: {str(e)}"
        log_error(username, "lmstudio_api_call", error_msg)
    
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        if "Connection" in str(e) or "refused" in str(e):
            error_msg += "\n\n–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ LM Studio –∑–∞–ø—É—â–µ–Ω –∏ —Å–µ—Ä–≤–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω."
    
        return None, error_msg
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§—É–Ω–∫—Ü–∏—è `call_lmstudio_api()` –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [x] –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —á–µ—Ä–µ–∑ `get_llm_config()`
- [x] –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç `OpenAI()` —Å `api_key="not-needed"`
- [x] –§—É–Ω–∫—Ü–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ç–∞–π–º–∞—É—Ç (180 —Å–µ–∫—É–Ω–¥)
- [x] –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º –∏ —Ç–µ–∫—Å—Ç–æ–º
- [x] –§—É–Ω–∫—Ü–∏—è –≤—ã–∑—ã–≤–∞–µ—Ç `client.chat.completions.create()`
- [x] –§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ –æ—Ç–≤–µ—Ç–∞
- [x] –§—É–Ω–∫—Ü–∏—è –ù–ï —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–± —ç—Ç–æ–º –µ—Å—Ç—å)
- [x] –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

## –ö–†–ê–¢–ö–ê–Ø –°–ü–†–ê–í–ö–ê –ü–û –í–´–ü–û–õ–ù–ï–ù–ù–´–ú –§–ê–ó–ê–ú

**–ó–∞–≤–µ—Ä—à–µ–Ω–æ:**

- –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ (5 —à–∞–≥–æ–≤)
- –§–∞–∑–∞ 2: –ë–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (2 —à–∞–≥–∞)
- –§–∞–∑–∞ 3: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (5 —à–∞–≥–æ–≤)
- –§–∞–∑–∞ 4: –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è LLM (3 —à–∞–≥–∞)
- –§–∞–∑–∞ 5: Pydantic –º–æ–¥–µ–ª–∏ (1 —à–∞–≥)
- –§–∞–∑–∞ 6: –°–µ—Ä–≤–∏—Å—ã - JSON (1 —à–∞–≥)
- –§–∞–∑–∞ 7: –°–µ—Ä–≤–∏—Å—ã - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (2 —à–∞–≥–∞)
- –§–∞–∑–∞ 8: Middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (1 —à–∞–≥)
- –§–∞–∑–∞ 9: –°–µ—Ä–≤–∏—Å—ã - –ü—Ä–æ–º–ø—Ç—ã (1 —à–∞–≥)
- –§–∞–∑–∞ 10: –°–µ—Ä–≤–∏—Å—ã - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (2 —à–∞–≥–∞)
- –§–∞–∑–∞ 11: –°–µ—Ä–≤–∏—Å—ã - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (1 —à–∞–≥)
- –§–∞–∑–∞ 12: –°–µ—Ä–≤–∏—Å—ã - –¢–æ–∫–µ–Ω—ã (1 —à–∞–≥)
- –§–∞–∑–∞ 13: –°–µ—Ä–≤–∏—Å—ã - –î–æ–∫—É–º–µ–Ω—Ç—ã (3 —à–∞–≥–∞)
- –§–∞–∑–∞ 14: –°–µ—Ä–≤–∏—Å—ã - LLM (3 —à–∞–≥–∞)

**–ò—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:** 31 —à–∞–≥

**–û—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å:**

- –§–∞–∑–∞ 15: API Endpoints (10-12 —à–∞–≥–æ–≤)
- –§–∞–∑–∞ 16: Frontend HTML (3 —à–∞–≥–∞)
- –§–∞–∑–∞ 17: Frontend CSS (2 —à–∞–≥–∞)
- –§–∞–∑–∞ 18: Frontend JavaScript (8-10 —à–∞–≥–æ–≤)
- –§–∞–∑–∞ 19: Middleware Rate Limiting –∏ –û—á–µ—Ä–µ–¥—å (4 —à–∞–≥–∞)
- –§–∞–∑–∞ 20: –≠–∫—Å–ø–æ—Ä—Ç –≤ Word (2 —à–∞–≥–∞)
- –§–∞–∑–∞ 21: –°–∫—Ä–∏–ø—Ç—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è (3 —à–∞–≥–∞)
- –§–∞–∑–∞ 22: –§–∏–Ω–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (5 —à–∞–≥–æ–≤)

**–ü—Ä–∏–º–µ—Ä–Ω–æ –æ—Å—Ç–∞–ª–æ—Å—å:** ~40 —à–∞–≥–æ–≤

## –§–ê–ó–ê 15: API ENDPOINTS - –ê–í–¢–û–†–ò–ó–ê–¶–ò–Ø

### –®–∞–≥ 15.1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ endpoint –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `backend/main.py` endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ IP.

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ (–ø–µ—Ä–µ–¥ `if __name__ == "__main__":`)**:

```python
from backend.middleware.auth import get_client_ip
from backend.services.auth import get_user_by_ip
from backend.models.schemas import AuthCheckResponse

@app.get("/api/check-auth", response_model=AuthCheckResponse)
async def check_auth(request: Request):
    """
    –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø–æ IP-–∞–¥—Ä–µ—Å—É.
    """
    ip = get_client_ip(request)
    user = get_user_by_ip(ip)
  
    if user:
        return AuthCheckResponse(
            authorized=True,
            username=user["username"],
            role=user["role"],
            ip=ip
        )
    else:
        return AuthCheckResponse(
            authorized=False,
            ip=ip
        )
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] Endpoint `/api/check-auth` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `backend/main.py`
- [x] Endpoint –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –º–æ–¥–µ–ª–∏
- [x] Endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `get_client_ip()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è IP
- [x] Endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `get_user_by_ip()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [x] Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `AuthCheckResponse`
- [x] Endpoint —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫ (–º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø—É—Å—Ç–∏–≤ —Å–µ—Ä–≤–µ—Ä)

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 15.2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ endpoint –ª–æ–≥–∏–Ω–∞ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `backend/main.py` endpoint –¥–ª—è –ª–æ–≥–∏–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**

```python
from backend.services.users import verify_credentials
from backend.services.auth import authorize_ip
from backend.models.schemas import LoginRequest, LoginResponse
from backend.services.logger import log_user_action

@app.post("/api/login", response_model=LoginResponse)
async def login(request: Request, credentials: LoginRequest):
    """
    –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –ª–æ–≥–∏–Ω—É/–ø–∞—Ä–æ–ª—é –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å IP.
    """
    ip = get_client_ip(request)
  
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    user = verify_credentials(credentials.username, credentials.password)
  
    if user:
        # –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å IP
        authorize_ip(ip, user["username"])
    
        # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
        log_user_action(user["username"], "login", f"IP: {ip}")
    
        return LoginResponse(
            success=True,
            message="–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞",
            ip=ip
        )
    else:
        return LoginResponse(
            success=False,
            message="–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å"
        )
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] Endpoint `/api/login` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `backend/main.py`
- [x] Endpoint –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –º–æ–¥–µ–ª–∏
- [x] Endpoint –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `LoginRequest` –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞
- [x] Endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `verify_credentials()` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
- [x] Endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `authorize_ip()` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è IP
- [x] Endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `log_user_action()` –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- [x] Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `LoginResponse`

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### üîó **–ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–ï –ü–†–û–í–ï–†–ö–ò –ü–û–°–õ–ï –§–ê–ó–´ 15**

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ API endpoints –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã.

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –í—Å–µ endpoints –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- [x] Endpoints –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç middleware –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ HTTP –∫–æ–¥—ã –∏ —Å–æ–æ–±—â–µ–Ω–∏—è

**–ú–∏–Ω–∏-—Ç–µ—Å—Ç—ã:**

```bash
# –¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
cd backend
timeout 10 python main.py &
sleep 3

# –¢–µ—Å—Ç endpoints (–≤ –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ)
curl -s http://localhost:8000/health | grep -q "healthy" && echo "Health OK"
curl -s http://localhost:8000/api/status | grep -q "–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–æ–≤" && echo "Status OK"

# –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞
pkill -f "python main.py"
```

**Fallback-—Å—Ü–µ–Ω–∞—Ä–∏–π:**

- –ï—Å–ª–∏ endpoint –ø–∞–¥–∞–µ—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 500 —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- –ï—Å–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

---

## –§–ê–ó–ê 16: API ENDPOINTS - –ê–ù–ê–õ–ò–ó –î–û–ì–û–í–û–†–û–í

### –®–∞–≥ 16.1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ endpoint –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–∞ —Å Rate Limiting –∏ –æ—á–µ—Ä–µ–¥—å—é [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `backend/main.py` endpoint –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Rate Limiting –∏ —Å–∏—Å—Ç–µ–º—ã –æ—á–µ—Ä–µ–¥–∏.

> ‚ö†Ô∏è **–í–ê–ñ–ù–û:** –≠—Ç–æ—Ç endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Rate Limiting –∏ Queue Manager, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –≤ –§–∞–∑–µ 8.

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ (–∏–º–ø–æ—Ä—Ç—ã):**

```python
from fastapi import UploadFile, File, Form, Depends, HTTPException
from backend.middleware.auth import require_auth
from backend.middleware.rate_limit import limiter, rate_limit_exceeded_handler
from slowapi.errors import RateLimitExceeded
from backend.services.document import extract_text_from_file, check_text_size
from backend.services.llm import analyze_contract
from backend.services.queue import request_queue
from backend.models.schemas import AnalyzeResponse
from backend.services.logger import log_user_action, log_error
from backend.services.settings import get_max_file_size_bytes
import tempfile

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å Rate Limiter –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
app.state.limiter = limiter
app.add_exception_handler(RateLimitExceeded, rate_limit_exceeded_handler)
```

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å (endpoint):**

```python
@app.post("/api/analyze", response_model=AnalyzeResponse)
@limiter.limit("10/minute")  # Rate limiting: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
async def analyze_document(
    request: Request,
    file: UploadFile = File(...),
    analysis_type: str = Form(...),
    user: dict = Depends(require_auth)
):
    """
    –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π –¥–æ–≥–æ–≤–æ—Ä.
  
    –í–∫–ª—é—á–∞–µ—Ç:
    - Rate Limiting: 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
    - –û—á–µ—Ä–µ–¥—å: –¥–æ 5 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç–æ–∫ + 5 –≤ –æ—á–µ—Ä–µ–¥–∏
    """
    username = user["username"]
  
    # ===== –ü–†–û–í–ï–†–ö–ê –û–ß–ï–†–ï–î–ò =====
    queue_result = await request_queue.acquire()
  
    if not queue_result["allowed"]:
        # –û—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞
        return AnalyzeResponse(
            success=False,
            error=queue_result.get("error", "–°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.")
        )
  
    if queue_result.get("queued"):
        # –ó–∞–ø—Ä–æ—Å –≤ –æ—á–µ—Ä–µ–¥–∏ - –∂–¥–µ–º —Å–ª–æ—Ç
        await request_queue.wait_for_slot()
  
    try:
        # ===== –í–ê–õ–ò–î–ê–¶–ò–Ø –§–ê–ô–õ–ê =====
    
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ–∞–π–ª–∞
        file_extension = Path(file.filename).suffix.lower()
        if file_extension not in [".doc", ".docx", ".pdf"]:
            return AnalyzeResponse(
                success=False,
                error="–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –î–æ–ø—É—Å—Ç–∏–º—ã: .doc, .docx, .pdf"
            )
    
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
        max_size = get_max_file_size_bytes()
        file_content = await file.read()
        if len(file_content) > max_size:
            max_size_mb = max_size // (1024 * 1024)
            return AnalyzeResponse(
                success=False,
                error=f"–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –¥–æ–ø—É—Å—Ç–∏–º—ã–π –ª–∏–º–∏—Ç ({max_size_mb} –ú–ë)."
            )
    
        # ===== –û–ë–†–ê–ë–û–¢–ö–ê –§–ê–ô–õ–ê =====
    
        # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
        with tempfile.NamedTemporaryFile(delete=False, suffix=file_extension) as tmp_file:
            tmp_file.write(file_content)
            tmp_path = Path(tmp_file.name)
    
        try:
            # –ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç
            text, error = extract_text_from_file(tmp_path, file_extension)
        
            if error:
                log_error(username, "document_extract", error)
                return AnalyzeResponse(success=False, error=error)
        
            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞
            size_ok, size_error = check_text_size(text)
            if not size_ok:
                log_error(username, "document_size_check", size_error)
                return AnalyzeResponse(success=False, error=size_error)
        
            # ===== –ê–ù–ê–õ–ò–ó –ß–ï–†–ï–ó LLM =====
        
            result, llm_error = analyze_contract(text, analysis_type, username)
        
            if llm_error:
                log_error(username, "llm_analyze", llm_error)
                return AnalyzeResponse(success=False, error=llm_error)
        
            # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —É—Å–ø–µ—à–Ω—ã–π –∞–Ω–∞–ª–∏–∑
            log_user_action(username, "analyze", f"{file.filename} ({analysis_type})")
        
            return AnalyzeResponse(
                success=True,
                analysis_type=analysis_type,
                result=result,
                filename=file.filename
            )
        
        finally:
            # –£–¥–∞–ª–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
            if tmp_path.exists():
                tmp_path.unlink()
            
    except Exception as e:
        error_msg = f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–∞–π–ª–∞: {str(e)}"
        log_error(username, "analyze_unexpected", error_msg)
        return AnalyzeResponse(success=False, error=error_msg)
  
    finally:
        # ===== –û–°–í–û–ë–û–ñ–î–ï–ù–ò–ï –°–õ–û–¢–ê –í –û–ß–ï–†–ï–î–ò =====
        await request_queue.release()
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] Endpoint `/api/analyze` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `backend/main.py`
- [x] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω `limiter` –∏ `rate_limit_exceeded_handler` –∏–∑ `backend.middleware.rate_limit`
- [x] –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω `request_queue` –∏–∑ `backend.services.queue`
- [x] –í –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω limiter: `app.state.limiter = limiter`
- [x] –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –¥–ª—è `RateLimitExceeded`
- [x] Endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä `@limiter.limit("10/minute")`
- [x] Endpoint –≤—ã–∑—ã–≤–∞–µ—Ç `request_queue.acquire()` –ø–µ—Ä–µ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- [x] Endpoint –≤—ã–∑—ã–≤–∞–µ—Ç `request_queue.wait_for_slot()` –µ—Å–ª–∏ –≤ –æ—á–µ—Ä–µ–¥–∏
- [x] Endpoint –≤—ã–∑—ã–≤–∞–µ—Ç `request_queue.release()` –≤ –±–ª–æ–∫–µ `finally`
- [x] Endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Depends(require_auth)` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- [x] Endpoint –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∏ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
- [x] Endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `tempfile` –∏ —É–¥–∞–ª—è–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
- [x] Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `AnalyzeResponse`

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### üîó **–ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–ï –ü–†–û–í–ï–†–ö–ò –ü–û–°–õ–ï –§–ê–ó–´ 16**

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ endpoint –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å–æ –≤—Å–µ–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏.

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] Rate limiting –∏ –æ—á–µ—Ä–µ–¥—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ endpoint
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å tempfile
- [x] LLM —Å–µ—Ä–≤–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
- [x] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—á–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ graceful

**–ú–∏–Ω–∏-—Ç–µ—Å—Ç—ã:**

```bash
# –¢–µ—Å—Ç –∏–º–ø–æ—Ä—Ç–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞
cd backend
python -c "
from main import app
from services.document import extract_text_from_file
from services.llm import analyze_contract
from services.queue import request_queue
print('Analysis components imported successfully')
"

# –¢–µ—Å—Ç –Ω–∞–ª–∏—á–∏—è endpoint'–∞
python -c "
from main import app
routes = [route.path for route in app.routes if hasattr(route, 'path')]
analyze_route = any('/api/analyze' in str(route) for route in routes)
print('Analyze endpoint exists:', analyze_route)
"
```

**Fallback-—Å—Ü–µ–Ω–∞—Ä–∏–π:**

- –ï—Å–ª–∏ –æ—á–µ—Ä–µ–¥—å –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞ ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 503 —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º
- –ï—Å–ª–∏ LLM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 503 —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º retry
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞ ‚Üí —É–¥–∞–ª—è—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å 400

---

## –§–ê–ó–ê 17: API ENDPOINTS - –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ (–ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ò)

### –®–∞–≥ 17.1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ endpoint –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `backend/main.py` endpoint –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞).

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**

```python
from backend.middleware.auth import require_admin
from backend.services.users import get_all_users

@app.get("/api/admin/users")
async def admin_get_users(user: dict = Depends(require_admin)):
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ç–æ–ª—å–∫–æ –¥–ª—è admin).
    """
    users = get_all_users()
    return {"success": True, "users": users}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] Endpoint `/api/admin/users` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `backend/main.py`
- [x] Endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Depends(require_admin)` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤
- [x] Endpoint –≤—ã–∑—ã–≤–∞–µ—Ç `get_all_users()`
- [x] Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å `success` –∏ `users`

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 17.2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ endpoint —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `backend/main.py` endpoint –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**

```python
from backend.services.users import create_user
from backend.models.schemas import UserCreate

@app.post("/api/admin/users")
async def admin_create_user(
    user_data: UserCreate,
    user: dict = Depends(require_admin)
):
    """
    –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ –¥–ª—è admin).
    """
    success = create_user(
        username=user_data.username,
        password=user_data.password,
        role=user_data.role
    )
  
    if success:
        log_user_action(user["username"], "create_user", f"–°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {user_data.username}")
        return {
            "success": True,
            "message": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω",
            "username": user_data.username
        }
    else:
        return {
            "success": False,
            "error": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º –ª–æ–≥–∏–Ω–æ–º —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
        }
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] Endpoint `/api/admin/users` (POST) –¥–æ–±–∞–≤–ª–µ–Ω
- [x] Endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Depends(require_admin)`
- [x] Endpoint –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `UserCreate` –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞
- [x] Endpoint –≤—ã–∑—ã–≤–∞–µ—Ç `create_user()`
- [x] Endpoint –ª–æ–≥–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- [x] Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫—É

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 17.3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ endpoint —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `backend/main.py` endpoint –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**

```python
from backend.services.users import update_user
from backend.models.schemas import UserUpdate

@app.put("/api/admin/users/{username}")
async def admin_update_user(
    username: str,
    user_data: UserUpdate,
    user: dict = Depends(require_admin)
):
    """
    –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç–æ–ª—å–∫–æ –¥–ª—è admin).
    """
    success = update_user(
        username=username,
        password=user_data.password,
        role=user_data.role
    )
  
    if success:
        log_user_action(user["username"], "update_user", f"–û–±–Ω–æ–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {username}")
        return {
            "success": True,
            "message": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω"
        }
    else:
        return {
            "success": False,
            "error": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω"
        }
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] Endpoint `/api/admin/users/{username}` (PUT) –¥–æ–±–∞–≤–ª–µ–Ω
- [x] Endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Depends(require_admin)`
- [x] Endpoint –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `username` –≤ –ø—É—Ç–∏ –∏ `UserUpdate` –≤ —Ç–µ–ª–µ
- [x] Endpoint –≤—ã–∑—ã–≤–∞–µ—Ç `update_user()`
- [x] Endpoint –ª–æ–≥–∏—Ä—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
- [x] Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É—Å–ø–µ—Ö –∏–ª–∏ –æ—à–∏–±–∫—É

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∞–∑—ã 17:**

- [x] –í—Å–µ –ø–æ–¥—à–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [x] –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [x] –ò–º–ø–æ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [x] Endpoint'—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ backend/main.py
- [x] –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ middleware require_admin
- [x] –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –∫–æ–¥–∏—Ä–æ–≤–∫–µ UTF-8

---

## –§–ê–ó–ê 18: API ENDPOINTS - –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ (–ü–†–û–ú–ü–¢–´)

### –®–∞–≥ 18.1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ endpoints –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `backend/main.py` endpoints –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —Å–±—Ä–æ—Å–∞ –ø—Ä–æ–º–ø—Ç–æ–≤.

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**

```python
from backend.services.prompts import get_all_prompts, save_prompt, reset_prompt
from backend.models.schemas import PromptSaveRequest, PromptResetRequest

@app.get("/api/admin/prompts")
async def admin_get_prompts(user: dict = Depends(require_admin)):
    """
    –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ–º–ø—Ç—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è admin).
    """
    prompts = get_all_prompts()
    return {"success": True, "prompts": prompts}

@app.post("/api/admin/prompts")
async def admin_save_prompt(
    data: PromptSaveRequest,
    user: dict = Depends(require_admin)
):
    """
    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—Ä–æ–º–ø—Ç (—Ç–æ–ª—å–∫–æ –¥–ª—è admin).
    """
    success = save_prompt(data.prompt_type, data.content)
  
    if success:
        log_user_action(user["username"], "save_prompt", f"–¢–∏–ø: {data.prompt_type}")
        return {"success": True, "message": "–ü—Ä–æ–º–ø—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω"}
    else:
        return {"success": False, "error": "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ–º–ø—Ç–∞"}

@app.post("/api/admin/prompts/reset")
async def admin_reset_prompt(
    data: PromptResetRequest,
    user: dict = Depends(require_admin)
):
    """
    –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é (—Ç–æ–ª—å–∫–æ –¥–ª—è admin).
    """
    content = reset_prompt(data.prompt_type)
  
    if content:
        log_user_action(user["username"], "reset_prompt", f"–¢–∏–ø: {data.prompt_type}")
        return {
            "success": True,
            "message": "–ü—Ä–æ–º–ø—Ç —Å–±—Ä–æ—à–µ–Ω –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é",
            "content": content
        }
    else:
        return {"success": False, "error": "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –ø—Ä–æ–º–ø—Ç–∞"}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] Endpoint `/api/admin/prompts` (GET) –¥–æ–±–∞–≤–ª–µ–Ω
- [x] Endpoint `/api/admin/prompts` (POST) –¥–æ–±–∞–≤–ª–µ–Ω
- [x] Endpoint `/api/admin/prompts/reset` (POST) –¥–æ–±–∞–≤–ª–µ–Ω
- [x] –í—Å–µ endpoints –∏—Å–ø–æ–ª—å–∑—É—é—Ç `Depends(require_admin)`
- [x] Endpoints –≤—ã–∑—ã–≤–∞—é—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `prompts` —Å–µ—Ä–≤–∏—Å–∞
- [x] Endpoints –ª–æ–≥–∏—Ä—É—é—Ç –¥–µ–π—Å—Ç–≤–∏—è
- [x] Endpoints –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

## –§–ê–ó–ê 19: API ENDPOINTS - –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–¨ (–ù–ê–°–¢–†–û–ô–ö–ò –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ê)

### –®–∞–≥ 19.1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ endpoints –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ LLM [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `backend/main.py` endpoints –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ LLM.

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**

```python
from backend.services.llm_config import get_llm_config, update_llm_config
from backend.models.schemas import LLMConfigUpdate

@app.get("/api/admin/llm-config")
async def admin_get_llm_config(user: dict = Depends(require_admin)):
    """
    –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ LLM (—Ç–æ–ª—å–∫–æ –¥–ª—è admin).
    """
    config = get_llm_config()
    return {"success": True, "config": config}

@app.post("/api/admin/llm-config")
async def admin_update_llm_config(
    data: LLMConfigUpdate,
    user: dict = Depends(require_admin)
):
    """
    –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ LLM (—Ç–æ–ª—å–∫–æ –¥–ª—è admin).
    """
    updates = data.dict(exclude_unset=True)
    success = update_llm_config(updates)
  
    if success:
        log_user_action(user["username"], "update_llm_config", f"–û–±–Ω–æ–≤–ª–µ–Ω–æ –ø–æ–ª–µ–π: {len(updates)}")
        return {"success": True, "message": "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ LLM –æ–±–Ω–æ–≤–ª–µ–Ω—ã"}
    else:
        return {"success": False, "error": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫"}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] Endpoint `/api/admin/llm-config` (GET) –¥–æ–±–∞–≤–ª–µ–Ω
- [x] Endpoint `/api/admin/llm-config` (POST) –¥–æ–±–∞–≤–ª–µ–Ω
- [x] Endpoints –∏—Å–ø–æ–ª—å–∑—É—é—Ç `Depends(require_admin)`
- [x] Endpoints –≤—ã–∑—ã–≤–∞—é—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `llm_config` —Å–µ—Ä–≤–∏—Å–∞
- [x] POST endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `.dict(exclude_unset=True)` –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- [x] Endpoints –ª–æ–≥–∏—Ä—É—é—Ç –¥–µ–π—Å—Ç–≤–∏—è

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 19.2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ endpoints –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏—Å—Ç–µ–º—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `backend/main.py` endpoints –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏—Å—Ç–µ–º—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤.

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**

```python
from backend.services.settings import get_settings, update_settings
from backend.services.tokens import get_tokens_stats, format_stats_for_display
from backend.services.logger import get_logs
from backend.models.schemas import SettingsUpdate

@app.get("/api/admin/settings")
async def admin_get_settings(user: dict = Depends(require_admin)):
    """
    –ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è admin).
    """
    settings = get_settings()
    return {"success": True, "settings": settings}

@app.post("/api/admin/settings")
async def admin_update_settings(
    data: SettingsUpdate,
    user: dict = Depends(require_admin)
):
    """
    –û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è admin).
    """
    updates = data.dict(exclude_unset=True)
    success = update_settings(updates)
  
    if success:
        log_user_action(user["username"], "update_settings", f"–û–±–Ω–æ–≤–ª–µ–Ω–æ –ø–æ–ª–µ–π: {len(updates)}")
        return {"success": True, "message": "–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã"}
    else:
        return {"success": False, "error": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫"}

@app.get("/api/admin/tokens-stats")
async def admin_get_tokens_stats(user: dict = Depends(require_admin)):
    """
    –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è admin).
    """
    stats = get_tokens_stats()
    formatted_stats = format_stats_for_display(stats)
    return {"success": True, "stats": formatted_stats}

@app.get("/api/admin/logs")
async def admin_get_logs(
    log_type: str = "app",
    limit: int = 100,
    user: dict = Depends(require_admin)
):
    """
    –ü–æ–ª—É—á–∏—Ç—å –ª–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã (—Ç–æ–ª—å–∫–æ –¥–ª—è admin).
    """
    logs = get_logs(log_type, limit)
    return {"success": True, "logs": logs}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] Endpoint `/api/admin/settings` (GET) –¥–æ–±–∞–≤–ª–µ–Ω
- [x] Endpoint `/api/admin/settings` (POST) –¥–æ–±–∞–≤–ª–µ–Ω
- [x] Endpoint `/api/admin/tokens-stats` (GET) –¥–æ–±–∞–≤–ª–µ–Ω
- [x] Endpoint `/api/admin/logs` (GET) –¥–æ–±–∞–≤–ª–µ–Ω
- [x] –í—Å–µ endpoints –∏—Å–ø–æ–ª—å–∑—É—é—Ç `Depends(require_admin)`
- [x] Endpoints –≤—ã–∑—ã–≤–∞—é—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- [x] Endpoints –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

## –ö–†–ê–¢–ö–û–ï –†–ï–ó–Æ–ú–ï –ü–†–û–ì–†–ï–°–°–ê

**–í—Å–µ–≥–æ —Å–æ–∑–¥–∞–Ω–æ —à–∞–≥–æ–≤:** 43

**–§–∞–∑—ã –≥–æ—Ç–æ–≤—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

- ‚úÖ –§–∞–∑–∞ 1-14: –í—Å—è backend –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (31 —à–∞–≥)
- ‚úÖ –§–∞–∑–∞ 15-19: –í—Å–µ API endpoints (12 —à–∞–≥–æ–≤)

**–ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å:**

- Frontend HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã (3-4 —à–∞–≥–∞)
- Frontend CSS —Å—Ç–∏–ª–∏ (2-3 —à–∞–≥–∞)
- Frontend JavaScript –ª–æ–≥–∏–∫–∞ (8-10 —à–∞–≥–æ–≤)
- –≠–∫—Å–ø–æ—Ä—Ç –≤ Word (2 —à–∞–≥–∞)
- –°–∫—Ä–∏–ø—Ç—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è (3-4 —à–∞–≥–∞)
- –ò—Ç–æ–≥–æ–≤–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (2-3 —à–∞–≥–∞)

**–ü—Ä–∏–º–µ—Ä–Ω–æ –æ—Å—Ç–∞–ª–æ—Å—å:** 20-26 —à–∞–≥–æ–≤

---

## –°–õ–ï–î–£–Æ–©–ò–ô –≠–¢–ê–ü

–ü–ª–∞–Ω —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ backend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ API endpoints.

**–ß—Ç–æ–±—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø–ª–∞–Ω, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:**

1. Frontend (HTML/CSS/JS) - –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Word
3. –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
4. –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## –§–ê–ó–ê 20: –≠–ö–°–ü–û–†–¢ –í WORD

### –®–∞–≥ 20.1: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è Word –¥–æ–∫—É–º–µ–Ω—Ç–∞ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞ `backend/services/document.py` —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Word.

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**

```python
from docx import Document
from docx.shared import Pt, RGBColor
from io import BytesIO
import re

def create_word_document(content: str, filename: str = "–ê–Ω–∞–ª–∏–∑_–¥–æ–≥–æ–≤–æ—Ä–∞") -> BytesIO:
    """
    –°–æ–∑–¥–∞—Ç—å Word –¥–æ–∫—É–º–µ–Ω—Ç –∏–∑ markdown-–∫–æ–Ω—Ç–µ–Ω—Ç–∞.
  
    Args:
        content: –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown
        filename: –ò–º—è —Ñ–∞–π–ª–∞ (–±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è)
  
    Returns:
        BytesIO –æ–±—ä–µ–∫—Ç —Å —Å–æ–¥–µ—Ä–∂–∏–º—ã–º .docx —Ñ–∞–π–ª–∞
    """
    doc = Document()
  
    # –†–∞–∑–±–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞ —Å—Ç—Ä–æ–∫–∏
    lines = content.split('\n')
  
    for line in lines:
        line = line.strip()
    
        if not line:
            # –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ - –¥–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–≥—Ä–∞—Ñ
            doc.add_paragraph()
            continue
    
        # –ó–∞–≥–æ–ª–æ–≤–∫–∏ (–Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å #)
        if line.startswith('#'):
            level = len(re.match(r'^#+', line).group())
            title = line.lstrip('#').strip()
        
            heading = doc.add_heading(title, level=min(level, 3))
            continue
    
        # –¢–∞–±–ª–∏—Ü—ã (—Å—Ç—Ä–æ–∫–∏ —Å |)
        if '|' in line:
            # –ü—Ä–æ—Å—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü - –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º —à–∞–≥–µ
            doc.add_paragraph(line)
            continue
    
        # –û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
        doc.add_paragraph(line)
  
    # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ BytesIO
    doc_io = BytesIO()
    doc.save(doc_io)
    doc_io.seek(0)
  
    return doc_io
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§—É–Ω–∫—Ü–∏—è `create_word_document()` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ `backend/services/document.py`
- [x] –§—É–Ω–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `Document` –∏–∑ `docx`
- [x] –§—É–Ω–∫—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `BytesIO` –∏–∑ `io`
- [x] –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —á–µ—Ä–µ–∑ `Document()`
- [x] –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ (—Å—Ç—Ä–æ–∫–∏ —Å #)
- [x] –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã (—Å—Ç—Ä–æ–∫–∏ —Å |)
- [x] –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
- [x] –§—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `BytesIO` –æ–±—ä–µ–∫—Ç
- [x] –§—É–Ω–∫—Ü–∏—è –∏–º–µ–µ—Ç docstring

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 20.2: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ endpoint —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Word [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–î–æ–±–∞–≤—å—Ç–µ –≤ —Ñ–∞–π–ª `backend/main.py` endpoint –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Word.

**–ß—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å:**

```python
from fastapi.responses import StreamingResponse
from backend.services.document import create_word_document
from backend.models.schemas import ExportRequest

@app.post("/api/export")
async def export_to_word(
    data: ExportRequest,
    user: dict = Depends(require_auth)
):
    """
    –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞ –≤ Word –¥–æ–∫—É–º–µ–Ω—Ç.
    """
    try:
        # –°–æ–∑–¥–∞—Ç—å Word –¥–æ–∫—É–º–µ–Ω—Ç
        doc_io = create_word_document(data.content, data.filename)

        # –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç
        log_user_action(user["username"], "export", f"–§–∞–π–ª: {data.filename}.docx")

        # –í–µ—Ä–Ω—É—Ç—å —Ñ–∞–π–ª
        return StreamingResponse(
            doc_io,
            media_type="application/vnd.openxmlformats-officedocument.wordprocessingml.document",
            headers={
                "Content-Disposition": f'attachment; filename="{data.filename}.docx"'
            }
        )
    except Exception as e:
        error_msg = f"–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞: {str(e)}"
        log_error(user["username"], "export", error_msg)
        return {"success": False, "error": error_msg}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] Endpoint `/api/export` (POST) –¥–æ–±–∞–≤–ª–µ–Ω
- [x] Endpoint –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `StreamingResponse`
- [x] Endpoint –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç `create_word_document` –∏ `ExportRequest`
- [x] Endpoint –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `Depends(require_auth)`
- [x] Endpoint –≤—ã–∑—ã–≤–∞–µ—Ç `create_word_document()`
- [x] Endpoint –ª–æ–≥–∏—Ä—É–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç
- [x] Endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `StreamingResponse` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º MIME-—Ç–∏–ø–æ–º
- [x] Endpoint —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Content-Disposition`
- [x] Endpoint –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

## –§–ê–ó–ê 21: FRONTEND - HTML –°–¢–†–ê–ù–ò–¶–´

### –®–∞–≥ 21.1: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `frontend/login.html` —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü–µ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏.

**–§–∞–π–ª:** `frontend/login.html`

```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è - –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–æ–≤</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <div class="login-box">
            <h1>–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–æ–≤</h1>
            <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
        
            <form id="loginForm">
                <div class="form-group">
                    <label for="username">–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="username" name="username" required autofocus>
                </div>
            
                <div class="form-group">
                    <label for="password">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="password" name="password" required>
                </div>
            
                <button type="submit" class="btn btn-primary">–í–æ–π—Ç–∏</button>
            </form>
        
            <div id="error-message" class="error-message" style="display: none;"></div>
        </div>
    </div>
  
    <script src="/static/js/app.js"></script>
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', checkAuthAndRedirect);
    
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –ª–æ–≥–∏–Ω–∞
        document.getElementById('loginForm').addEventListener('submit', handleLogin);
    </script>
</body>
</html>
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `frontend/login.html` —Å–æ–∑–¥–∞–Ω
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç DOCTYPE –∏ HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- [x] –§–∞–π–ª –ø–æ–¥–∫–ª—é—á–∞–µ—Ç `/static/css/style.css`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–æ—Ä–º—É —Å –ø–æ–ª—è–º–∏ `username` –∏ `password`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–Ω–æ–ø–∫—É "–í–æ–π—Ç–∏"
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –±–ª–æ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫
- [x] –§–∞–π–ª –ø–æ–¥–∫–ª—é—á–∞–µ—Ç `/static/js/app.js`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 21.2: –°–æ–∑–¥–∞–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `frontend/index.html` —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤.

**–§–∞–π–ª:** `frontend/index.html`

```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–æ–≤</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <div class="header">
        <h1>–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–æ–≤</h1>
        <div class="user-info">
            <span id="username-display"></span>
            <button onclick="logout()" class="btn btn-secondary">–í—ã–π—Ç–∏</button>
        </div>
    </div>
  
    <div class="container">
        <div class="upload-section">
            <h2>–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–≥–æ–≤–æ—Ä –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞</h2>
        
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="file">–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª (.doc, .docx, .pdf):</label>
                    <input type="file" id="file" name="file" accept=".doc,.docx,.pdf" required>
                    <span id="file-name"></span>
                </div>
            
                <div class="form-group">
                    <label>–¢–∏–ø –∞–Ω–∞–ª–∏–∑–∞:</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="analysis_type" value="summary" checked>
                            –î–µ—Ç–∞–ª—å–Ω–∞—è –≤—ã–∂–∏–º–∫–∞ –¥–æ–≥–æ–≤–æ—Ä–∞
                        </label>
                        <label>
                            <input type="radio" name="analysis_type" value="legal_check">
                            –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É –†–§
                        </label>
                    </div>
                </div>
            
                <button type="submit" class="btn btn-primary">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å</button>
            </form>
        
            <div id="progress-section" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                </div>
                <p id="progress-text">–ò–¥–µ—Ç –∞–Ω–∞–ª–∏–∑ –¥–æ–≥–æ–≤–æ—Ä–∞...</p>
            </div>
        
            <div id="error-message" class="error-message" style="display: none;"></div>
        </div>
    
        <div id="result-section" class="result-section" style="display: none;">
            <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç –∞–Ω–∞–ª–∏–∑–∞</h2>
            <div id="result-content"></div>
            <div class="result-actions">
                <button onclick="exportToWord()" class="btn btn-primary">–°–∫–∞—á–∞—Ç—å –≤ Word</button>
                <button onclick="copyToClipboard()" class="btn btn-secondary">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </div>
    </div>
  
    <script src="/static/js/app.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `frontend/index.html` —Å–æ–∑–¥–∞–Ω
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ–æ—Ä–º—É –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—ã–±–æ—Ä —Ç–∏–ø–∞ –∞–Ω–∞–ª–∏–∑–∞ (radio buttons)
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–∫—Ü–∏—é –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–∫—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (—Å–∫—Ä—ã—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–Ω–æ–ø–∫–∏ —ç–∫—Å–ø–æ—Ä—Ç–∞ –∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- [x] –§–∞–π–ª –ø–æ–¥–∫–ª—é—á–∞–µ—Ç `marked.js` –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ Markdown
- [x] –§–∞–π–ª –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç—ã

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 21.3: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `frontend/admin.html` —Å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.

**–§–∞–π–ª:** `frontend/admin.html`

```html
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–æ–≤</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/admin.css">
</head>
<body>
    <div class="header">
        <h1>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h1>
        <div class="user-info">
            <span id="username-display"></span>
            <a href="/static/index.html" class="btn btn-secondary">–ê–Ω–∞–ª–∏–∑ –¥–æ–≥–æ–≤–æ—Ä–æ–≤</a>
            <button onclick="logout()" class="btn btn-secondary">–í—ã–π—Ç–∏</button>
        </div>
    </div>
  
    <div class="container admin-container">
        <div class="tabs">
            <button class="tab-button active" onclick="showTab('users')">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
            <button class="tab-button" onclick="showTab('prompts')">–ü—Ä–æ–º–ø—Ç—ã</button>
            <button class="tab-button" onclick="showTab('llm')">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ LLM</button>
            <button class="tab-button" onclick="showTab('settings')">–°–∏—Å—Ç–µ–º–∞</button>
            <button class="tab-button" onclick="showTab('stats')">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
            <button class="tab-button" onclick="showTab('logs')">–õ–æ–≥–∏</button>
        </div>
    
        <div id="users-tab" class="tab-content active">
            <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>
            <div id="users-list"></div>
            <button onclick="showCreateUserForm()" class="btn btn-primary">–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
        </div>
    
        <div id="prompts-tab" class="tab-content">
            <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–∞–º–∏</h2>
            <div id="prompts-content"></div>
        </div>
    
        <div id="llm-tab" class="tab-content">
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ LLM</h2>
            <div id="llm-config"></div>
        </div>
    
        <div id="settings-tab" class="tab-content">
            <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
            <div id="settings-content"></div>
        </div>
    
        <div id="stats-tab" class="tab-content">
            <h2>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤</h2>
            <div id="stats-content"></div>
        </div>
    
        <div id="logs-tab" class="tab-content">
            <h2>–õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã</h2>
            <div id="logs-content"></div>
        </div>
    </div>
  
    <script src="/static/js/app.js"></script>
    <script src="/static/js/admin.js"></script>
    <script>
        window.addEventListener('DOMContentLoaded', initAdmin);
    </script>
</body>
</html>
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `frontend/admin.html` —Å–æ–∑–¥–∞–Ω
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–∞–±—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–¥–µ–ª–æ–≤
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–µ–∫—Ü–∏–∏ –¥–ª—è: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–æ–º–ø—Ç–æ–≤, LLM, –Ω–∞—Å—Ç—Ä–æ–µ–∫, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏, –ª–æ–≥–æ–≤
- [x] –§–∞–π–ª –ø–æ–¥–∫–ª—é—á–∞–µ—Ç `/static/css/admin.css`
- [x] –§–∞–π–ª –ø–æ–¥–∫–ª—é—á–∞–µ—Ç `/static/js/admin.js`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

## –§–ê–ó–ê 22: FRONTEND - –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò

### –®–∞–≥ 22.1: –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ç–∏–ª–µ–π [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `frontend/css/style.css` —Å –±–∞–∑–æ–≤—ã–º–∏ —Å—Ç–∏–ª—è–º–∏.

**–§–∞–π–ª:** `frontend/css/style.css`

```css
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    background-color: #f5f5f5;
    color: #333;
    line-height: 1.6;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.header {
    background-color: #2c3e50;
    color: white;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header h1 {
    font-size: 24px;
}

.user-info {
    display: flex;
    gap: 15px;
    align-items: center;
}

.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.3s;
}

.btn-primary {
    background-color: #3498db;
    color: white;
}

.btn-primary:hover {
    background-color: #2980b9;
}

.btn-secondary {
    background-color: #95a5a6;
    color: white;
}

.btn-secondary:hover {
    background-color: #7f8c8d;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

.form-group input[type="text"],
.form-group input[type="password"],
.form-group input[type="file"],
.form-group textarea {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
}

.error-message {
    background-color: #e74c3c;
    color: white;
    padding: 15px;
    border-radius: 4px;
    margin-top: 20px;
}

.success-message {
    background-color: #27ae60;
    color: white;
    padding: 15px;
    border-radius: 4px;
    margin-top: 20px;
}

.progress-bar {
    width: 100%;
    height: 30px;
    background-color: #ecf0f1;
    border-radius: 15px;
    overflow: hidden;
    margin: 20px 0;
}

.progress-fill {
    height: 100%;
    background-color: #3498db;
    width: 0%;
    transition: width 0.3s;
    animation: progress 2s infinite;
}

@keyframes progress {
    0% { width: 0%; }
    50% { width: 70%; }
    100% { width: 100%; }
}

.result-section {
    background-color: white;
    padding: 20px;
    border-radius: 8px;
    margin-top: 30px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.result-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.login-box {
    max-width: 400px;
    margin: 100px auto;
    background-color: white;
    padding: 40px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.upload-section {
    background-color: white;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.radio-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.radio-group label {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin: 20px 0;
}

table th,
table td {
    padding: 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

table th {
    background-color: #34495e;
    color: white;
}

table tr:hover {
    background-color: #f5f5f5;
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `frontend/css/style.css` —Å–æ–∑–¥–∞–Ω
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è body
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∏–ª–∏ –¥–ª—è header
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ (.btn, .btn-primary, .btn-secondary)
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º (.form-group)
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∏–ª–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –æ–± –æ—à–∏–±–∫–∞—Ö
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–Ω–∏–º–∞—Ü–∏—é –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü
- [x] –í—Å–µ —Å—Ç–∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π CSS

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 22.2: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç–∏–ª–µ–π –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `frontend/css/admin.css` —Å–æ —Å—Ç–∏–ª—è–º–∏ –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.

**–§–∞–π–ª:** `frontend/css/admin.css`

```css
/* –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —Å—Ç–∏–ª–∏ */

.admin-container {
    padding: 30px;
}

/* –¢–∞–±—ã –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
.tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 30px;
    border-bottom: 2px solid #ecf0f1;
    padding-bottom: 10px;
}

.tab-button {
    padding: 12px 24px;
    background-color: #ecf0f1;
    border: none;
    border-radius: 4px 4px 0 0;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: all 0.3s ease;
    color: #7f8c8d;
}

.tab-button:hover {
    background-color: #bdc3c7;
    color: #2c3e50;
}

.tab-button.active {
    background-color: #3498db;
    color: white;
}

/* –ö–æ–Ω—Ç–µ–Ω—Ç —Ç–∞–±–æ–≤ */
.tab-content {
    display: none;
    background-color: white;
    padding: 30px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.tab-content.active {
    display: block;
}

/* –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
.users-table {
    width: 100%;
    margin-top: 20px;
}

.users-table th {
    background-color: #2c3e50;
}

.users-table td {
    vertical-align: middle;
}

.users-table .role-admin {
    background-color: #e74c3c;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
}

.users-table .role-user {
    background-color: #3498db;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
}

/* –§–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
.edit-form {
    background-color: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    margin-top: 20px;
}

.edit-form h3 {
    margin-bottom: 20px;
    color: #2c3e50;
}

/* –†–µ–¥–∞–∫—Ç–æ—Ä –ø—Ä–æ–º–ø—Ç–æ–≤ */
.prompt-editor {
    margin-bottom: 30px;
}

.prompt-editor h4 {
    margin-bottom: 10px;
    color: #34495e;
}

.prompt-editor textarea {
    width: 100%;
    min-height: 300px;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 13px;
    line-height: 1.5;
    resize: vertical;
}

.prompt-editor textarea:focus {
    border-color: #3498db;
    outline: none;
    box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
}

.prompt-actions {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

/* –ù–∞—Å—Ç—Ä–æ–π–∫–∏ LLM */
.llm-settings {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}

.llm-option {
    padding: 20px;
    border: 2px solid #ecf0f1;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.llm-option:hover {
    border-color: #3498db;
}

.llm-option.selected {
    border-color: #3498db;
    background-color: #ebf5fb;
}

.llm-option h4 {
    margin-bottom: 10px;
    color: #2c3e50;
}

.llm-option p {
    color: #7f8c8d;
    font-size: 14px;
}

/* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ */
.stats-cards {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 25px;
    border-radius: 12px;
    text-align: center;
}

.stat-card.cost {
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
}

.stat-card.users {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
}

.stat-card h3 {
    font-size: 32px;
    margin-bottom: 5px;
}

.stat-card p {
    font-size: 14px;
    opacity: 0.9;
}

/* –õ–æ–≥–∏ */
.logs-container {
    background-color: #1e1e1e;
    color: #d4d4d4;
    padding: 20px;
    border-radius: 8px;
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 13px;
    max-height: 500px;
    overflow-y: auto;
}

.logs-container .log-line {
    padding: 5px 0;
    border-bottom: 1px solid #333;
}

.logs-container .log-line:last-child {
    border-bottom: none;
}

.logs-container .log-error {
    color: #f44747;
}

.logs-container .log-info {
    color: #4ec9b0;
}

.logs-filter {
    display: flex;
    gap: 15px;
    margin-bottom: 20px;
    align-items: center;
}

.logs-filter select {
    padding: 8px 12px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
.btn-danger {
    background-color: #e74c3c;
    color: white;
}

.btn-danger:hover {
    background-color: #c0392b;
}

.btn-success {
    background-color: #27ae60;
    color: white;
}

.btn-success:hover {
    background-color: #219a52;
}

.btn-small {
    padding: 6px 12px;
    font-size: 12px;
}

/* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal.active {
    display: flex;
}

.modal-content {
    background-color: white;
    padding: 30px;
    border-radius: 8px;
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.modal-header h3 {
    margin: 0;
}

.modal-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #7f8c8d;
}

.modal-close:hover {
    color: #2c3e50;
}

/* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 25px;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    z-index: 1001;
    animation: slideIn 0.3s ease;
}

.notification.success {
    background-color: #27ae60;
}

.notification.error {
    background-color: #e74c3c;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ */
@media (max-width: 768px) {
    .tabs {
        flex-wrap: wrap;
    }
  
    .tab-button {
        flex: 1 1 auto;
        text-align: center;
    }
  
    .stats-cards {
        grid-template-columns: 1fr;
    }
  
    .llm-settings {
        grid-template-columns: 1fr;
    }
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `frontend/css/admin.css` —Å–æ–∑–¥–∞–Ω
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–æ–≤ (.tabs, .tab-button, .tab-content)
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –ø—Ä–æ–º–ø—Ç–æ–≤
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∏–ª–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ LLM
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∏–ª–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–∫–∞—Ä—Ç–æ—á–∫–∏)
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∏–ª–∏ –¥–ª—è –ª–æ–≥–æ–≤
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ç–∏–ª–∏ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ (@media)

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

## –§–ê–ó–ê 23: FRONTEND - JAVASCRIPT –õ–û–ì–ò–ö–ê

### –®–∞–≥ 23.1: –°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ JavaScript —Ñ–∞–π–ª–∞ [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `frontend/js/app.js` —Å –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

**–§–∞–π–ª:** `frontend/js/app.js`

```javascript
// API Base URL
const API_BASE = '';

// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let currentUser = null;
let currentAnalysisResult = null;
let currentFilename = null;

// ===== –ü–†–û–í–ï–†–ö–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–ò =====

async function checkAuth() {
    try {
        const response = await fetch(`${API_BASE}/api/check-auth`);
        const data = await response.json();
    
        if (data.authorized) {
            currentUser = {
                username: data.username,
                role: data.role
            };
            return true;
        }
        return false;
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
        return false;
    }
}

async function checkAuthAndRedirect() {
    const isAuth = await checkAuth();
  
    if (window.location.pathname.includes('login.html')) {
        if (isAuth) {
            window.location.href = '/static/index.html';
        }
    } else {
        if (!isAuth) {
            window.location.href = '/static/login.html';
        }
    }
}

// ===== –õ–û–ì–ò–ù =====

async function handleLogin(event) {
    event.preventDefault();
  
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const errorDiv = document.getElementById('error-message');
  
    try {
        const response = await fetch(`${API_BASE}/api/login`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username, password })
        });
    
        const data = await response.json();
    
        if (data.success) {
            window.location.href = '/static/index.html';
        } else {
            errorDiv.textContent = data.message;
            errorDiv.style.display = 'block';
        }
    } catch (error) {
        errorDiv.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏';
        errorDiv.style.display = 'block';
    }
}

// ===== –í–´–•–û–î =====

function logout() {
    // –í –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –ª–æ–≥–∏–Ω
    // IP –±—É–¥–µ—Ç –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –ø–æ–¥ –¥—Ä—É–≥–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º
    window.location.href = '/static/login.html';
}

// ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´ =====

async function initApp() {
    const isAuth = await checkAuth();
  
    if (!isAuth) {
        window.location.href = '/static/login.html';
        return;
    }
  
    // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const usernameDisplay = document.getElementById('username-display');
    if (usernameDisplay) {
        usernameDisplay.textContent = `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${currentUser.username}`;
    }
  
    // –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ñ–æ—Ä–º—ã
    const uploadForm = document.getElementById('uploadForm');
    if (uploadForm) {
        uploadForm.addEventListener('submit', handleAnalyze);
    }
  
    // –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
    const fileInput = document.getElementById('file');
    if (fileInput) {
        fileInput.addEventListener('change', function() {
            const fileName = document.getElementById('file-name');
            if (this.files.length > 0) {
                fileName.textContent = this.files[0].name;
            }
        });
    }
}

// ===== –ê–ù–ê–õ–ò–ó –î–û–ì–û–í–û–†–ê =====

async function handleAnalyze(event) {
    event.preventDefault();
  
    const fileInput = document.getElementById('file');
    const analysisType = document.querySelector('input[name="analysis_type"]:checked').value;
    const errorDiv = document.getElementById('error-message');
    const progressSection = document.getElementById('progress-section');
    const resultSection = document.getElementById('result-section');
  
    // –°–∫—Ä—ã—Ç—å –æ—à–∏–±–∫–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    errorDiv.style.display = 'none';
    resultSection.style.display = 'none';
  
    // –ü–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
    progressSection.style.display = 'block';
  
    const formData = new FormData();
    formData.append('file', fileInput.files[0]);
    formData.append('analysis_type', analysisType);
  
    try {
        const response = await fetch(`${API_BASE}/api/analyze`, {
            method: 'POST',
            body: formData
        });
    
        const data = await response.json();
    
        // –°–∫—Ä—ã—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
        progressSection.style.display = 'none';
    
        if (data.success) {
            currentAnalysisResult = data.result;
            currentFilename = data.filename;
        
            // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const resultContent = document.getElementById('result-content');
            resultContent.innerHTML = marked.parse(data.result);
            resultSection.style.display = 'block';
        
            // –ü—Ä–æ–∫—Ä—É—Ç–∏—Ç—å –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º
            resultSection.scrollIntoView({ behavior: 'smooth' });
        } else {
            errorDiv.textContent = data.error;
            errorDiv.style.display = 'block';
        }
    } catch (error) {
        progressSection.style.display = 'none';
        errorDiv.textContent = '–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞';
        errorDiv.style.display = 'block';
    }
}

// ===== –≠–ö–°–ü–û–†–¢ –í WORD =====

async function exportToWord() {
    if (!currentAnalysisResult) {
        alert('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞');
        return;
    }
  
    const filename = currentFilename ? currentFilename.replace(/\.[^/.]+$/, "") + '_–∞–Ω–∞–ª–∏–∑' : '–ê–Ω–∞–ª–∏–∑_–¥–æ–≥–æ–≤–æ—Ä–∞';
  
    try {
        const response = await fetch(`${API_BASE}/api/export`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                content: currentAnalysisResult,
                filename: filename
            })
        });
    
        if (response.ok) {
            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}.docx`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        } else {
            alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞');
        }
    } catch (error) {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞');
    }
}

// ===== –ö–û–ü–ò–†–û–í–ê–ù–ò–ï –í –ë–£–§–ï–† –û–ë–ú–ï–ù–ê =====

function copyToClipboard() {
    if (!currentAnalysisResult) {
        alert('–ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è');
        return;
    }
  
    navigator.clipboard.writeText(currentAnalysisResult).then(() => {
        alert('–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞');
    }).catch(() => {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏');
    });
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `frontend/js/app.js` —Å–æ–∑–¥–∞–Ω
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `checkAuth()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `handleLogin()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `logout()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `initApp()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `handleAnalyze()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `exportToWord()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `copyToClipboard()`
- [x] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 23.2: –°–æ–∑–¥–∞–Ω–∏–µ JavaScript –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ [x]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `frontend/js/admin.js` —Å –ª–æ–≥–∏–∫–æ–π –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.

**–§–∞–π–ª:** `frontend/js/admin.js`

```javascript
// ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ê–î–ú–ò–ù-–ü–ê–ù–ï–õ–ò =====

async function initAdmin() {
    const isAuth = await checkAuth();
  
    if (!isAuth) {
        window.location.href = '/static/login.html';
        return;
    }
  
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    if (currentUser.role !== 'admin') {
        alert('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω. –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.');
        window.location.href = '/static/index.html';
        return;
    }
  
    // –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const usernameDisplay = document.getElementById('username-display');
    if (usernameDisplay) {
        usernameDisplay.textContent = `–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä: ${currentUser.username}`;
    }
  
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ç–∞–±–∞ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
    loadUsers();
}

// ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–ê–ë–ê–ú–ò =====

function showTab(tabName) {
    // –°–∫—Ä—ã—Ç—å –≤—Å–µ —Ç–∞–±—ã
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });
  
    // –£–±—Ä–∞—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å –∫–Ω–æ–ø–æ–∫
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
    });
  
    // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–∞–±
    const selectedTab = document.getElementById(`${tabName}-tab`);
    if (selectedTab) {
        selectedTab.classList.add('active');
    }
  
    // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É
    event.target.classList.add('active');
  
    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Ç–∞–±–∞
    switch(tabName) {
        case 'users':
            loadUsers();
            break;
        case 'prompts':
            loadPrompts();
            break;
        case 'llm':
            loadLLMConfig();
            break;
        case 'settings':
            loadSettings();
            break;
        case 'stats':
            loadTokenStats();
            break;
        case 'logs':
            loadLogs();
            break;
    }
}

// ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú–ò =====

async function loadUsers() {
    try {
        const response = await fetch(`${API_BASE}/api/admin/users`);
        const data = await response.json();
    
        if (data.success) {
            renderUsersTable(data.users);
        } else {
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π', 'error');
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
    }
}

function renderUsersTable(users) {
    const container = document.getElementById('users-list');
  
    let html = `
        <table class="users-table">
            <thead>
                <tr>
                    <th>–õ–æ–≥–∏–Ω</th>
                    <th>–†–æ–ª—å</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
    `;
  
    users.forEach(user => {
        const roleClass = user.role === 'admin' ? 'role-admin' : 'role-user';
        const roleText = user.role === 'admin' ? '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä' : '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å';
    
        html += `
            <tr>
                <td>${user.username}</td>
                <td><span class="${roleClass}">${roleText}</span></td>
                <td>
                    <button onclick="editUser('${user.username}')" class="btn btn-secondary btn-small">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                </td>
            </tr>
        `;
    });
  
    html += '</tbody></table>';
    container.innerHTML = html;
}

function showCreateUserForm() {
    const html = `
        <div class="edit-form">
            <h3>–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <form id="createUserForm">
                <div class="form-group">
                    <label for="new-username">–õ–æ–≥–∏–Ω:</label>
                    <input type="text" id="new-username" required>
                </div>
                <div class="form-group">
                    <label for="new-password">–ü–∞—Ä–æ–ª—å:</label>
                    <input type="password" id="new-password" required>
                </div>
                <div class="form-group">
                    <label for="new-role">–†–æ–ª—å:</label>
                    <select id="new-role">
                        <option value="user">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</option>
                        <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
                    </select>
                </div>
                <button type="submit" class="btn btn-success">–°–æ–∑–¥–∞—Ç—å</button>
                <button type="button" onclick="loadUsers()" class="btn btn-secondary">–û—Ç–º–µ–Ω–∞</button>
            </form>
        </div>
    `;
  
    document.getElementById('users-list').innerHTML += html;
  
    document.getElementById('createUserForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        await createUser();
    });
}

async function createUser() {
    const username = document.getElementById('new-username').value;
    const password = document.getElementById('new-password').value;
    const role = document.getElementById('new-role').value;
  
    try {
        const response = await fetch(`${API_BASE}/api/admin/users`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username, password, role })
        });
    
        const data = await response.json();
    
        if (data.success) {
            showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω', 'success');
            loadUsers();
        } else {
            showNotification(data.error || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è', 'error');
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
    }
}

async function editUser(username) {
    const newPassword = prompt(`–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è ${username} (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å):`);
    const newRole = prompt(`–ù–æ–≤–∞—è —Ä–æ–ª—å –¥–ª—è ${username} (admin –∏–ª–∏ user, –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, —á—Ç–æ–±—ã –Ω–µ –º–µ–Ω—è—Ç—å):`);
  
    if (newPassword === null && newRole === null) return;
  
    const updates = {};
    if (newPassword) updates.password = newPassword;
    if (newRole && (newRole === 'admin' || newRole === 'user')) updates.role = newRole;
  
    if (Object.keys(updates).length === 0) {
        showNotification('–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π', 'error');
        return;
    }
  
    try {
        const response = await fetch(`${API_BASE}/api/admin/users/${username}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(updates)
        });
    
        const data = await response.json();
    
        if (data.success) {
            showNotification('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
            loadUsers();
        } else {
            showNotification(data.error || '–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', 'error');
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
    }
}

// ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ü–†–û–ú–ü–¢–ê–ú–ò =====

async function loadPrompts() {
    try {
        const response = await fetch(`${API_BASE}/api/admin/prompts`);
        const data = await response.json();
    
        if (data.success) {
            renderPromptsEditor(data.prompts);
        } else {
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤', 'error');
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
    }
}

function renderPromptsEditor(prompts) {
    const container = document.getElementById('prompts-content');
  
    container.innerHTML = `
        <div class="prompt-editor">
            <h4>–ü—Ä–æ–º–ø—Ç –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –≤—ã–∂–∏–º–∫–∏ –¥–æ–≥–æ–≤–æ—Ä–∞</h4>
            <textarea id="prompt-summary">${prompts.summary || ''}</textarea>
            <div class="prompt-actions">
                <button onclick="savePrompt('summary')" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button onclick="resetPrompt('summary')" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É</button>
            </div>
        </div>
    
        <div class="prompt-editor">
            <h4>–ü—Ä–æ–º–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞</h4>
            <textarea id="prompt-legal_check">${prompts.legal_check || ''}</textarea>
            <div class="prompt-actions">
                <button onclick="savePrompt('legal_check')" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button onclick="resetPrompt('legal_check')" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É</button>
            </div>
        </div>
    `;
}

async function savePrompt(promptType) {
    const content = document.getElementById(`prompt-${promptType}`).value;
  
    try {
        const response = await fetch(`${API_BASE}/api/admin/prompts`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt_type: promptType, content })
        });
    
        const data = await response.json();
    
        if (data.success) {
            showNotification('–ü—Ä–æ–º–ø—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω', 'success');
        } else {
            showNotification(data.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
    }
}

async function resetPrompt(promptType) {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–º–ø—Ç –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∑–Ω–∞—á–µ–Ω–∏—é?')) return;
  
    try {
        const response = await fetch(`${API_BASE}/api/admin/prompts/reset`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt_type: promptType })
        });
    
        const data = await response.json();
    
        if (data.success) {
            document.getElementById(`prompt-${promptType}`).value = data.content;
            showNotification('–ü—Ä–æ–º–ø—Ç —Å–±—Ä–æ—à–µ–Ω', 'success');
        } else {
            showNotification(data.error || '–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞', 'error');
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
    }
}

// ===== –ù–ê–°–¢–†–û–ô–ö–ò LLM =====

async function loadLLMConfig() {
    try {
        const response = await fetch(`${API_BASE}/api/admin/llm-config`);
        const data = await response.json();
    
        if (data.success) {
            renderLLMConfig(data.config);
        } else {
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ LLM', 'error');
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
    }
}

function renderLLMConfig(config) {
    const container = document.getElementById('llm-config');
  
    container.innerHTML = `
        <div class="llm-settings">
            <div class="llm-option ${config.llm_type === 'deepseek' ? 'selected' : ''}" onclick="selectLLM('deepseek')">
                <h4>‚òÅÔ∏è DeepSeek API (–æ–±–ª–∞—á–Ω–∞—è)</h4>
                <p>–ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞, —Ç—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç</p>
            </div>
            <div class="llm-option ${config.llm_type === 'lmstudio' ? 'selected' : ''}" onclick="selectLLM('lmstudio')">
                <h4>üñ•Ô∏è LM Studio (–ª–æ–∫–∞–ª—å–Ω–∞—è)</h4>
                <p>–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å, –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞</p>
            </div>
        </div>
    
        <form id="llmConfigForm" class="edit-form" style="margin-top: 20px;">
            <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h3>
        
            <div class="form-group">
                <label>–¢–µ–∫—É—â–∏–π —Ç–∏–ø LLM:</label>
                <select id="llm-type">
                    <option value="deepseek" ${config.llm_type === 'deepseek' ? 'selected' : ''}>DeepSeek API</option>
                    <option value="lmstudio" ${config.llm_type === 'lmstudio' ? 'selected' : ''}>LM Studio</option>
                </select>
            </div>
        
            <div class="form-group">
                <label>DeepSeek API Key:</label>
                <input type="password" id="deepseek-api-key" value="${config.deepseek_api_key || ''}" placeholder="sk-...">
            </div>
        
            <div class="form-group">
                <label>LM Studio URL:</label>
                <input type="text" id="lmstudio-url" value="${config.lmstudio_base_url || 'http://localhost:1234/v1'}">
            </div>
        
            <div class="form-group">
                <label>LM Studio Model:</label>
                <input type="text" id="lmstudio-model" value="${config.lmstudio_model || 'deepseek-coder'}">
            </div>
        
            <button type="submit" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </form>
    `;
  
    document.getElementById('llmConfigForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        await saveLLMConfig();
    });
}

function selectLLM(type) {
    document.querySelectorAll('.llm-option').forEach(el => el.classList.remove('selected'));
    event.currentTarget.classList.add('selected');
    document.getElementById('llm-type').value = type;
}

async function saveLLMConfig() {
    const config = {
        llm_type: document.getElementById('llm-type').value,
        deepseek_api_key: document.getElementById('deepseek-api-key').value,
        lmstudio_base_url: document.getElementById('lmstudio-url').value,
        lmstudio_model: document.getElementById('lmstudio-model').value
    };
  
    try {
        const response = await fetch(`${API_BASE}/api/admin/llm-config`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(config)
        });
    
        const data = await response.json();
    
        if (data.success) {
            showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ LLM —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
        } else {
            showNotification(data.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
    }
}

// ===== –ù–ê–°–¢–†–û–ô–ö–ò –°–ò–°–¢–ï–ú–´ =====

async function loadSettings() {
    try {
        const response = await fetch(`${API_BASE}/api/admin/settings`);
        const data = await response.json();
    
        if (data.success) {
            renderSettings(data.settings);
        } else {
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫', 'error');
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
    }
}

function renderSettings(settings) {
    const container = document.getElementById('settings-content');
  
    container.innerHTML = `
        <form id="settingsForm" class="edit-form">
            <div class="form-group">
                <label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–ú–ë):</label>
                <input type="number" id="max-file-size" value="${settings.max_file_size_mb || 50}" min="1" max="500">
            </div>
        
            <div class="form-group">
                <label>–ú–∞–∫—Å. –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç–æ–∫:</label>
                <input type="number" id="max-concurrent" value="${settings.max_concurrent_requests || 5}" min="1" max="20">
            </div>
        
            <div class="form-group">
                <label>–ú–∞–∫—Å. –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –æ—á–µ—Ä–µ–¥–∏:</label>
                <input type="number" id="max-queue" value="${settings.max_queue_size || 5}" min="1" max="20">
            </div>
        
            <div class="form-group">
                <label>Rate limit (–∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É):</label>
                <input type="number" id="rate-limit" value="${settings.rate_limit_per_minute || 10}" min="1" max="100">
            </div>
        
            <button type="submit" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </form>
    `;
  
    document.getElementById('settingsForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        await saveSettings();
    });
}

async function saveSettings() {
    const settings = {
        max_file_size_mb: parseInt(document.getElementById('max-file-size').value),
        max_concurrent_requests: parseInt(document.getElementById('max-concurrent').value),
        max_queue_size: parseInt(document.getElementById('max-queue').value),
        rate_limit_per_minute: parseInt(document.getElementById('rate-limit').value)
    };
  
    try {
        const response = await fetch(`${API_BASE}/api/admin/settings`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(settings)
        });
    
        const data = await response.json();
    
        if (data.success) {
            showNotification('–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
        } else {
            showNotification(data.error || '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
    }
}

// ===== –°–¢–ê–¢–ò–°–¢–ò–ö–ê –¢–û–ö–ï–ù–û–í =====

async function loadTokenStats() {
    try {
        const response = await fetch(`${API_BASE}/api/admin/tokens-stats`);
        const data = await response.json();
    
        if (data.success) {
            renderTokenStats(data.stats);
        } else {
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏', 'error');
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
    }
}

function renderTokenStats(stats) {
    const container = document.getElementById('stats-content');
  
    const totalTokens = (stats.total_prompt_tokens || 0) + (stats.total_completion_tokens || 0);
  
    let usersHtml = '';
    if (stats.users && stats.users.length > 0) {
        usersHtml = `
            <h3 style="margin-top: 30px;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º</h3>
            <table class="users-table">
                <thead>
                    <tr>
                        <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</th>
                        <th>–ó–∞–ø—Ä–æ—Å–æ–≤</th>
                        <th>–¢–æ–∫–µ–Ω–æ–≤ (prompt)</th>
                        <th>–¢–æ–∫–µ–Ω–æ–≤ (completion)</th>
                        <th>–°—Ç–æ–∏–º–æ—Å—Ç—å ($)</th>
                    </tr>
                </thead>
                <tbody>
                    ${stats.users.map(u => `
                        <tr>
                            <td>${u.username}</td>
                            <td>${u.requests_count}</td>
                            <td>${u.prompt_tokens.toLocaleString()}</td>
                            <td>${u.completion_tokens.toLocaleString()}</td>
                            <td>$${u.cost_usd.toFixed(2)}</td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
        `;
    }
  
    container.innerHTML = `
        <div class="stats-cards">
            <div class="stat-card">
                <h3>${totalTokens.toLocaleString()}</h3>
                <p>–í—Å–µ–≥–æ —Ç–æ–∫–µ–Ω–æ–≤</p>
            </div>
            <div class="stat-card cost">
                <h3>$${(stats.total_cost_usd || 0).toFixed(2)}</h3>
                <p>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å</p>
            </div>
            <div class="stat-card users">
                <h3>${stats.users ? stats.users.length : 0}</h3>
                <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
            </div>
        </div>
        ${usersHtml}
        <p style="margin-top: 20px; color: #7f8c8d; font-size: 14px;">
            –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${stats.last_updated || '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}
        </p>
    `;
}

// ===== –õ–û–ì–ò =====

async function loadLogs(logType = 'app', limit = 100) {
    try {
        const response = await fetch(`${API_BASE}/api/admin/logs?type=${logType}&limit=${limit}`);
        const data = await response.json();
    
        if (data.success) {
            renderLogs(data.logs, logType);
        } else {
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–≥–æ–≤', 'error');
        }
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏', 'error');
    }
}

function renderLogs(logs, currentType) {
    const container = document.getElementById('logs-content');
  
    const logsHtml = logs.map(line => {
        const isError = line.includes('ERROR');
        return `<div class="log-line ${isError ? 'log-error' : 'log-info'}">${line}</div>`;
    }).join('');
  
    container.innerHTML = `
        <div class="logs-filter">
            <label>–¢–∏–ø –ª–æ–≥–æ–≤:</label>
            <select onchange="loadLogs(this.value)">
                <option value="app" ${currentType === 'app' ? 'selected' : ''}>–î–µ–π—Å—Ç–≤–∏—è</option>
                <option value="error" ${currentType === 'error' ? 'selected' : ''}>–û—à–∏–±–∫–∏</option>
            </select>
            <button onclick="loadLogs('${currentType}')" class="btn btn-secondary btn-small">–û–±–Ω–æ–≤–∏—Ç—å</button>
        </div>
        <div class="logs-container">
            ${logsHtml || '<div class="log-line">–ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>'}
        </div>
    `;
}

// ===== –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø =====

function showNotification(message, type = 'success') {
    // –£–¥–∞–ª–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    document.querySelectorAll('.notification').forEach(el => el.remove());
  
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
  
    document.body.appendChild(notification);
  
    // –£–¥–∞–ª–∏—Ç—å —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
    setTimeout(() => {
        notification.remove();
    }, 3000);
}
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `frontend/js/admin.js` —Å–æ–∑–¥–∞–Ω
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `initAdmin()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `showTab()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: `loadUsers()`, `renderUsersTable()`, `showCreateUserForm()`, `createUser()`, `editUser()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤: `loadPrompts()`, `renderPromptsEditor()`, `savePrompt()`, `resetPrompt()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è LLM: `loadLLMConfig()`, `renderLLMConfig()`, `selectLLM()`, `saveLLMConfig()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫: `loadSettings()`, `renderSettings()`, `saveSettings()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: `loadTokenStats()`, `renderTokenStats()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤: `loadLogs()`, `renderLogs()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `showNotification()`
- [x] –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –æ—à–∏–±–∫–∏

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

## –§–ê–ó–ê 24: –°–ö–†–ò–ü–¢–´ –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Ø

### –®–∞–≥ 24.1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `start_server.bat` –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞.

**–§–∞–π–ª:** `start_server.bat`

```batch
@echo off
echo ========================================
echo –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ "–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–æ–≤"
echo ========================================

cd /d "%~dp0"

if not exist "venv\" (
    echo –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ!
    echo –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ: python -m venv venv
    echo –ó–∞—Ç–µ–º —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: venv\Scripts\activate ^&^& pip install -r requirements.txt
    pause
    exit /b 1
)

call venv\Scripts\activate

echo –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ http://0.0.0.0:8000
python -m uvicorn backend.main:app --host 0.0.0.0 --port 8000 --reload

pause
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `start_server.bat` —Å–æ–∑–¥–∞–Ω –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- [x] –§–∞–π–ª –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [x] –§–∞–π–ª –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- [x] –§–∞–π–ª –∑–∞–ø—É—Å–∫–∞–µ—Ç uvicorn —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 24.2: –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `scripts/init_data.py` –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–§–∞–π–ª:** `scripts/init_data.py`

```python
"""
–°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
–°–æ–∑–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.
"""

import sys
from pathlib import Path

# –î–æ–±–∞–≤–∏—Ç—å –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å
ROOT_DIR = Path(__file__).resolve().parent.parent
sys.path.insert(0, str(ROOT_DIR))

from backend.config import DATA_DIR, PROMPTS_DIR, DEFAULTS_DIR, LOGS_DIR
from backend.services.json_utils import write_json

def init_directories():
    """–°–æ–∑–¥–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏."""
    print("–°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π...")
    DATA_DIR.mkdir(exist_ok=True)
    PROMPTS_DIR.mkdir(exist_ok=True)
    DEFAULTS_DIR.mkdir(exist_ok=True)
    LOGS_DIR.mkdir(exist_ok=True)
    print("‚úì –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞–Ω—ã")

def init_users():
    """–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –Ω–∞—á–∞–ª—å–Ω—ã–º –∞–¥–º–∏–Ω–æ–º."""
    users_file = DATA_DIR / "users.json"
    if users_file.exists():
        print("! –§–∞–π–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
        return
  
    print("–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π...")
    data = {
        "users": [
            {
                "username": "admin",
                "password": "admin",
                "role": "admin"
            }
        ]
    }
    write_json(users_file, data)
    print("‚úì –°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: admin / admin")

def init_auth_ips():
    """–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö IP."""
    auth_file = DATA_DIR / "auth_ips.json"
    if auth_file.exists():
        print("! –§–∞–π–ª –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö IP —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
        return
  
    print("–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö IP...")
    write_json(auth_file, {"authorized_ips": {}})
    print("‚úì –§–∞–π–ª —Å–æ–∑–¥–∞–Ω")

def init_llm_config():
    """–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ LLM."""
    config_file = DATA_DIR / "llm_config.json"
    if config_file.exists():
        print("! –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ LLM —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
        return
  
    print("–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ LLM...")
    data = {
        "llm_type": "deepseek",
        "deepseek_api_key": "",
        "deepseek_base_url": "https://api.deepseek.com",
        "lmstudio_base_url": "http://localhost:1234/v1",
        "lmstudio_model": "deepseek-coder"
    }
    write_json(config_file, data)
    print("‚úì –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞")

def init_settings():
    """–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏—Å—Ç–µ–º—ã."""
    settings_file = DATA_DIR / "settings.json"
    if settings_file.exists():
        print("! –§–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
        return
  
    print("–°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Å–∏—Å—Ç–µ–º—ã...")
    data = {
        "max_file_size_mb": 50,
        "max_queue_size": 5,
        "max_concurrent_requests": 5,
        "rate_limit_per_minute": 10
    }
    write_json(settings_file, data)
    print("‚úì –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–∑–¥–∞–Ω—ã")

def init_tokens_stats():
    """–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤."""
    tokens_file = DATA_DIR / "tokens_usage.json"
    if tokens_file.exists():
        print("! –§–∞–π–ª —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º")
        return
  
    print("–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤...")
    data = {
        "total_prompt_tokens": 0,
        "total_completion_tokens": 0,
        "total_cost_usd": 0.0,
        "users": {},
        "last_updated": ""
    }
    write_json(tokens_file, data)
    print("‚úì –§–∞–π–ª —Å–æ–∑–¥–∞–Ω")

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏."""
    print("=" * 50)
    print("–ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –î–ê–ù–ù–´–•")
    print("=" * 50)
  
    init_directories()
    init_users()
    init_auth_ips()
    init_llm_config()
    init_settings()
    init_tokens_stats()
  
    print("\n" + "=" * 50)
    print("–ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê")
    print("=" * 50)
    print("\n–í–∞–∂–Ω–æ:")
    print("1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ API –∫–ª—é—á DeepSeek –≤ .env —Ñ–∞–π–ª–µ")
    print("2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª—ã –ø—Ä–æ–º–ø—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω—ã –≤ data/prompts/")
    print("3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: start_server.bat")
    print("\n–ù–∞—á–∞–ª—å–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:")
    print("  –õ–æ–≥–∏–Ω: admin")
    print("  –ü–∞—Ä–æ–ª—å: admin")

if __name__ == "__main__":
    main()
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [x] –§–∞–π–ª `scripts/init_data.py` —Å–æ–∑–¥–∞–Ω
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `init_directories()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `init_users()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `init_auth_ips()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `init_llm_config()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `init_settings()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `init_tokens_stats()`
- [x] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ñ—É–Ω–∫—Ü–∏—é `main()`
- [x] –§–∞–π–ª –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
- [x] –§–∞–π–ª –≤—ã–≤–æ–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

## –§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê

### –®–∞–≥ 25.1: –°–æ–∑–¥–∞–Ω–∏–µ README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `README.md` —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

**–§–∞–π–ª:** `README.md`

```markdown
# –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–æ–≤

–õ–æ–∫–∞–ª—å–Ω–æ–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–æ–≤ —Å –ø–æ–º–æ—â—å—é AI (DeepSeek API –∏–ª–∏ LM Studio).

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+
- Microsoft Word (–¥–ª—è —Ä–∞–±–æ—Ç—ã —Å .doc —Ñ–∞–π–ª–∞–º–∏)
- Windows OS

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –°–æ–∑–¥–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
python -m venv venv

# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ (Windows)
venv\Scripts\activate

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
copy .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å .env –∏ —É–∫–∞–∑–∞—Ç—å API –∫–ª—é—á DeepSeek
notepad .env
```

### 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```bash
python scripts\init_data.py
```

## –ó–∞–ø—É—Å–∫

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

```bash
start_server.bat
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:8000

### –ù–∞—á–∞–ª—å–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

- **–õ–æ–≥–∏–Ω:** admin
- **–ü–∞—Ä–æ–ª—å:** admin

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –°–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª—å –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞!

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://[IP-—Å–µ—Ä–≤–µ—Ä–∞]:8000
2. –í–æ–π–¥–∏—Ç–µ –ø–æ–¥ —Å–≤–æ–∏–º–∏ —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –¥–æ–≥–æ–≤–æ—Ä–∞ (.doc, .docx, .pdf)
4. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∞–Ω–∞–ª–∏–∑–∞:
   - –î–µ—Ç–∞–ª—å–Ω–∞—è –≤—ã–∂–∏–º–∫–∞ –¥–æ–≥–æ–≤–æ—Ä–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤—É –†–§
5. –ù–∞–∂–º–∏—Ç–µ "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å"
6. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ Word –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: http://[IP-—Å–µ—Ä–≤–µ—Ä–∞]:8000/static/admin.html

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**

- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è AI
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É DeepSeek API –∏ LM Studio
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤ (—Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤, –æ—á–µ—Ä–µ–¥—å, rate limiting)
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
- –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Å–∏—Å—Ç–µ–º—ã

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
DogovorLocal/
‚îú‚îÄ‚îÄ backend/           # Backend (FastAPI)
‚îú‚îÄ‚îÄ frontend/          # Frontend (HTML/CSS/JS)
‚îú‚îÄ‚îÄ data/              # –î–∞–Ω–Ω—ã–µ (JSON —Ñ–∞–π–ª—ã)
‚îú‚îÄ‚îÄ logs/              # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ scripts/           # –°–∫—Ä–∏–ø—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–∫–∏
‚îú‚îÄ‚îÄ requirements.txt   # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îî‚îÄ‚îÄ start_server.bat   # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
```

## Troubleshooting

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ .doc —Ñ–∞–π–ª–æ–≤

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Microsoft Word —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ DeepSeek API

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API –∫–ª—é—á –≤ .env —Ñ–∞–π–ª–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ LM Studio (–ª–æ–∫–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞)

### –û—à–∏–±–∫–∞ "–§–∞–π–ª –∑–∞—â–∏—â–µ–Ω –ø–∞—Ä–æ–ª–µ–º"

–°–Ω–∏–º–∏—Ç–µ –∑–∞—â–∏—Ç—É —Å —Ñ–∞–π–ª–∞ –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π.

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –§–∞–π–ª `README.md` —Å–æ–∑–¥–∞–Ω –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
- [ ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞–∑–¥–µ–ª "–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è"
- [ ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞–∑–¥–µ–ª "–£—Å—Ç–∞–Ω–æ–≤–∫–∞"
- [ ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞–∑–¥–µ–ª "–ó–∞–ø—É—Å–∫"
- [ ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—á–∞–ª—å–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- [ ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- [ ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–∞–∑–¥–µ–ª "Troubleshooting"

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

## –ü–û–ó–î–†–ê–í–õ–Ø–Æ! –ü–õ–ê–ù –ó–ê–í–ï–†–®–ï–ù!

–í—ã —Å–æ–∑–¥–∞–ª–∏ **–ø–æ–ª–Ω—ã–π –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω** –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ "–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –¥–æ–≥–æ–≤–æ—Ä–æ–≤".

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–ª–∞–Ω–∞ (–û–ë–ù–û–í–õ–ï–ù–û):**
- **–í—Å–µ–≥–æ —Ñ–∞–∑:** 24
- **–í—Å–µ–≥–æ —à–∞–≥–æ–≤:** ~65 —à–∞–≥–æ–≤
- **–ü–æ–∫—Ä—ã—Ç–∏–µ:** 100% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏–∑ –¢–ó

**–î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –≤–µ—Ä—Å–∏–∏ 1.1:**
‚úÖ –®–∞–≥ 1.3.1: –°–æ–∑–¥–∞–Ω–∏–µ —Ä–∞–±–æ—á–µ–≥–æ `.env` —Ñ–∞–π–ª–∞
‚úÖ –®–∞–≥ 8.2: Rate Limiting middleware (slowapi)
‚úÖ –®–∞–≥ 8.3: Queue Manager (—Å–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–∏)
‚úÖ –®–∞–≥ 13.4: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ .doc (pywin32)
‚úÖ –®–∞–≥ 22.2: –°—Ç–∏–ª–∏ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (admin.css)
‚úÖ –®–∞–≥ 23.2: JavaScript –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (admin.js)
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —à–∞–≥ 2.2: –†–æ—É—Ç–∏–Ω–≥ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —à–∞–≥ 16.1: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Rate Limiting –∏ Queue
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —à–∞–≥–∏ 4.1-4.2: –§–æ—Ä–º–∞—Ç –ø—Ä–æ–º–ø—Ç–æ–≤ (–±–µ–∑ markdown)

**–ö–∞–∂–¥—ã–π —à–∞–≥ –≤–∫–ª—é—á–∞–µ—Ç:**
‚úÖ –ß–µ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
‚úÖ –ü–æ–ª–Ω—ã–π –∫–æ–¥ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
‚úÖ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
‚úÖ –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

---

## –ö–ê–ö –ù–ê–ß–ê–¢–¨ –†–ê–ë–û–¢–£

**–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞:**
```

–ü—Ä–∏—Å—Ç—É–ø–∞–π –∫ —à–∞–≥—É 1.1

```

**–ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã:**
1. –°–∫–∞–∂–∏—Ç–µ "–ü—Ä–∏—Å—Ç—É–ø–∞–π –∫ —à–∞–≥—É X.X"
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —à–∞–≥ (—Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª, –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–¥)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
4. –û—Ç–º–µ—Ç—å—Ç–µ —à–∞–≥ –∫–∞–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π: `[X]`
5. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç–µ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É

**–í–ê–ñ–ù–û:**
- –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –¢–û–õ–¨–ö–û –û–î–ò–ù —à–∞–≥ –∑–∞ —Ä–∞–∑
- –ù–ï –ø—Ä–æ–ø—É—Å–∫–∞–π—Ç–µ —à–∞–≥–∏
- –ö–∞–∂–¥—ã–π —à–∞–≥ –Ω–µ–∑–∞–≤–∏—Å–∏–º –∏ —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–µ–Ω
- –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ –≤ —à–∞–≥–µ - –ø–µ—Ä–µ—Å–ø—Ä–æ—Å–∏—Ç–µ
- –≠—Ç–æ—Ç –ø–ª–∞–Ω —Å–æ–∑–¥–∞–Ω –¥–ª—è "—Ç—É–ø–æ–π LLM" - –∑–Ω–∞—á–∏—Ç –æ–Ω –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω—ã–π!

---

### üîó **–ò–ù–¢–ï–ì–†–ê–¶–ò–û–ù–ù–´–ï –ü–†–û–í–ï–†–ö–ò –ü–û–°–õ–ï –§–ê–ó–´ 24**
**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –≥–æ—Ç–æ–≤—ã –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é.

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
- [ ] –°–∫—Ä–∏–ø—Ç—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å–æ–∑–¥–∞–Ω—ã –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã
- [ ] –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–ª–Ω–∞—è –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–ú–∏–Ω–∏-—Ç–µ—Å—Ç—ã:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤
ls -la scripts/ start_server.bat

# –¢–µ—Å—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
if exist "venv\Scripts\activate" (
    call venv\Scripts\activate
    python -c "import fastapi, uvicorn, openai; print('Dependencies OK')"
)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞
python -c "
import os
required = ['backend', 'frontend', 'data', 'logs', 'scripts']
existing = [d for d in required if os.path.exists(d)]
print(f'Directories OK: {len(existing)}/{len(required)}')
"
```

**Fallback-—Å—Ü–µ–Ω–∞—Ä–∏–π:**

- –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç ‚Üí –∑–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—ã
- –ï—Å–ª–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

---

## –§–ê–ó–ê 25: –§–ò–ù–ê–õ–¨–ù–û–ï –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –°–ï–†–í–ò–°–ê

### –®–∞–≥ 25.1: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

```powershell
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
.\start_server.bat

# –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl http://localhost:8000/health
curl http://localhost:8000/api/status
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [ ] –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] Endpoint `/health` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{"status": "healthy"}`
- [ ] Endpoint `/api/status` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Ä–≤–∏—Å–µ
- [ ] –õ–æ–≥–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 25.2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ —Å —Ä–∞–∑–Ω—ã—Ö IP-–∞–¥—Ä–µ—Å–æ–≤.

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

```powershell
# –¢–µ—Å—Ç 1: –ü–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
curl http://localhost:8000/api/check-auth

# –¢–µ—Å—Ç 2: –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (—Å IP —Ç–µ–∫—É—â–µ–π –º–∞—à–∏–Ω—ã)
curl -X POST http://localhost:8000/api/login -H "Content-Type: application/json" -d '{"username": "admin", "password": "admin"}'

# –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞
curl http://localhost:8000/api/check-auth

# –¢–µ—Å—Ç 4: –î–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω–æ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É
curl http://localhost:8000/app
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [ ] –ë–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `{"authorized": false}`
- [ ] –ü–æ—Å–ª–µ –ª–æ–≥–∏–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `{"authorized": true}`
- [ ] –î–æ—Å—Ç—É–ø –∫ `/app` —Ä–∞–∑—Ä–µ—à–µ–Ω —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º
- [ ] IP —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `data/auth_ips.json`

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 25.3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

```powershell
# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∫–∞–∫ admin
curl -X POST http://localhost:8000/api/login -H "Content-Type: application/json" -d '{"username": "admin", "password": "admin"}'

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
curl http://localhost:8000/api/admin/users

# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
curl -X POST http://localhost:8000/api/admin/users -H "Content-Type: application/json" -d '{"username": "testuser", "password": "testpass", "role": "user"}'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ LLM
curl http://localhost:8000/api/admin/llm-config

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤
curl http://localhost:8000/api/admin/tokens-stats
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [ ] –í—Å–µ –∞–¥–º–∏–Ω-endpoints –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è admin
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∏ LLM –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 25.4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–≥–æ–≤–æ—Ä–∞ (—Å —Ç–µ—Å—Ç–æ–≤—ã–º —Ñ–∞–π–ª–æ–º).

**–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ–∞–π–ª–∞:**
–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `test_contract.txt` –∏ –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –≤ `.docx` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

```powershell
# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
curl -X POST http://localhost:8000/api/login -H "Content-Type: application/json" -d '{"username": "admin", "password": "admin"}'

# –¢–µ—Å—Ç –∞–Ω–∞–ª–∏–∑–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª)
# curl -X POST http://localhost:8000/api/analyze -F "file=@test_contract.docx" -F "analysis_type=summary"

# –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ —Ñ–∞–π–ª–∞ - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
curl -X POST http://localhost:8000/api/analyze -F "analysis_type=summary"
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (–æ—Ç–∫–∞–∑ –±–µ–∑ —Ñ–∞–π–ª–∞)
- [ ] –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ñ–∞–π–ª–∞ –∞–Ω–∞–ª–∏–∑ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
- [ ] –û—á–µ—Ä–µ–¥—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- [ ] Rate limiting —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 25.5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∞ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Word.

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

```powershell
# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
curl -X POST http://localhost:8000/api/login -H "Content-Type: application/json" -d '{"username": "admin", "password": "admin"}'

# –≠–∫—Å–ø–æ—Ä—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
curl -X POST http://localhost:8000/api/export -H "Content-Type: application/json" -d '{"content": "# –¢–µ—Å—Ç–æ–≤—ã–π –æ—Ç—á–µ—Ç\n\n| –†–∞–∑–¥–µ–ª | –û–ø–∏—Å–∞–Ω–∏–µ |\n|--------|----------|\n| –¢–µ—Å—Ç | –£—Å–ø–µ—à–Ω–æ |", "filename": "test_export"}' --output test_export.docx
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [ ] –≠–∫—Å–ø–æ—Ä—Ç —Å–æ–∑–¥–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π .docx —Ñ–∞–π–ª
- [ ] –§–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
- [ ] –¢–∞–±–ª–∏—Ü—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 25.6: –ù–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—á–µ—Ä–µ–¥–µ–π –∏ –ª–∏–º–∏—Ç–æ–≤.

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

```powershell
# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
# parallel_requests_test.ps1
```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [ ] –û—á–µ—Ä–µ–¥—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã
- [ ] Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –°–∏—Å—Ç–µ–º–∞ –Ω–µ –ø–∞–¥–∞–µ—Ç –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ
- [ ] –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 25.7: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–æ –∫–æ–Ω—Ü–∞.

**–®–∞–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**

1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –¥–æ–≥–æ–≤–æ—Ä–∞
3. –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∞–Ω–∞–ª–∏–∑–∞
4. –û–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
5. –ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
6. –≠–∫—Å–ø–æ—Ä—Ç –≤ Word
7. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [ ] –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- [ ] –õ–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

### –®–∞–≥ 25.8: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤ [ ]

**–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**
–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–±–æ—è—Ö.

**–¢–µ—Å—Ç—ã –Ω–∞ —Å–±–æ–∏:**

- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ DeepSeek API
- –ü–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–µ JSON —Ñ–∞–π–ª–æ–≤
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ —Ñ–∞–π–ª–æ–≤
- –°–±–æ–∏ –≤ —Ä–∞–±–æ—Ç–µ —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏:**

- [ ] Fallback-—Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç (LM Studio –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ DeepSeek)
- [ ] –°–∏—Å—Ç–µ–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Å–±–æ–µ–≤
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- [ ] –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è

**–°—Ç–∞—Ç—É—Å:** [ ] –ù–µ –Ω–∞—á–∞—Ç | [ ] –í —Ä–∞–±–æ—Ç–µ | [x] –ó–∞–≤–µ—Ä—à–µ–Ω

---

## –£–î–ê–ß–ò –í –†–ê–ó–†–ê–ë–û–¢–ö–ï! üöÄ
